9ff5e79cca0b44bc6a42c1bc1455c2f7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createFolder = createFolder;
exports.getFolderById = getFolderById;
exports.updateFolder = updateFolder;
exports.deleteFolder = deleteFolder;
exports.listFolders = listFolders;
exports.getFoldersByParentId = getFoldersByParentId;
exports.addTestCaseToFolder = addTestCaseToFolder;
const pgClient_1 = require("../../../infrastructure/database/pgClient");
async function createFolder(folderData) {
    await (0, pgClient_1.ensurePgConnected)();
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const result = await pgClient.query(`INSERT INTO folders (name, description, parent_id, sort_order, created_by) 
         VALUES ($1, $2, $3, $4, $5) RETURNING *`, [
        folderData.name,
        folderData.description,
        folderData.parentId,
        folderData.sortOrder || 0,
        folderData.createdBy
    ]);
    return rowToFolder(result.rows[0]);
}
async function getFolderById(id) {
    await (0, pgClient_1.ensurePgConnected)();
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const result = await pgClient.query('SELECT * FROM folders WHERE id = $1', [id]);
    if (result.rows.length === 0)
        return null;
    return rowToFolder(result.rows[0]);
}
async function updateFolder(id, folderData) {
    await (0, pgClient_1.ensurePgConnected)();
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const current = await getFolderById(id);
    if (!current)
        return null;
    const result = await pgClient.query(`UPDATE folders SET name=$1, description=$2, parent_id=$3, sort_order=$4, updated_at=NOW() WHERE id=$5 RETURNING *`, [
        folderData.name ?? current.name,
        folderData.description ?? current.description,
        folderData.parentId ?? current.parentId,
        folderData.sortOrder ?? current.sortOrder,
        id
    ]);
    if (result.rows.length === 0)
        return null;
    return rowToFolder(result.rows[0]);
}
async function deleteFolder(id) {
    await (0, pgClient_1.ensurePgConnected)();
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    // 하위 폴더들을 먼저 삭제
    await pgClient.query('DELETE FROM folders WHERE parent_id = $1', [id]);
    // 테스트케이스들의 폴더 참조 제거
    await pgClient.query('UPDATE testcases SET folder_id = NULL WHERE folder_id = $1', [id]);
    // 폴더 삭제
    const result = await pgClient.query('DELETE FROM folders WHERE id = $1', [id]);
    return (result.rowCount ?? 0) > 0;
}
async function listFolders() {
    await (0, pgClient_1.ensurePgConnected)();
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const result = await pgClient.query('SELECT * FROM folders ORDER BY sort_order, name');
    return result.rows.map(rowToFolder);
}
async function getFoldersByParentId(parentId) {
    await (0, pgClient_1.ensurePgConnected)();
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const query = parentId
        ? 'SELECT * FROM folders WHERE parent_id = $1 ORDER BY sort_order, name'
        : 'SELECT * FROM folders WHERE parent_id IS NULL ORDER BY sort_order, name';
    const params = parentId ? [parentId] : [];
    const result = await pgClient.query(query, params);
    return result.rows.map(rowToFolder);
}
async function addTestCaseToFolder(testCaseId, folderId) {
    await (0, pgClient_1.ensurePgConnected)();
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const result = await pgClient.query('UPDATE testcases SET folder_id = $1 WHERE id = $2', [folderId, testCaseId]);
    return (result.rowCount ?? 0) > 0;
}
function rowToFolder(row) {
    return {
        id: row.id,
        name: row.name,
        description: row.description,
        parentId: row.parent_id,
        sortOrder: row.sort_order,
        createdBy: row.created_by,
        createdAt: row.created_at,
        updatedAt: row.updated_at,
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvZG9tYWlucy9mb2xkZXJzL3JlcG9zaXRvcmllcy9mb2xkZXJSZXBvc2l0b3J5LnRzIiwibWFwcGluZ3MiOiI7O0FBR0Esb0NBbUJDO0FBRUQsc0NBVUM7QUFFRCxvQ0F1QkM7QUFFRCxvQ0FnQkM7QUFFRCxrQ0FTQztBQUVELG9EQWNDO0FBRUQsa0RBWUM7QUF0SEQsd0VBQTJGO0FBR3BGLEtBQUssVUFBVSxZQUFZLENBQUMsVUFBK0I7SUFDOUQsTUFBTSxJQUFBLDRCQUFpQixHQUFFLENBQUM7SUFDMUIsTUFBTSxRQUFRLEdBQUcsSUFBQSxzQkFBVyxHQUFFLENBQUM7SUFDL0IsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ1osTUFBTSxJQUFJLEtBQUssQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFRCxNQUFNLE1BQU0sR0FBRyxNQUFNLFFBQVEsQ0FBQyxLQUFLLENBQy9CO2lEQUN5QyxFQUN6QztRQUNJLFVBQVUsQ0FBQyxJQUFJO1FBQ2YsVUFBVSxDQUFDLFdBQVc7UUFDdEIsVUFBVSxDQUFDLFFBQVE7UUFDbkIsVUFBVSxDQUFDLFNBQVMsSUFBSSxDQUFDO1FBQ3pCLFVBQVUsQ0FBQyxTQUFTO0tBQ3ZCLENBQ0osQ0FBQztJQUNGLE9BQU8sV0FBVyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN2QyxDQUFDO0FBRU0sS0FBSyxVQUFVLGFBQWEsQ0FBQyxFQUFVO0lBQzFDLE1BQU0sSUFBQSw0QkFBaUIsR0FBRSxDQUFDO0lBQzFCLE1BQU0sUUFBUSxHQUFHLElBQUEsc0JBQVcsR0FBRSxDQUFDO0lBQy9CLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNaLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRUQsTUFBTSxNQUFNLEdBQUcsTUFBTSxRQUFRLENBQUMsS0FBSyxD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QVMsRUFBRSxHQUFHLENBQUMsVUFBVTtRQUN6QixTQUFTLEVBQUUsR0FBRyxDQUFDLFVBQVU7UUFDekIsU0FBUyxFQUFFLEdBQUcsQ0FBQyxVQUFVO1FBQ3pCLFNBQVMsRUFBRSxHQUFHLENBQUMsVUFBVTtLQUM1QixDQUFDO0FBQ04sQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvM2ktYTEtMjAyMS0wMTcvRGVza3RvcC9teS1wcm9qZWN0L3NyYy9tYWluL2FwcC9kb21haW5zL2ZvbGRlcnMvcmVwb3NpdG9yaWVzL2ZvbGRlclJlcG9zaXRvcnkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0UGdDbGllbnQsIGVuc3VyZVBnQ29ubmVjdGVkIH0gZnJvbSAnLi4vLi4vLi4vaW5mcmFzdHJ1Y3R1cmUvZGF0YWJhc2UvcGdDbGllbnQnO1xuaW1wb3J0IHsgRm9sZGVyLCBDcmVhdGVGb2xkZXJSZXF1ZXN0LCBVcGRhdGVGb2xkZXJSZXF1ZXN0IH0gZnJvbSAnLi4vbW9kZWxzL0ZvbGRlcic7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVGb2xkZXIoZm9sZGVyRGF0YTogQ3JlYXRlRm9sZGVyUmVxdWVzdCk6IFByb21pc2U8Rm9sZGVyPiB7XG4gICAgYXdhaXQgZW5zdXJlUGdDb25uZWN0ZWQoKTtcbiAgICBjb25zdCBwZ0NsaWVudCA9IGdldFBnQ2xpZW50KCk7XG4gICAgaWYgKCFwZ0NsaWVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Bvc3RncmVTUUwg7YG065287J207Ja47Yq46rCAIOy0iOq4sO2ZlOuQmOyngCDslYrslZjsirXri4jri6QuJyk7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KFxuICAgICAgICBgSU5TRVJUIElOVE8gZm9sZGVycyAobmFtZSwgZGVzY3JpcHRpb24sIHBhcmVudF9pZCwgc29ydF9vcmRlciwgY3JlYXRlZF9ieSkgXG4gICAgICAgICBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSkgUkVUVVJOSU5HICpgLFxuICAgICAgICBbXG4gICAgICAgICAgICBmb2xkZXJEYXRhLm5hbWUsXG4gICAgICAgICAgICBmb2xkZXJEYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgZm9sZGVyRGF0YS5wYXJlbnRJZCxcbiAgICAgICAgICAgIGZvbGRlckRhdGEuc29ydE9yZGVyIHx8IDAsXG4gICAgICAgICAgICBmb2xkZXJEYXRhLmNyZWF0ZWRCeVxuICAgICAgICBdXG4gICAgKTtcbiAgICByZXR1cm4gcm93VG9Gb2xkZXIocmVzdWx0LnJvd3NbMF0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Rm9sZGVyQnlJZChpZDogbnVtYmVyKTogUHJvbWlzZTxGb2xkZXIgfCBudWxsPiB7XG4gICAgYXdhaXQgZW5zdXJlUGdDb25uZWN0ZWQoKTtcbiAgICBjb25zdCBwZ0NsaWVudCA9IGdldFBnQ2xpZW50KCk7XG4gICAgaWYgKCFwZ0NsaWVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Bvc3RncmVTUUwg7YG065287J207Ja47Yq46rCAIOy0iOq4sO2ZlOuQmOyngCDslYrslZjsirXri4jri6QuJyk7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIGZvbGRlcnMgV0hFUkUgaWQgPSAkMScsIFtpZF0pO1xuICAgIGlmIChyZXN1bHQucm93cy5sZW5ndGggPT09IDApIHJldHVybiBudWxsO1xuICAgIHJldHVybiByb3dUb0ZvbGRlcihyZXN1bHQucm93c1swXSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVGb2xkZXIoaWQ6IG51bWJlciwgZm9sZGVyRGF0YTogVXBkYXRlRm9sZGVyUmVxdWVzdCk6IFByb21pc2U8Rm9sZGVyIHwgbnVsbD4ge1xuICAgIGF3YWl0IGVuc3VyZVBnQ29ubmVjdGVkKCk7XG4gICAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICAgIGlmICghcGdDbGllbnQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBjdXJyZW50ID0gYXdhaXQgZ2V0Rm9sZGVyQnlJZChpZCk7XG4gICAgaWYgKCFjdXJyZW50KSByZXR1cm4gbnVsbDtcbiAgICBcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwZ0NsaWVudC5xdWVyeShcbiAgICAgICAgYFVQREFURSBmb2xkZXJzIFNFVCBuYW1lPSQxLCBkZXNjcmlwdGlvbj0kMiwgcGFyZW50X2lkPSQzLCBzb3J0X29yZGVyPSQ0LCB1cGRhdGVkX2F0PU5PVygpIFdIRVJFIGlkPSQ1IFJFVFVSTklORyAqYCxcbiAgICAgICAgW1xuICAgICAgICAgICAgZm9sZGVyRGF0YS5uYW1lID8/IGN1cnJlbnQubmFtZSxcbiAgICAgICAgICAgIGZvbGRlckRhdGEuZGVzY3JpcHRpb24gPz8gY3VycmVudC5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIGZvbGRlckRhdGEucGFyZW50SWQgPz8gY3VycmVudC5wYXJlbnRJZCxcbiAgICAgICAgICAgIGZvbGRlckRhdGEuc29ydE9yZGVyID8/IGN1cnJlbnQuc29ydE9yZGVyLFxuICAgICAgICAgICAgaWRcbiAgICAgICAgXVxuICAgICk7XG4gICAgXG4gICAgaWYgKHJlc3VsdC5yb3dzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIHJvd1RvRm9sZGVyKHJlc3VsdC5yb3dzWzBdKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUZvbGRlcihpZDogbnVtYmVyKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgYXdhaXQgZW5zdXJlUGdDb25uZWN0ZWQoKTtcbiAgICBjb25zdCBwZ0NsaWVudCA9IGdldFBnQ2xpZW50KCk7XG4gICAgaWYgKCFwZ0NsaWVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Bvc3RncmVTUUwg7YG065287J207Ja47Yq46rCAIOy0iOq4sO2ZlOuQmOyngCDslYrslZjsirXri4jri6QuJyk7XG4gICAgfVxuICAgIFxuICAgIC8vIO2VmOychCDtj7TrjZTrk6TsnYQg66i87KCAIOyCreygnFxuICAgIGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KCdERUxFVEUgRlJPTSBmb2xkZXJzIFdIRVJFIHBhcmVudF9pZCA9ICQxJywgW2lkXSk7XG4gICAgXG4gICAgLy8g7YWM7Iqk7Yq47LyA7J207Iqk65Ok7J2YIO2PtOuNlCDssLjsobAg7KCc6rGwXG4gICAgYXdhaXQgcGdDbGllbnQucXVlcnkoJ1VQREFURSB0ZXN0Y2FzZXMgU0VUIGZvbGRlcl9pZCA9IE5VTEwgV0hFUkUgZm9sZGVyX2lkID0gJDEnLCBbaWRdKTtcbiAgICBcbiAgICAvLyDtj7TrjZQg7IKt7KCcXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoJ0RFTEVURSBGUk9NIGZvbGRlcnMgV0hFUkUgaWQgPSAkMScsIFtpZF0pO1xuICAgIHJldHVybiAocmVzdWx0LnJvd0NvdW50ID8/IDApID4gMDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxpc3RGb2xkZXJzKCk6IFByb21pc2U8Rm9sZGVyW10+IHtcbiAgICBhd2FpdCBlbnN1cmVQZ0Nvbm5lY3RlZCgpO1xuICAgIGNvbnN0IHBnQ2xpZW50ID0gZ2V0UGdDbGllbnQoKTtcbiAgICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUG9zdGdyZVNRTCDtgbTrnbzsnbTslrjtirjqsIAg7LSI6riw7ZmU65CY7KeAIOyViuyVmOyKteuLiOuLpC4nKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoJ1NFTEVDVCAqIEZST00gZm9sZGVycyBPUkRFUiBCWSBzb3J0X29yZGVyLCBuYW1lJyk7XG4gICAgcmV0dXJuIHJlc3VsdC5yb3dzLm1hcChyb3dUb0ZvbGRlcik7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRGb2xkZXJzQnlQYXJlbnRJZChwYXJlbnRJZD86IG51bWJlcik6IFByb21pc2U8Rm9sZGVyW10+IHtcbiAgICBhd2FpdCBlbnN1cmVQZ0Nvbm5lY3RlZCgpO1xuICAgIGNvbnN0IHBnQ2xpZW50ID0gZ2V0UGdDbGllbnQoKTtcbiAgICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUG9zdGdyZVNRTCDtgbTrnbzsnbTslrjtirjqsIAg7LSI6riw7ZmU65CY7KeAIOyViuyVmOyKteuLiOuLpC4nKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgcXVlcnkgPSBwYXJlbnRJZCBcbiAgICAgICAgPyAnU0VMRUNUICogRlJPTSBmb2xkZXJzIFdIRVJFIHBhcmVudF9pZCA9ICQxIE9SREVSIEJZIHNvcnRfb3JkZXIsIG5hbWUnXG4gICAgICAgIDogJ1NFTEVDVCAqIEZST00gZm9sZGVycyBXSEVSRSBwYXJlbnRfaWQgSVMgTlVMTCBPUkRFUiBCWSBzb3J0X29yZGVyLCBuYW1lJztcbiAgICBcbiAgICBjb25zdCBwYXJhbXMgPSBwYXJlbnRJZCA/IFtwYXJlbnRJZF0gOiBbXTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwZ0NsaWVudC5xdWVyeShxdWVyeSwgcGFyYW1zKTtcbiAgICByZXR1cm4gcmVzdWx0LnJvd3MubWFwKHJvd1RvRm9sZGVyKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZFRlc3RDYXNlVG9Gb2xkZXIodGVzdENhc2VJZDogbnVtYmVyLCBmb2xkZXJJZDogbnVtYmVyKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgYXdhaXQgZW5zdXJlUGdDb25uZWN0ZWQoKTtcbiAgICBjb25zdCBwZ0NsaWVudCA9IGdldFBnQ2xpZW50KCk7XG4gICAgaWYgKCFwZ0NsaWVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Bvc3RncmVTUUwg7YG065287J207Ja47Yq46rCAIOy0iOq4sO2ZlOuQmOyngCDslYrslZjsirXri4jri6QuJyk7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KFxuICAgICAgICAnVVBEQVRFIHRlc3RjYXNlcyBTRVQgZm9sZGVyX2lkID0gJDEgV0hFUkUgaWQgPSAkMicsXG4gICAgICAgIFtmb2xkZXJJZCwgdGVzdENhc2VJZF1cbiAgICApO1xuICAgIHJldHVybiAocmVzdWx0LnJvd0NvdW50ID8/IDApID4gMDtcbn1cblxuZnVuY3Rpb24gcm93VG9Gb2xkZXIocm93OiBhbnkpOiBGb2xkZXIge1xuICAgIHJldHVybiB7XG4gICAgICAgIGlkOiByb3cuaWQsXG4gICAgICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgICAgICBkZXNjcmlwdGlvbjogcm93LmRlc2NyaXB0aW9uLFxuICAgICAgICBwYXJlbnRJZDogcm93LnBhcmVudF9pZCxcbiAgICAgICAgc29ydE9yZGVyOiByb3cuc29ydF9vcmRlcixcbiAgICAgICAgY3JlYXRlZEJ5OiByb3cuY3JlYXRlZF9ieSxcbiAgICAgICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZF9hdCxcbiAgICAgICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZF9hdCxcbiAgICB9O1xufSAiXSwidmVyc2lvbiI6M30=