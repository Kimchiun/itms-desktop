c7bd66d398efe5c7a9b7823b59e391e3
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const treeService = __importStar(require("../services/treeService"));
const router = (0, express_1.Router)();
// =====================================================
// 기본 CRUD 엔드포인트
// =====================================================
// 트리 구조 조회
router.get('/structure', async (req, res) => {
    try {
        const treeStructure = await treeService.getTreeStructure();
        res.json(treeStructure);
    }
    catch (error) {
        console.error('트리 구조 조회 실패:', error);
        res.status(500).json({
            message: error instanceof Error ? error.message : '트리 구조 조회에 실패했습니다.',
            error: error instanceof Error ? error.stack : String(error)
        });
    }
});
// 모든 노드 조회
router.get('/', async (req, res) => {
    try {
        const nodes = await treeService.getAllTreeNodes();
        res.json(nodes);
    }
    catch (error) {
        console.error('노드 조회 실패:', error);
        res.status(500).json({
            message: error instanceof Error ? error.message : '노드 조회에 실패했습니다.',
            error: error instanceof Error ? error.stack : String(error)
        });
    }
});
// 특정 노드 조회
router.get('/:id', async (req, res) => {
    try {
        const id = parseInt(req.params.id);
        if (isNaN(id)) {
            return res.status(400).json({ message: '유효하지 않은 노드 ID입니다.' });
        }
        const node = await treeService.getTreeNodeById(id);
        if (!node) {
            return res.status(404).json({ message: '노드를 찾을 수 없습니다.' });
        }
        res.json(node);
    }
    catch (error) {
        console.error('노드 조회 실패:', error);
        res.status(500).json({
            message: error instanceof Error ? error.message : '노드 조회에 실패했습니다.',
            error: error instanceof Error ? error.stack : String(error)
        });
    }
});
// 노드 생성
router.post('/', async (req, res) => {
    try {
        console.log('노드 생성 요청:', req.body);
        const nodeData = {
            name: req.body.name,
            type: req.body.type,
            parentId: req.body.parentId || null,
            createdBy: req.body.createdBy || 'system'
        };
        console.log('노드 데이터:', nodeData);
        const node = await treeService.createTreeNode(nodeData);
        console.log('노드 생성 성공:', node);
        res.status(201).json(node);
    }
    catch (error) {
        console.error('노드 생성 실패:', error);
        res.status(400).json({
            message: error instanceof Error ? error.message : '노드 생성에 실패했습니다.',
            error: error instanceof Error ? error.stack : String(error)
        });
    }
});
// 노드 수정
router.put('/:id', async (req, res) => {
    try {
        const id = parseInt(req.params.id);
        if (isNaN(id)) {
            return res.status(400).json({ message: '유효하지 않은 노드 ID입니다.' });
        }
        const updateData = {
            name: req.body.name,
            parentId: req.body.parentId,
            sortOrder: req.body.sortOrder
        };
        const node = await treeService.updateTreeNode(id, updateData);
        if (!node) {
            return res.status(404).json({ message: '노드를 찾을 수 없습니다.' });
        }
        res.json(node);
    }
    catch (error) {
        console.error('노드 수정 실패:', error);
        res.status(400).json({
            message: error instanceof Error ? error.message : '노드 수정에 실패했습니다.',
            error: error instanceof Error ? error.stack : String(error)
        });
    }
});
// 노드 삭제
router.delete('/:id', async (req, res) => {
    try {
        const id = parseInt(req.params.id);
        if (isNaN(id)) {
            return res.status(400).json({ message: '유효하지 않은 노드 ID입니다.' });
        }
        const success = await treeService.deleteTreeNode(id);
        if (!success) {
            return res.status(404).json({ message: '노드를 찾을 수 없습니다.' });
        }
        res.json({ message: '노드가 성공적으로 삭제되었습니다.' });
    }
    catch (error) {
        console.error('노드 삭제 실패:', error);
        res.status(400).json({
            message: error instanceof Error ? error.message : '노드 삭제에 실패했습니다.',
            error: error instanceof Error ? error.stack : String(error)
        });
    }
});
// =====================================================
// 검색 엔드포인트
// =====================================================
// 노드 검색
router.get('/search', async (req, res) => {
    try {
        const searchRequest = {
            query: req.query.query,
            type: req.query.type,
            parentId: req.query.parentId ? parseInt(req.query.parentId) : undefined,
            limit: req.query.limit ? parseInt(req.query.limit) : undefined,
            offset: req.query.offset ? parseInt(req.query.offset) : undefined
        };
        const result = await treeService.searchTreeNodes(searchRequest);
        res.json(result);
    }
    catch (error) {
        console.error('노드 검색 실패:', error);
        res.status(500).json({
            message: error instanceof Error ? error.message : '노드 검색에 실패했습니다.',
            error: error instanceof Error ? error.stack : String(error)
        });
    }
});
// =====================================================
// 드래그 앤 드롭 엔드포인트
// =====================================================
// 드래그 앤 드롭 처리
router.post('/dragdrop', async (req, res) => {
    try {
        const { draggedNodeId, targetNodeId, dropType, position } = req.body;
        if (!draggedNodeId || !targetNodeId || !dropType) {
            return res.status(400).json({ message: '필수 파라미터가 누락되었습니다.' });
        }
        const dragDropRequest = {
            draggedNodeId,
            targetNodeId,
            dropType,
            position
        };
        const result = await treeService.handleTreeNodeDragDrop(dragDropRequest);
        res.json(result);
    }
    catch (error) {
        console.error('드래그 앤 드롭 실패:', error);
        res.status(400).json({
            message: error instanceof Error ? error.message : '드래그 앤 드롭에 실패했습니다.',
            error: error instanceof Error ? error.stack : String(error)
        });
    }
});
// 드롭 영역 유효성 검사
router.post('/validate-drop', async (req, res) => {
    try {
        const { draggedNodeId, targetNodeId, dropZone } = req.body;
        if (!draggedNodeId || !targetNodeId || !dropZone) {
            return res.status(400).json({ message: '필수 파라미터가 누락되었습니다.' });
        }
        const validation = await treeService.validateDropZone(draggedNodeId, targetNodeId, dropZone);
        res.json(validation);
    }
    catch (error) {
        console.error('드롭 영역 유효성 검사 실패:', error);
        res.status(500).json({
            message: error instanceof Error ? error.message : '드롭 영역 유효성 검사에 실패했습니다.',
            error: error instanceof Error ? error.stack : String(error)
        });
    }
});
// =====================================================
// 성능 모니터링 엔드포인트
// =====================================================
// 성능 통계 조회
router.get('/performance/stats', async (req, res) => {
    try {
        // 성능 통계 로직 구현
        res.json({ message: '성능 통계 기능은 추후 구현 예정입니다.' });
    }
    catch (error) {
        console.error('성능 통계 조회 실패:', error);
        res.status(500).json({
            message: error instanceof Error ? error.message : '성능 통계 조회에 실패했습니다.',
            error: error instanceof Error ? error.stack : String(error)
        });
    }
});
exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvZG9tYWlucy90cmVlL2NvbnRyb2xsZXJzL3RyZWVDb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEscUNBQWlDO0FBQ2pDLHFFQUF1RDtBQUd2RCxNQUFNLE1BQU0sR0FBRyxJQUFBLGdCQUFNLEdBQUUsQ0FBQztBQUV4Qix3REFBd0Q7QUFDeEQsZ0JBQWdCO0FBQ2hCLHdEQUF3RDtBQUV4RCxXQUFXO0FBQ1gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRTtJQUMxQyxJQUFJLENBQUM7UUFDSCxNQUFNLGFBQWEsR0FBRyxNQUFNLFdBQVcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQzNELEdBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNyQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUNuQixPQUFPLEVBQUUsS0FBSyxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsbUJBQW1CO1lBQ3JFLEtBQUssRUFBRSxLQUFLLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1NBQzVELENBQUMsQ0FBQztJQUNMLENBQUM7QUFDSCxDQUFDLENBQUMsQ0FBQztBQUVILFdBQVc7QUFDWCxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFO0lBQ2pDLElB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LEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFO0lBQ2xELElBQUksQ0FBQztRQUNILGNBQWM7UUFDZCxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLENBQUMsQ0FBQztJQUNsRCxDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3JDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO1lBQ25CLE9BQU8sRUFBRSxLQUFLLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxtQkFBbUI7WUFDckUsS0FBSyxFQUFFLEtBQUssWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7U0FDNUQsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztBQUNILENBQUMsQ0FBQyxDQUFDO0FBRUgsa0JBQWUsTUFBTSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy8zaS1hMS0yMDIxLTAxNy9EZXNrdG9wL215LXByb2plY3Qvc3JjL21haW4vYXBwL2RvbWFpbnMvdHJlZS9jb250cm9sbGVycy90cmVlQ29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCAqIGFzIHRyZWVTZXJ2aWNlIGZyb20gJy4uL3NlcnZpY2VzL3RyZWVTZXJ2aWNlJztcbmltcG9ydCB7IENyZWF0ZVRyZWVOb2RlUmVxdWVzdCwgVXBkYXRlVHJlZU5vZGVSZXF1ZXN0LCBEcmFnRHJvcFJlcXVlc3QgfSBmcm9tICcuLi9tb2RlbHMvVHJlZU5vZGUnO1xuXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOq4sOuzuCBDUlVEIOyXlOuTnO2PrOyduO2KuFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLy8g7Yq466asIOq1rOyhsCDsobDtmoxcbnJvdXRlci5nZXQoJy9zdHJ1Y3R1cmUnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB0cmVlU3RydWN0dXJlID0gYXdhaXQgdHJlZVNlcnZpY2UuZ2V0VHJlZVN0cnVjdHVyZSgpO1xuICAgIHJlcy5qc29uKHRyZWVTdHJ1Y3R1cmUpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+2KuOumrCDqtazsobAg7KGw7ZqMIOyLpO2MqDonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBcbiAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ+2KuOumrCDqtazsobAg7KGw7ZqM7JeQIOyLpO2MqO2WiOyKteuLiOuLpC4nLFxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IFN0cmluZyhlcnJvcilcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIOuqqOuToCDrhbjrk5wg7KGw7ZqMXG5yb3V0ZXIuZ2V0KCcvJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgbm9kZXMgPSBhd2FpdCB0cmVlU2VydmljZS5nZXRBbGxUcmVlTm9kZXMoKTtcbiAgICByZXMuanNvbihub2Rlcyk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign64W465OcIOyhsO2ajCDsi6TtjKg6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXG4gICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICfrhbjrk5wg7KGw7ZqM7JeQIOyLpO2MqO2WiOyKteuLiOuLpC4nLFxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IFN0cmluZyhlcnJvcilcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIO2KueyglSDrhbjrk5wg7KGw7ZqMXG5yb3V0ZXIuZ2V0KCcvOmlkJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgaWQgPSBwYXJzZUludChyZXEucGFyYW1zLmlkKTtcbiAgICBpZiAoaXNOYU4oaWQpKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAn7Jyg7Zqo7ZWY7KeAIOyViuydgCDrhbjrk5wgSUTsnoXri4jri6QuJyB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBub2RlID0gYXdhaXQgdHJlZVNlcnZpY2UuZ2V0VHJlZU5vZGVCeUlkKGlkKTtcbiAgICBpZiAoIW5vZGUpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICfrhbjrk5zrpbwg7LC+7J2EIOyImCDsl4bsirXri4jri6QuJyB9KTtcbiAgICB9XG5cbiAgICByZXMuanNvbihub2RlKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfrhbjrk5wg7KGw7ZqMIOyLpO2MqDonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBcbiAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ+uFuOuTnCDsobDtmozsl5Ag7Iuk7Yyo7ZaI7Iq164uI64ukLicsXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogU3RyaW5nKGVycm9yKVxuICAgIH0pO1xuICB9XG59KTtcblxuLy8g64W465OcIOyDneyEsVxucm91dGVyLnBvc3QoJy8nLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygn64W465OcIOyDneyEsSDsmpTssq06JywgcmVxLmJvZHkpO1xuXG4gICAgY29uc3Qgbm9kZURhdGE6IENyZWF0ZVRyZWVOb2RlUmVxdWVzdCA9IHtcbiAgICAgIG5hbWU6IHJlcS5ib2R5Lm5hbWUsXG4gICAgICB0eXBlOiByZXEuYm9keS50eXBlLFxuICAgICAgcGFyZW50SWQ6IHJlcS5ib2R5LnBhcmVudElkIHx8IG51bGwsXG4gICAgICBjcmVhdGVkQnk6IHJlcS5ib2R5LmNyZWF0ZWRCeSB8fCAnc3lzdGVtJ1xuICAgIH07XG5cbiAgICBjb25zb2xlLmxvZygn64W465OcIOuNsOydtO2EsDonLCBub2RlRGF0YSk7XG5cbiAgICBjb25zdCBub2RlID0gYXdhaXQgdHJlZVNlcnZpY2UuY3JlYXRlVHJlZU5vZGUobm9kZURhdGEpO1xuICAgIGNvbnNvbGUubG9nKCfrhbjrk5wg7IOd7ISxIOyEseqztTonLCBub2RlKTtcbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbihub2RlKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfrhbjrk5wg7IOd7ISxIOyLpO2MqDonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg0MDApLmpzb24oeyBcbiAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ+uFuOuTnCDsg53shLHsl5Ag7Iuk7Yyo7ZaI7Iq164uI64ukLicsXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogU3RyaW5nKGVycm9yKVxuICAgIH0pO1xuICB9XG59KTtcblxuLy8g64W465OcIOyImOyglVxucm91dGVyLnB1dCgnLzppZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGlkID0gcGFyc2VJbnQocmVxLnBhcmFtcy5pZCk7XG4gICAgaWYgKGlzTmFOKGlkKSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ+ycoO2aqO2VmOyngCDslYrsnYAg64W465OcIElE7J6F64uI64ukLicgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlRGF0YTogVXBkYXRlVHJlZU5vZGVSZXF1ZXN0ID0ge1xuICAgICAgbmFtZTogcmVxLmJvZHkubmFtZSxcbiAgICAgIHBhcmVudElkOiByZXEuYm9keS5wYXJlbnRJZCxcbiAgICAgIHNvcnRPcmRlcjogcmVxLmJvZHkuc29ydE9yZGVyXG4gICAgfTtcblxuICAgIGNvbnN0IG5vZGUgPSBhd2FpdCB0cmVlU2VydmljZS51cGRhdGVUcmVlTm9kZShpZCwgdXBkYXRlRGF0YSk7XG4gICAgaWYgKCFub2RlKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAn64W465Oc66W8IOywvuydhCDsiJgg7JeG7Iq164uI64ukLicgfSk7XG4gICAgfVxuXG4gICAgcmVzLmpzb24obm9kZSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign64W465OcIOyImOyglSDsi6TtjKg6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgXG4gICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICfrhbjrk5wg7IiY7KCV7JeQIOyLpO2MqO2WiOyKteuLiOuLpC4nLFxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IFN0cmluZyhlcnJvcilcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIOuFuOuTnCDsgq3soJxcbnJvdXRlci5kZWxldGUoJy86aWQnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBpZCA9IHBhcnNlSW50KHJlcS5wYXJhbXMuaWQpO1xuICAgIGlmIChpc05hTihpZCkpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICfsnKDtmqjtlZjsp4Ag7JWK7J2AIOuFuOuTnCBJROyeheuLiOuLpC4nIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCB0cmVlU2VydmljZS5kZWxldGVUcmVlTm9kZShpZCk7XG4gICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAn64W465Oc66W8IOywvuydhCDsiJgg7JeG7Iq164uI64ukLicgfSk7XG4gICAgfVxuXG4gICAgcmVzLmpzb24oeyBtZXNzYWdlOiAn64W465Oc6rCAIOyEseqzteyggeycvOuhnCDsgq3soJzrkJjsl4jsirXri4jri6QuJyB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfrhbjrk5wg7IKt7KCcIOyLpO2MqDonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg0MDApLmpzb24oeyBcbiAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ+uFuOuTnCDsgq3soJzsl5Ag7Iuk7Yyo7ZaI7Iq164uI64ukLicsXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogU3RyaW5nKGVycm9yKVxuICAgIH0pO1xuICB9XG59KTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOqygOyDiSDsl5Trk5ztj6zsnbjtirhcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIOuFuOuTnCDqsoDsg4lcbnJvdXRlci5nZXQoJy9zZWFyY2gnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzZWFyY2hSZXF1ZXN0ID0ge1xuICAgICAgcXVlcnk6IHJlcS5xdWVyeS5xdWVyeSBhcyBzdHJpbmcsXG4gICAgICB0eXBlOiByZXEucXVlcnkudHlwZSBhcyAnZm9sZGVyJyB8ICd0ZXN0Y2FzZScsXG4gICAgICBwYXJlbnRJZDogcmVxLnF1ZXJ5LnBhcmVudElkID8gcGFyc2VJbnQocmVxLnF1ZXJ5LnBhcmVudElkIGFzIHN0cmluZykgOiB1bmRlZmluZWQsXG4gICAgICBsaW1pdDogcmVxLnF1ZXJ5LmxpbWl0ID8gcGFyc2VJbnQocmVxLnF1ZXJ5LmxpbWl0IGFzIHN0cmluZykgOiB1bmRlZmluZWQsXG4gICAgICBvZmZzZXQ6IHJlcS5xdWVyeS5vZmZzZXQgPyBwYXJzZUludChyZXEucXVlcnkub2Zmc2V0IGFzIHN0cmluZykgOiB1bmRlZmluZWRcbiAgICB9O1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdHJlZVNlcnZpY2Uuc2VhcmNoVHJlZU5vZGVzKHNlYXJjaFJlcXVlc3QpO1xuICAgIHJlcy5qc29uKHJlc3VsdCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign64W465OcIOqygOyDiSDsi6TtjKg6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXG4gICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICfrhbjrk5wg6rKA7IOJ7JeQIOyLpO2MqO2WiOyKteuLiOuLpC4nLFxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IFN0cmluZyhlcnJvcilcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDrk5zrnpjqt7gg7JWkIOuTnOuhrSDsl5Trk5ztj6zsnbjtirhcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIOuTnOuemOq3uCDslaQg65Oc66GtIOyymOumrFxucm91dGVyLnBvc3QoJy9kcmFnZHJvcCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgZHJhZ2dlZE5vZGVJZCwgdGFyZ2V0Tm9kZUlkLCBkcm9wVHlwZSwgcG9zaXRpb24gfSA9IHJlcS5ib2R5O1xuXG4gICAgaWYgKCFkcmFnZ2VkTm9kZUlkIHx8ICF0YXJnZXROb2RlSWQgfHwgIWRyb3BUeXBlKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAn7ZWE7IiYIO2MjOudvOuvuO2EsOqwgCDriITrnb3rkJjsl4jsirXri4jri6QuJyB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBkcmFnRHJvcFJlcXVlc3Q6IERyYWdEcm9wUmVxdWVzdCA9IHtcbiAgICAgIGRyYWdnZWROb2RlSWQsXG4gICAgICB0YXJnZXROb2RlSWQsXG4gICAgICBkcm9wVHlwZSxcbiAgICAgIHBvc2l0aW9uXG4gICAgfTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRyZWVTZXJ2aWNlLmhhbmRsZVRyZWVOb2RlRHJhZ0Ryb3AoZHJhZ0Ryb3BSZXF1ZXN0KTtcbiAgICByZXMuanNvbihyZXN1bHQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+uTnOuemOq3uCDslaQg65Oc66GtIOyLpO2MqDonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg0MDApLmpzb24oeyBcbiAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ+uTnOuemOq3uCDslaQg65Oc66Gt7JeQIOyLpO2MqO2WiOyKteuLiOuLpC4nLFxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IFN0cmluZyhlcnJvcilcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIOuTnOuhrSDsmIHsl60g7Jyg7Zqo7ISxIOqygOyCrFxucm91dGVyLnBvc3QoJy92YWxpZGF0ZS1kcm9wJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBkcmFnZ2VkTm9kZUlkLCB0YXJnZXROb2RlSWQsIGRyb3Bab25lIH0gPSByZXEuYm9keTtcblxuICAgIGlmICghZHJhZ2dlZE5vZGVJZCB8fCAhdGFyZ2V0Tm9kZUlkIHx8ICFkcm9wWm9uZSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ+2VhOyImCDtjIzrnbzrr7jthLDqsIAg64iE652965CY7JeI7Iq164uI64ukLicgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IGF3YWl0IHRyZWVTZXJ2aWNlLnZhbGlkYXRlRHJvcFpvbmUoZHJhZ2dlZE5vZGVJZCwgdGFyZ2V0Tm9kZUlkLCBkcm9wWm9uZSk7XG4gICAgcmVzLmpzb24odmFsaWRhdGlvbik7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign65Oc66GtIOyYgeyXrSDsnKDtmqjshLEg6rKA7IKsIOyLpO2MqDonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBcbiAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ+uTnOuhrSDsmIHsl60g7Jyg7Zqo7ISxIOqygOyCrOyXkCDsi6TtjKjtlojsirXri4jri6QuJyxcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiBTdHJpbmcoZXJyb3IpXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g7ISx64qlIOuqqOuLiO2EsOungSDsl5Trk5ztj6zsnbjtirhcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIOyEseuKpSDthrXqs4Qg7KGw7ZqMXG5yb3V0ZXIuZ2V0KCcvcGVyZm9ybWFuY2Uvc3RhdHMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICAvLyDshLHriqUg7Ya16rOEIOuhnOyngSDqtaztmIRcbiAgICByZXMuanNvbih7IG1lc3NhZ2U6ICfshLHriqUg7Ya16rOEIOq4sOuKpeydgCDstpTtm4Qg6rWs7ZiEIOyYiOygleyeheuLiOuLpC4nIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+yEseuKpSDthrXqs4Qg7KGw7ZqMIOyLpO2MqDonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBcbiAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ+yEseuKpSDthrXqs4Qg7KGw7ZqM7JeQIOyLpO2MqO2WiOyKteuLiOuLpC4nLFxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IFN0cmluZyhlcnJvcilcbiAgICB9KTtcbiAgfVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHJvdXRlcjsgIl0sInZlcnNpb24iOjN9