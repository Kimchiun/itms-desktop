ccc63f52308fa222c6de26c6f9319158
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createTestCaseWithVersion = createTestCaseWithVersion;
exports.updateTestCaseWithVersion = updateTestCaseWithVersion;
exports.deleteTestCaseWithIndex = deleteTestCaseWithIndex;
exports.getTestCaseVersions = getTestCaseVersions;
exports.getTestCases = getTestCases;
exports.getTestCaseById = getTestCaseById;
exports.createTestCase = createTestCase;
exports.updateTestCase = updateTestCase;
exports.deleteTestCase = deleteTestCase;
const testCaseRepository_1 = require("../repositories/testCaseRepository");
const testCaseIndexer_1 = require("../elasticsearch/testCaseIndexer");
function omitFields(obj, keys) {
    const copy = { ...obj };
    keys.forEach(k => { delete copy[k]; });
    return copy;
}
async function createTestCaseWithVersion(tc) {
    const created = await (0, testCaseRepository_1.createTestCase)(tc);
    await (0, testCaseRepository_1.createTestCaseVersion)({
        testcaseId: created.id,
        version: 1,
        data: { ...tc },
        createdBy: tc.createdBy,
    });
    await (0, testCaseIndexer_1.indexTestCase)(created);
    return created;
}
async function updateTestCaseWithVersion(id, patch, user) {
    const before = await (0, testCaseRepository_1.getTestCaseById)(id);
    if (!before)
        return null;
    const updated = await (0, testCaseRepository_1.updateTestCase)(id, patch);
    if (!updated)
        return null;
    const versions = await (0, testCaseRepository_1.listTestCaseVersions)(id);
    await (0, testCaseRepository_1.createTestCaseVersion)({
        testcaseId: id,
        version: (versions[0]?.version || 1) + 1,
        data: omitFields(updated, ['id', 'createdAt', 'updatedAt']),
        createdBy: user,
    });
    await (0, testCaseIndexer_1.indexTestCase)(updated);
    return updated;
}
async function deleteTestCaseWithIndex(id) {
    const ok = await (0, testCaseRepository_1.deleteTestCase)(id);
    if (ok)
        await (0, testCaseIndexer_1.removeTestCaseFromIndex)(id);
    return ok;
}
async function getTestCaseVersions(id) {
    return (0, testCaseRepository_1.listTestCaseVersions)(id);
}
// 컨트롤러에서 사용할 메서드들
async function getTestCases(params) {
    const testCases = await (0, testCaseRepository_1.listTestCases)();
    // 간단한 필터링 (실제로는 repository에서 처리해야 함)
    let filteredCases = testCases;
    if (params.search) {
        filteredCases = filteredCases.filter(tc => tc.title.toLowerCase().includes(params.search.toLowerCase()) ||
            tc.prereq?.toLowerCase().includes(params.search.toLowerCase()) ||
            tc.expected?.toLowerCase().includes(params.search.toLowerCase()));
    }
    if (params.folderId) {
        filteredCases = filteredCases.filter(tc => tc.folderId === params.folderId);
    }
    // 페이징 처리
    const offset = (params.page - 1) * params.limit;
    const paginatedCases = filteredCases.slice(offset, offset + params.limit);
    return {
        testCases: paginatedCases,
        total: filteredCases.length
    };
}
async function getTestCaseById(id) {
    return await (0, testCaseRepository_1.getTestCaseById)(id);
}
async function createTestCase(data) {
    return await createTestCaseWithVersion(data);
}
async function updateTestCase(id, data) {
    return await updateTestCaseWithVersion(id, data, data.createdBy || 'system');
}
async function deleteTestCase(id) {
    return await deleteTestCaseWithIndex(id);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvZG9tYWlucy90ZXN0Y2FzZXMvc2VydmljZXMvdGVzdENhc2VTZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7O0FBVUEsOERBVUM7QUFFRCw4REFjQztBQUVELDBEQUlDO0FBRUQsa0RBRUM7QUFHRCxvQ0ErQkM7QUFFRCwwQ0FFQztBQUVELHdDQUVDO0FBRUQsd0NBRUM7QUFFRCx3Q0FFQztBQWhHRCwyRUFBMFE7QUFDMVEsc0VBQTBGO0FBRzFGLFNBQVMsVUFBVSxDQUFzQyxHQUFNLEVBQUUsSUFBUztJQUN0RSxNQUFNLElBQUksR0FBRyxFQUFFLEdBQUcsR0FBRyxFQUFFLENBQUM7SUFDeEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLE9BQVEsSUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDaEQsT0FBTyxJQUFrQixDQUFDO0FBQzlCLENBQUM7QUFFTSxLQUFLLFVBQVUseUJBQXlCLENBQUMsRUFBb0Q7SUFDaEcsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFBLG1DQUFrQixFQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzdDLE1BQU0sSUFBQSwwQ0FBcUIsRUFBQztRQUN4QixVQUFVLEVBQUUsT0FBTyxDQUFDLEVBQUU7UUFDdEIsT0FBTyxFQUFFLENBQUM7UUFDVixJQUFJLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUNmLFNBQVMsRUFBRSxFQUFFLENBQUMsU0FBUztLQUMxQixDQUFDLENBQUM7SUFDSCxNQUFNLElBQUEsK0JBQWEsRUFBQyxPQUFPLENBQUMsQ0FBQztJQUM3QixPQUFPLE9BQU8sQ0FBQztBQUNuQixDQUFDO0FBRU0sS0FBSyxVQUFVLHlCQUF5QixDQUFDLEVBQVUsRUFBRSxLQUF3QixFQUFFLElBQVk7SUFDOUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLG9DQUFtQixFQUFDLEVBQUUsQ0FBQyxDQUFDO0lB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SUFBc0Q7SUFDdkYsT0FBTyxNQUFNLHlCQUF5QixDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2pELENBQUM7QUFFTSxLQUFLLFVBQVUsY0FBYyxDQUFDLEVBQVUsRUFBRSxJQUF1QjtJQUNwRSxPQUFPLE1BQU0seUJBQXlCLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxJQUFJLFFBQVEsQ0FBQyxDQUFDO0FBQ2pGLENBQUM7QUFFTSxLQUFLLFVBQVUsY0FBYyxDQUFDLEVBQVU7SUFDM0MsT0FBTyxNQUFNLHVCQUF1QixDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQzdDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvZG9tYWlucy90ZXN0Y2FzZXMvc2VydmljZXMvdGVzdENhc2VTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZVRlc3RDYXNlIGFzIGNyZWF0ZVRlc3RDYXNlUmVwbywgZ2V0VGVzdENhc2VCeUlkIGFzIGdldFRlc3RDYXNlQnlJZFJlcG8sIHVwZGF0ZVRlc3RDYXNlIGFzIHVwZGF0ZVRlc3RDYXNlUmVwbywgZGVsZXRlVGVzdENhc2UgYXMgZGVsZXRlVGVzdENhc2VSZXBvLCBsaXN0VGVzdENhc2VzLCBjcmVhdGVUZXN0Q2FzZVZlcnNpb24sIGxpc3RUZXN0Q2FzZVZlcnNpb25zIH0gZnJvbSAnLi4vcmVwb3NpdG9yaWVzL3Rlc3RDYXNlUmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBpbmRleFRlc3RDYXNlLCByZW1vdmVUZXN0Q2FzZUZyb21JbmRleCB9IGZyb20gJy4uL2VsYXN0aWNzZWFyY2gvdGVzdENhc2VJbmRleGVyJztcbmltcG9ydCB7IFRlc3RDYXNlLCBUZXN0Q2FzZVZlcnNpb24gfSBmcm9tICcuLi9tb2RlbHMvVGVzdENhc2UnO1xuXG5mdW5jdGlvbiBvbWl0RmllbGRzPFQgZXh0ZW5kcyBvYmplY3QsIEsgZXh0ZW5kcyBrZXlvZiBUPihvYmo6IFQsIGtleXM6IEtbXSk6IE9taXQ8VCwgSz4ge1xuICAgIGNvbnN0IGNvcHkgPSB7IC4uLm9iaiB9O1xuICAgIGtleXMuZm9yRWFjaChrID0+IHsgZGVsZXRlIChjb3B5IGFzIGFueSlba107IH0pO1xuICAgIHJldHVybiBjb3B5IGFzIE9taXQ8VCwgSz47XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVUZXN0Q2FzZVdpdGhWZXJzaW9uKHRjOiBPbWl0PFRlc3RDYXNlLCAnaWQnIHwgJ2NyZWF0ZWRBdCcgfCAndXBkYXRlZEF0Jz4pOiBQcm9taXNlPFRlc3RDYXNlPiB7XG4gICAgY29uc3QgY3JlYXRlZCA9IGF3YWl0IGNyZWF0ZVRlc3RDYXNlUmVwbyh0Yyk7XG4gICAgYXdhaXQgY3JlYXRlVGVzdENhc2VWZXJzaW9uKHtcbiAgICAgICAgdGVzdGNhc2VJZDogY3JlYXRlZC5pZCxcbiAgICAgICAgdmVyc2lvbjogMSxcbiAgICAgICAgZGF0YTogeyAuLi50YyB9LFxuICAgICAgICBjcmVhdGVkQnk6IHRjLmNyZWF0ZWRCeSxcbiAgICB9KTtcbiAgICBhd2FpdCBpbmRleFRlc3RDYXNlKGNyZWF0ZWQpO1xuICAgIHJldHVybiBjcmVhdGVkO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlVGVzdENhc2VXaXRoVmVyc2lvbihpZDogbnVtYmVyLCBwYXRjaDogUGFydGlhbDxUZXN0Q2FzZT4sIHVzZXI6IHN0cmluZyk6IFByb21pc2U8VGVzdENhc2UgfCBudWxsPiB7XG4gICAgY29uc3QgYmVmb3JlID0gYXdhaXQgZ2V0VGVzdENhc2VCeUlkUmVwbyhpZCk7XG4gICAgaWYgKCFiZWZvcmUpIHJldHVybiBudWxsO1xuICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCB1cGRhdGVUZXN0Q2FzZVJlcG8oaWQsIHBhdGNoKTtcbiAgICBpZiAoIXVwZGF0ZWQpIHJldHVybiBudWxsO1xuICAgIGNvbnN0IHZlcnNpb25zID0gYXdhaXQgbGlzdFRlc3RDYXNlVmVyc2lvbnMoaWQpO1xuICAgIGF3YWl0IGNyZWF0ZVRlc3RDYXNlVmVyc2lvbih7XG4gICAgICAgIHRlc3RjYXNlSWQ6IGlkLFxuICAgICAgICB2ZXJzaW9uOiAodmVyc2lvbnNbMF0/LnZlcnNpb24gfHwgMSkgKyAxLFxuICAgICAgICBkYXRhOiBvbWl0RmllbGRzKHVwZGF0ZWQsIFsnaWQnLCAnY3JlYXRlZEF0JywgJ3VwZGF0ZWRBdCddKSxcbiAgICAgICAgY3JlYXRlZEJ5OiB1c2VyLFxuICAgIH0pO1xuICAgIGF3YWl0IGluZGV4VGVzdENhc2UodXBkYXRlZCk7XG4gICAgcmV0dXJuIHVwZGF0ZWQ7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVUZXN0Q2FzZVdpdGhJbmRleChpZDogbnVtYmVyKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3Qgb2sgPSBhd2FpdCBkZWxldGVUZXN0Q2FzZVJlcG8oaWQpO1xuICAgIGlmIChvaykgYXdhaXQgcmVtb3ZlVGVzdENhc2VGcm9tSW5kZXgoaWQpO1xuICAgIHJldHVybiBvaztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFRlc3RDYXNlVmVyc2lvbnMoaWQ6IG51bWJlcik6IFByb21pc2U8VGVzdENhc2VWZXJzaW9uW10+IHtcbiAgICByZXR1cm4gbGlzdFRlc3RDYXNlVmVyc2lvbnMoaWQpO1xufVxuXG4vLyDsu6jtirjroaTrn6zsl5DshJwg7IKs7Jqp7ZWgIOuplOyEnOuTnOuTpFxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFRlc3RDYXNlcyhwYXJhbXM6IHtcbiAgICBwYWdlOiBudW1iZXI7XG4gICAgbGltaXQ6IG51bWJlcjtcbiAgICBzZWFyY2g/OiBzdHJpbmc7XG4gICAgZm9sZGVySWQ/OiBudW1iZXI7XG59KTogUHJvbWlzZTx7IHRlc3RDYXNlczogVGVzdENhc2VbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgY29uc3QgdGVzdENhc2VzID0gYXdhaXQgbGlzdFRlc3RDYXNlcygpO1xuICAgIFxuICAgIC8vIOqwhOuLqO2VnCDtlYTthLDrp4EgKOyLpOygnOuhnOuKlCByZXBvc2l0b3J57JeQ7IScIOyymOumrO2VtOyVvCDtlagpXG4gICAgbGV0IGZpbHRlcmVkQ2FzZXMgPSB0ZXN0Q2FzZXM7XG4gICAgXG4gICAgaWYgKHBhcmFtcy5zZWFyY2gpIHtcbiAgICAgICAgZmlsdGVyZWRDYXNlcyA9IGZpbHRlcmVkQ2FzZXMuZmlsdGVyKHRjID0+IFxuICAgICAgICAgICAgdGMudGl0bGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhwYXJhbXMuc2VhcmNoIS50b0xvd2VyQ2FzZSgpKSB8fFxuICAgICAgICAgICAgdGMucHJlcmVxPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHBhcmFtcy5zZWFyY2ghLnRvTG93ZXJDYXNlKCkpIHx8XG4gICAgICAgICAgICB0Yy5leHBlY3RlZD8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhwYXJhbXMuc2VhcmNoIS50b0xvd2VyQ2FzZSgpKVxuICAgICAgICApO1xuICAgIH1cbiAgICBcbiAgICBpZiAocGFyYW1zLmZvbGRlcklkKSB7XG4gICAgICAgIGZpbHRlcmVkQ2FzZXMgPSBmaWx0ZXJlZENhc2VzLmZpbHRlcih0YyA9PiB0Yy5mb2xkZXJJZCA9PT0gcGFyYW1zLmZvbGRlcklkKTtcbiAgICB9XG4gICAgXG4gICAgLy8g7Y6Y7J207KeVIOyymOumrFxuICAgIGNvbnN0IG9mZnNldCA9IChwYXJhbXMucGFnZSAtIDEpICogcGFyYW1zLmxpbWl0O1xuICAgIGNvbnN0IHBhZ2luYXRlZENhc2VzID0gZmlsdGVyZWRDYXNlcy5zbGljZShvZmZzZXQsIG9mZnNldCArIHBhcmFtcy5saW1pdCk7XG4gICAgXG4gICAgcmV0dXJuIHsgXG4gICAgICAgIHRlc3RDYXNlczogcGFnaW5hdGVkQ2FzZXMsIFxuICAgICAgICB0b3RhbDogZmlsdGVyZWRDYXNlcy5sZW5ndGggXG4gICAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFRlc3RDYXNlQnlJZChpZDogbnVtYmVyKTogUHJvbWlzZTxUZXN0Q2FzZSB8IG51bGw+IHtcbiAgICByZXR1cm4gYXdhaXQgZ2V0VGVzdENhc2VCeUlkUmVwbyhpZCk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVUZXN0Q2FzZShkYXRhOiBPbWl0PFRlc3RDYXNlLCAnaWQnIHwgJ2NyZWF0ZWRBdCcgfCAndXBkYXRlZEF0Jz4pOiBQcm9taXNlPFRlc3RDYXNlPiB7XG4gICAgcmV0dXJuIGF3YWl0IGNyZWF0ZVRlc3RDYXNlV2l0aFZlcnNpb24oZGF0YSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVUZXN0Q2FzZShpZDogbnVtYmVyLCBkYXRhOiBQYXJ0aWFsPFRlc3RDYXNlPik6IFByb21pc2U8VGVzdENhc2UgfCBudWxsPiB7XG4gICAgcmV0dXJuIGF3YWl0IHVwZGF0ZVRlc3RDYXNlV2l0aFZlcnNpb24oaWQsIGRhdGEsIGRhdGEuY3JlYXRlZEJ5IHx8ICdzeXN0ZW0nKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVRlc3RDYXNlKGlkOiBudW1iZXIpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICByZXR1cm4gYXdhaXQgZGVsZXRlVGVzdENhc2VXaXRoSW5kZXgoaWQpO1xufSAiXSwidmVyc2lvbiI6M30=