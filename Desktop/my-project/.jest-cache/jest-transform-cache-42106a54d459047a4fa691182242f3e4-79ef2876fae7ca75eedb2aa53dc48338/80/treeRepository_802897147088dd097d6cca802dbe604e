50ae37e15e526a3c90ed4b739f81ed41
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createTreeNode = createTreeNode;
exports.getTreeNodeById = getTreeNodeById;
exports.getAllTreeNodes = getAllTreeNodes;
exports.getTreeStructure = getTreeStructure;
exports.updateTreeNode = updateTreeNode;
exports.deleteTreeNode = deleteTreeNode;
exports.searchTreeNodes = searchTreeNodes;
exports.moveTreeNode = moveTreeNode;
exports.reorderTreeNode = reorderTreeNode;
exports.checkCircularReference = checkCircularReference;
exports.recordTreeNodeMove = recordTreeNodeMove;
const pgClient_1 = require("../../../infrastructure/database/pgClient");
// =====================================================
// 기본 CRUD 함수
// =====================================================
async function createTreeNode(request) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    // 새 노드의 sort_order 계산
    let sortOrder = 0;
    if (request.parentId !== null && request.parentId !== undefined) {
        const siblings = await pgClient.query('SELECT sort_order FROM tree_nodes WHERE parent_id = $1 ORDER BY sort_order DESC LIMIT 1', [request.parentId]);
        if (siblings.rows.length > 0) {
            sortOrder = siblings.rows[0].sort_order + 1;
        }
    }
    const result = await pgClient.query('INSERT INTO tree_nodes (name, type, parent_id, sort_order, created_by) VALUES ($1, $2, $3, $4, $5) RETURNING *', [request.name, request.type, request.parentId, sortOrder, request.createdBy]);
    const row = result.rows[0];
    return {
        id: row.id,
        name: row.name,
        type: row.type,
        parentId: row.parent_id,
        sortOrder: row.sort_order,
        createdAt: row.created_at,
        updatedAt: row.updated_at,
        createdBy: row.created_by
    };
}
async function getTreeNodeById(id) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const result = await pgClient.query('SELECT * FROM tree_nodes WHERE id = $1', [id]);
    if (result.rows.length === 0) {
        return null;
    }
    const row = result.rows[0];
    return {
        id: row.id,
        name: row.name,
        type: row.type,
        parentId: row.parent_id,
        sortOrder: row.sort_order,
        createdAt: row.created_at,
        updatedAt: row.updated_at,
        createdBy: row.created_by
    };
}
async function getAllTreeNodes() {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const result = await pgClient.query('SELECT * FROM tree_nodes ORDER BY sort_order, name');
    return result.rows.map((row) => ({
        id: row.id,
        name: row.name,
        type: row.type,
        parentId: row.parent_id,
        sortOrder: row.sort_order,
        createdAt: row.created_at,
        updatedAt: row.updated_at,
        createdBy: row.created_by
    }));
}
async function getTreeStructure() {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    // 모든 노드 조회
    const allNodes = await getAllTreeNodes();
    // 테스트케이스 수 계산
    const testCaseCounts = await pgClient.query(`
    SELECT parent_id, COUNT(*) as count 
    FROM tree_nodes 
    WHERE type = 'testcase' 
    GROUP BY parent_id
  `);
    const countMap = new Map();
    testCaseCounts.rows.forEach((row) => {
        countMap.set(row.parent_id, parseInt(row.count));
    });
    // 트리 구조 생성
    const nodeMap = new Map();
    const rootNodes = [];
    // 먼저 모든 노드를 맵에 추가
    allNodes.forEach(node => {
        const treeNode = {
            ...node,
            children: [],
            testcaseCount: countMap.get(node.id) || 0
        };
        nodeMap.set(node.id, treeNode);
    });
    // 부모-자식 관계 구성
    allNodes.forEach(node => {
        const treeNode = nodeMap.get(node.id);
        if (node.parentId && node.parentId !== null) {
            const parent = nodeMap.get(node.parentId);
            if (parent) {
                parent.children.push(treeNode);
            }
            else {
                rootNodes.push(treeNode);
            }
        }
        else {
            rootNodes.push(treeNode);
        }
    });
    return rootNodes;
}
async function updateTreeNode(id, updates) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const setClauses = [];
    const values = [];
    let paramIndex = 1;
    if (updates.name !== undefined) {
        setClauses.push(`name = $${paramIndex++}`);
        values.push(updates.name);
    }
    if (updates.parentId !== undefined) {
        setClauses.push(`parent_id = $${paramIndex++}`);
        values.push(updates.parentId);
    }
    if (updates.sortOrder !== undefined) {
        setClauses.push(`sort_order = $${paramIndex++}`);
        values.push(updates.sortOrder);
    }
    if (setClauses.length === 0) {
        return getTreeNodeById(id);
    }
    values.push(id);
    const query = `UPDATE tree_nodes SET ${setClauses.join(', ')} WHERE id = $${paramIndex} RETURNING *`;
    const result = await pgClient.query(query, values);
    if (result.rows.length === 0) {
        return null;
    }
    const row = result.rows[0];
    return {
        id: row.id,
        name: row.name,
        type: row.type,
        parentId: row.parent_id,
        sortOrder: row.sort_order,
        createdAt: row.created_at,
        updatedAt: row.updated_at,
        createdBy: row.created_by
    };
}
async function deleteTreeNode(id) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const result = await pgClient.query('DELETE FROM tree_nodes WHERE id = $1 RETURNING id', [id]);
    return result.rows.length > 0;
}
// =====================================================
// 검색 함수
// =====================================================
async function searchTreeNodes(request) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    let query = 'SELECT * FROM tree_nodes WHERE 1=1';
    const values = [];
    let paramIndex = 1;
    if (request.query) {
        query += ` AND name ILIKE $${paramIndex++}`;
        values.push(`%${request.query}%`);
    }
    if (request.type) {
        query += ` AND type = $${paramIndex++}`;
        values.push(request.type);
    }
    if (request.parentId !== undefined) {
        query += ` AND parent_id = $${paramIndex++}`;
        values.push(request.parentId);
    }
    query += ' ORDER BY sort_order, name';
    if (request.limit) {
        query += ` LIMIT $${paramIndex++}`;
        values.push(request.limit);
    }
    if (request.offset) {
        query += ` OFFSET $${paramIndex++}`;
        values.push(request.offset);
    }
    const result = await pgClient.query(query, values);
    const nodes = result.rows.map((row) => ({
        id: row.id,
        name: row.name,
        type: row.type,
        parentId: row.parent_id,
        sortOrder: row.sort_order,
        createdAt: row.created_at,
        updatedAt: row.updated_at,
        createdBy: row.created_by
    }));
    // 전체 개수 조회
    let countQuery = 'SELECT COUNT(*) FROM tree_nodes WHERE 1=1';
    const countValues = [];
    let countParamIndex = 1;
    if (request.query) {
        countQuery += ` AND name ILIKE $${countParamIndex++}`;
        countValues.push(`%${request.query}%`);
    }
    if (request.type) {
        countQuery += ` AND type = $${countParamIndex++}`;
        countValues.push(request.type);
    }
    if (request.parentId !== undefined) {
        countQuery += ` AND parent_id = $${countParamIndex++}`;
        countValues.push(request.parentId);
    }
    const countResult = await pgClient.query(countQuery, countValues);
    const total = parseInt(countResult.rows[0].count);
    return { nodes, total };
}
// =====================================================
// 드래그 앤 드롭 관련 함수
// =====================================================
async function moveTreeNode(nodeId, newParentId) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    try {
        await pgClient.query('BEGIN');
        // 새 부모의 최대 순서 조회
        let newSortOrder = 0;
        if (newParentId !== null) {
            const maxSortResult = await pgClient.query('SELECT COALESCE(MAX(sort_order), 0) as max_sort FROM tree_nodes WHERE parent_id = $1', [newParentId]);
            newSortOrder = maxSortResult.rows[0].max_sort + 1;
        }
        // 노드 이동
        const result = await pgClient.query('UPDATE tree_nodes SET parent_id = $1, sort_order = $2 WHERE id = $3 RETURNING *', [newParentId, newSortOrder, nodeId]);
        await pgClient.query('COMMIT');
        if (result.rows.length === 0) {
            return null;
        }
        const row = result.rows[0];
        return {
            id: row.id,
            name: row.name,
            type: row.type,
            parentId: row.parent_id,
            sortOrder: row.sort_order,
            createdAt: row.created_at,
            updatedAt: row.updated_at,
            createdBy: row.created_by
        };
    }
    catch (error) {
        await pgClient.query('ROLLBACK');
        throw error;
    }
}
async function reorderTreeNode(nodeId, targetNodeId, position) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    try {
        await pgClient.query('BEGIN');
        // 현재 노드와 대상 노드 정보 조회
        const draggedNode = await getTreeNodeById(nodeId);
        const targetNode = await getTreeNodeById(targetNodeId);
        if (!draggedNode || !targetNode) {
            throw new Error('노드를 찾을 수 없습니다.');
        }
        // 같은 부모 노드 내에서만 순서 변경 가능
        if (draggedNode.parentId !== targetNode.parentId) {
            throw new Error('같은 부모 노드 내에서만 순서 변경이 가능합니다.');
        }
        // 대상 노드의 현재 순서 조회
        const targetSortOrder = targetNode.sortOrder;
        // 새로운 순서 계산
        let newSortOrder;
        if (position === 'before') {
            newSortOrder = targetSortOrder;
            // 대상 노드와 그 이후 노드들의 순서를 1씩 증가
            await pgClient.query('UPDATE tree_nodes SET sort_order = sort_order + 1 WHERE parent_id = $1 AND sort_order >= $2', [targetNode.parentId, targetSortOrder]);
        }
        else {
            newSortOrder = targetSortOrder + 1;
            // 대상 노드 이후 노드들의 순서를 1씩 증가
            await pgClient.query('UPDATE tree_nodes SET sort_order = sort_order + 1 WHERE parent_id = $1 AND sort_order > $2', [targetNode.parentId, targetSortOrder]);
        }
        // 드래그한 노드의 순서 업데이트
        const result = await pgClient.query('UPDATE tree_nodes SET sort_order = $1 WHERE id = $2 RETURNING *', [newSortOrder, nodeId]);
        await pgClient.query('COMMIT');
        if (result.rows.length === 0) {
            return null;
        }
        const row = result.rows[0];
        return {
            id: row.id,
            name: row.name,
            type: row.type,
            parentId: row.parent_id,
            sortOrder: row.sort_order,
            createdAt: row.created_at,
            updatedAt: row.updated_at,
            createdBy: row.created_by
        };
    }
    catch (error) {
        await pgClient.query('ROLLBACK');
        throw error;
    }
}
// =====================================================
// 유효성 검사 함수
// =====================================================
async function checkCircularReference(nodeId, newParentId) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    // 자기 자신을 부모로 설정하는 경우
    if (nodeId === newParentId) {
        return true;
    }
    // 반복문으로 순환 참조 검사 (재귀 대신)
    const visited = new Set();
    let currentId = newParentId;
    while (currentId !== null) {
        // 이미 방문한 ID가 있다면 순환 참조
        if (visited.has(currentId)) {
            return true;
        }
        visited.add(currentId);
        // 현재 ID가 이동하려는 노드와 같다면 순환 참조
        if (currentId === nodeId) {
            return true;
        }
        // 부모 ID 조회
        const result = await pgClient.query('SELECT parent_id FROM tree_nodes WHERE id = $1', [currentId]);
        const parentId = result.rows[0]?.parent_id;
        if (!parentId) {
            break; // 루트에 도달
        }
        currentId = parentId;
    }
    return false;
}
// =====================================================
// 히스토리 관련 함수
// =====================================================
async function recordTreeNodeMove(history) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    await pgClient.query('INSERT INTO tree_node_move_history (node_id, old_parent_id, new_parent_id, old_sort_order, new_sort_order, moved_by) VALUES ($1, $2, $3, $4, $5, $6)', [history.nodeId, history.oldParentId, history.newParentId, history.oldSortOrder, history.newSortOrder, history.movedBy]);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvZG9tYWlucy90cmVlL3JlcG9zaXRvcmllcy90cmVlUmVwb3NpdG9yeS50cyIsIm1hcHBpbmdzIjoiOztBQU9BLHdDQWtDQztBQUVELDBDQXVCQztBQUVELDBDQWtCQztBQUVELDRDQXFEQztBQUVELHdDQWlEQztBQUVELHdDQVFDO0FBTUQsMENBMEVDO0FBTUQsb0NBOENDO0FBRUQsMENBc0VDO0FBTUQsd0RBd0NDO0FBTUQsZ0RBaUJDO0FBM2RELHdFQUF3RTtBQUd4RSx3REFBd0Q7QUFDeEQsYUFBYTtBQUNiLHdEQUF3RDtBQUVqRCxLQUFLLFVBQVUsY0FBYyxDQUFDLE9BQThCO0lBQ2pFLE1BQU0sUUFBUSxHQUFHLElBQUEsc0JBQVcsR0FBRSxDQUFDO0lBQy9CLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNkLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRUQsc0JBQXNCO0lBQ3RCLElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQztJQUNsQixJQUFJLE9BQU8sQ0FBQyxRQUFRLEtBQUssSUFBSSxJQUFJLE9BQU8sQ0FBQyxRQUFRLEtBQUssU0FBUyxFQUFFLENBQUM7UUFDaEUsTUFBTSxRQUFRLEdBQUcsTUFBTSxRQUFRLENBQUMsS0FBSyxDQUNuQyx5RkFBeUYsRUFDekYsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQ25CLENBQUM7UUFDRixJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQzdCLFNBQVMsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7UUFDOUMsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNLE1BQU0sR0FBRyxNQUFNLFFBQVEsQ0FBQyxLQUFLLENBQ2pDLGdIQUFnSCxFQUNoSCxDQUFDLE9BQU8sQ0FBQyxJQUFJ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LElBQUEsc0JBQVcsR0FBRSxDQUFDO0lBQy9CLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNkLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRUQsTUFBTSxRQUFRLENBQUMsS0FBSyxDQUNsQixzSkFBc0osRUFDdEosQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUN4SCxDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvM2ktYTEtMjAyMS0wMTcvRGVza3RvcC9teS1wcm9qZWN0L3NyYy9tYWluL2FwcC9kb21haW5zL3RyZWUvcmVwb3NpdG9yaWVzL3RyZWVSZXBvc2l0b3J5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldFBnQ2xpZW50IH0gZnJvbSAnLi4vLi4vLi4vaW5mcmFzdHJ1Y3R1cmUvZGF0YWJhc2UvcGdDbGllbnQnO1xuaW1wb3J0IHsgVHJlZU5vZGUsIENyZWF0ZVRyZWVOb2RlUmVxdWVzdCwgVXBkYXRlVHJlZU5vZGVSZXF1ZXN0LCBUcmVlU2VhcmNoUmVxdWVzdCwgVHJlZVNlYXJjaFJlc3VsdCB9IGZyb20gJy4uL21vZGVscy9UcmVlTm9kZSc7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDquLDrs7ggQ1JVRCDtlajsiJhcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVUcmVlTm9kZShyZXF1ZXN0OiBDcmVhdGVUcmVlTm9kZVJlcXVlc3QpOiBQcm9taXNlPFRyZWVOb2RlPiB7XG4gIGNvbnN0IHBnQ2xpZW50ID0gZ2V0UGdDbGllbnQoKTtcbiAgaWYgKCFwZ0NsaWVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcignUG9zdGdyZVNRTCDtgbTrnbzsnbTslrjtirjqsIAg7LSI6riw7ZmU65CY7KeAIOyViuyVmOyKteuLiOuLpC4nKTtcbiAgfVxuXG4gIC8vIOyDiCDrhbjrk5zsnZggc29ydF9vcmRlciDqs4TsgrBcbiAgbGV0IHNvcnRPcmRlciA9IDA7XG4gIGlmIChyZXF1ZXN0LnBhcmVudElkICE9PSBudWxsICYmIHJlcXVlc3QucGFyZW50SWQgIT09IHVuZGVmaW5lZCkge1xuICAgIGNvbnN0IHNpYmxpbmdzID0gYXdhaXQgcGdDbGllbnQucXVlcnkoXG4gICAgICAnU0VMRUNUIHNvcnRfb3JkZXIgRlJPTSB0cmVlX25vZGVzIFdIRVJFIHBhcmVudF9pZCA9ICQxIE9SREVSIEJZIHNvcnRfb3JkZXIgREVTQyBMSU1JVCAxJyxcbiAgICAgIFtyZXF1ZXN0LnBhcmVudElkXVxuICAgICk7XG4gICAgaWYgKHNpYmxpbmdzLnJvd3MubGVuZ3RoID4gMCkge1xuICAgICAgc29ydE9yZGVyID0gc2libGluZ3Mucm93c1swXS5zb3J0X29yZGVyICsgMTtcbiAgICB9XG4gIH1cblxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBwZ0NsaWVudC5xdWVyeShcbiAgICAnSU5TRVJUIElOVE8gdHJlZV9ub2RlcyAobmFtZSwgdHlwZSwgcGFyZW50X2lkLCBzb3J0X29yZGVyLCBjcmVhdGVkX2J5KSBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSkgUkVUVVJOSU5HIConLFxuICAgIFtyZXF1ZXN0Lm5hbWUsIHJlcXVlc3QudHlwZSwgcmVxdWVzdC5wYXJlbnRJZCwgc29ydE9yZGVyLCByZXF1ZXN0LmNyZWF0ZWRCeV1cbiAgKTtcblxuICBjb25zdCByb3cgPSByZXN1bHQucm93c1swXTtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIHR5cGU6IHJvdy50eXBlLFxuICAgIHBhcmVudElkOiByb3cucGFyZW50X2lkLFxuICAgIHNvcnRPcmRlcjogcm93LnNvcnRfb3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZF9hdCxcbiAgICB1cGRhdGVkQXQ6IHJvdy51cGRhdGVkX2F0LFxuICAgIGNyZWF0ZWRCeTogcm93LmNyZWF0ZWRfYnlcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFRyZWVOb2RlQnlJZChpZDogbnVtYmVyKTogUHJvbWlzZTxUcmVlTm9kZSB8IG51bGw+IHtcbiAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoJ1NFTEVDVCAqIEZST00gdHJlZV9ub2RlcyBXSEVSRSBpZCA9ICQxJywgW2lkXSk7XG4gIFxuICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCByb3cgPSByZXN1bHQucm93c1swXTtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIHR5cGU6IHJvdy50eXBlLFxuICAgIHBhcmVudElkOiByb3cucGFyZW50X2lkLFxuICAgIHNvcnRPcmRlcjogcm93LnNvcnRfb3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZF9hdCxcbiAgICB1cGRhdGVkQXQ6IHJvdy51cGRhdGVkX2F0LFxuICAgIGNyZWF0ZWRCeTogcm93LmNyZWF0ZWRfYnlcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFsbFRyZWVOb2RlcygpOiBQcm9taXNlPFRyZWVOb2RlW10+IHtcbiAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoJ1NFTEVDVCAqIEZST00gdHJlZV9ub2RlcyBPUkRFUiBCWSBzb3J0X29yZGVyLCBuYW1lJyk7XG4gIFxuICByZXR1cm4gcmVzdWx0LnJvd3MubWFwKChyb3c6IGFueSkgPT4gKHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIHR5cGU6IHJvdy50eXBlLFxuICAgIHBhcmVudElkOiByb3cucGFyZW50X2lkLFxuICAgIHNvcnRPcmRlcjogcm93LnNvcnRfb3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZF9hdCxcbiAgICB1cGRhdGVkQXQ6IHJvdy51cGRhdGVkX2F0LFxuICAgIGNyZWF0ZWRCeTogcm93LmNyZWF0ZWRfYnlcbiAgfSkpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VHJlZVN0cnVjdHVyZSgpOiBQcm9taXNlPFRyZWVOb2RlW10+IHtcbiAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICB9XG5cbiAgLy8g66qo65OgIOuFuOuTnCDsobDtmoxcbiAgY29uc3QgYWxsTm9kZXMgPSBhd2FpdCBnZXRBbGxUcmVlTm9kZXMoKTtcbiAgXG4gIC8vIO2FjOyKpO2KuOy8gOydtOyKpCDsiJgg6rOE7IKwXG4gIGNvbnN0IHRlc3RDYXNlQ291bnRzID0gYXdhaXQgcGdDbGllbnQucXVlcnkoYFxuICAgIFNFTEVDVCBwYXJlbnRfaWQsIENPVU5UKCopIGFzIGNvdW50IFxuICAgIEZST00gdHJlZV9ub2RlcyBcbiAgICBXSEVSRSB0eXBlID0gJ3Rlc3RjYXNlJyBcbiAgICBHUk9VUCBCWSBwYXJlbnRfaWRcbiAgYCk7XG4gIFxuICBjb25zdCBjb3VudE1hcCA9IG5ldyBNYXA8bnVtYmVyLCBudW1iZXI+KCk7XG4gIHRlc3RDYXNlQ291bnRzLnJvd3MuZm9yRWFjaCgocm93OiBhbnkpID0+IHtcbiAgICBjb3VudE1hcC5zZXQocm93LnBhcmVudF9pZCwgcGFyc2VJbnQocm93LmNvdW50KSk7XG4gIH0pO1xuXG4gIC8vIO2KuOumrCDqtazsobAg7IOd7ISxXG4gIGNvbnN0IG5vZGVNYXAgPSBuZXcgTWFwPG51bWJlciwgVHJlZU5vZGU+KCk7XG4gIGNvbnN0IHJvb3ROb2RlczogVHJlZU5vZGVbXSA9IFtdO1xuXG4gIC8vIOuovOyggCDrqqjrk6Ag64W465Oc66W8IOunteyXkCDstpTqsIBcbiAgYWxsTm9kZXMuZm9yRWFjaChub2RlID0+IHtcbiAgICBjb25zdCB0cmVlTm9kZTogVHJlZU5vZGUgPSB7XG4gICAgICAuLi5ub2RlLFxuICAgICAgY2hpbGRyZW46IFtdLFxuICAgICAgdGVzdGNhc2VDb3VudDogY291bnRNYXAuZ2V0KG5vZGUuaWQpIHx8IDBcbiAgICB9O1xuICAgIG5vZGVNYXAuc2V0KG5vZGUuaWQsIHRyZWVOb2RlKTtcbiAgfSk7XG5cbiAgLy8g67aA66qoLeyekOyLnSDqtIDqs4Qg6rWs7ISxXG4gIGFsbE5vZGVzLmZvckVhY2gobm9kZSA9PiB7XG4gICAgY29uc3QgdHJlZU5vZGUgPSBub2RlTWFwLmdldChub2RlLmlkKSE7XG4gICAgXG4gICAgaWYgKG5vZGUucGFyZW50SWQgJiYgbm9kZS5wYXJlbnRJZCAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgcGFyZW50ID0gbm9kZU1hcC5nZXQobm9kZS5wYXJlbnRJZCk7XG4gICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgIHBhcmVudC5jaGlsZHJlbiEucHVzaCh0cmVlTm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByb290Tm9kZXMucHVzaCh0cmVlTm9kZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvb3ROb2Rlcy5wdXNoKHRyZWVOb2RlKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiByb290Tm9kZXM7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVUcmVlTm9kZShpZDogbnVtYmVyLCB1cGRhdGVzOiBVcGRhdGVUcmVlTm9kZVJlcXVlc3QpOiBQcm9taXNlPFRyZWVOb2RlIHwgbnVsbD4ge1xuICBjb25zdCBwZ0NsaWVudCA9IGdldFBnQ2xpZW50KCk7XG4gIGlmICghcGdDbGllbnQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1Bvc3RncmVTUUwg7YG065287J207Ja47Yq46rCAIOy0iOq4sO2ZlOuQmOyngCDslYrslZjsirXri4jri6QuJyk7XG4gIH1cblxuICBjb25zdCBzZXRDbGF1c2VzOiBzdHJpbmdbXSA9IFtdO1xuICBjb25zdCB2YWx1ZXM6IGFueVtdID0gW107XG4gIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICBpZiAodXBkYXRlcy5uYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICBzZXRDbGF1c2VzLnB1c2goYG5hbWUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgdmFsdWVzLnB1c2godXBkYXRlcy5uYW1lKTtcbiAgfVxuXG4gIGlmICh1cGRhdGVzLnBhcmVudElkICE9PSB1bmRlZmluZWQpIHtcbiAgICBzZXRDbGF1c2VzLnB1c2goYHBhcmVudF9pZCA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLnBhcmVudElkKTtcbiAgfVxuXG4gIGlmICh1cGRhdGVzLnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgc2V0Q2xhdXNlcy5wdXNoKGBzb3J0X29yZGVyID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMuc29ydE9yZGVyKTtcbiAgfVxuXG4gIGlmIChzZXRDbGF1c2VzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBnZXRUcmVlTm9kZUJ5SWQoaWQpO1xuICB9XG5cbiAgdmFsdWVzLnB1c2goaWQpO1xuICBjb25zdCBxdWVyeSA9IGBVUERBVEUgdHJlZV9ub2RlcyBTRVQgJHtzZXRDbGF1c2VzLmpvaW4oJywgJyl9IFdIRVJFIGlkID0gJCR7cGFyYW1JbmRleH0gUkVUVVJOSU5HICpgO1xuICBcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkocXVlcnksIHZhbHVlcyk7XG4gIFxuICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCByb3cgPSByZXN1bHQucm93c1swXTtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIHR5cGU6IHJvdy50eXBlLFxuICAgIHBhcmVudElkOiByb3cucGFyZW50X2lkLFxuICAgIHNvcnRPcmRlcjogcm93LnNvcnRfb3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZF9hdCxcbiAgICB1cGRhdGVkQXQ6IHJvdy51cGRhdGVkX2F0LFxuICAgIGNyZWF0ZWRCeTogcm93LmNyZWF0ZWRfYnlcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVRyZWVOb2RlKGlkOiBudW1iZXIpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoJ0RFTEVURSBGUk9NIHRyZWVfbm9kZXMgV0hFUkUgaWQgPSAkMSBSRVRVUk5JTkcgaWQnLCBbaWRdKTtcbiAgcmV0dXJuIHJlc3VsdC5yb3dzLmxlbmd0aCA+IDA7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDqsoDsg4kg7ZWo7IiYXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VhcmNoVHJlZU5vZGVzKHJlcXVlc3Q6IFRyZWVTZWFyY2hSZXF1ZXN0KTogUHJvbWlzZTxUcmVlU2VhcmNoUmVzdWx0PiB7XG4gIGNvbnN0IHBnQ2xpZW50ID0gZ2V0UGdDbGllbnQoKTtcbiAgaWYgKCFwZ0NsaWVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcignUG9zdGdyZVNRTCDtgbTrnbzsnbTslrjtirjqsIAg7LSI6riw7ZmU65CY7KeAIOyViuyVmOyKteuLiOuLpC4nKTtcbiAgfVxuXG4gIGxldCBxdWVyeSA9ICdTRUxFQ1QgKiBGUk9NIHRyZWVfbm9kZXMgV0hFUkUgMT0xJztcbiAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICBsZXQgcGFyYW1JbmRleCA9IDE7XG5cbiAgaWYgKHJlcXVlc3QucXVlcnkpIHtcbiAgICBxdWVyeSArPSBgIEFORCBuYW1lIElMSUtFICQke3BhcmFtSW5kZXgrK31gO1xuICAgIHZhbHVlcy5wdXNoKGAlJHtyZXF1ZXN0LnF1ZXJ5fSVgKTtcbiAgfVxuXG4gIGlmIChyZXF1ZXN0LnR5cGUpIHtcbiAgICBxdWVyeSArPSBgIEFORCB0eXBlID0gJCR7cGFyYW1JbmRleCsrfWA7XG4gICAgdmFsdWVzLnB1c2gocmVxdWVzdC50eXBlKTtcbiAgfVxuXG4gIGlmIChyZXF1ZXN0LnBhcmVudElkICE9PSB1bmRlZmluZWQpIHtcbiAgICBxdWVyeSArPSBgIEFORCBwYXJlbnRfaWQgPSAkJHtwYXJhbUluZGV4Kyt9YDtcbiAgICB2YWx1ZXMucHVzaChyZXF1ZXN0LnBhcmVudElkKTtcbiAgfVxuXG4gIHF1ZXJ5ICs9ICcgT1JERVIgQlkgc29ydF9vcmRlciwgbmFtZSc7XG5cbiAgaWYgKHJlcXVlc3QubGltaXQpIHtcbiAgICBxdWVyeSArPSBgIExJTUlUICQke3BhcmFtSW5kZXgrK31gO1xuICAgIHZhbHVlcy5wdXNoKHJlcXVlc3QubGltaXQpO1xuICB9XG5cbiAgaWYgKHJlcXVlc3Qub2Zmc2V0KSB7XG4gICAgcXVlcnkgKz0gYCBPRkZTRVQgJCR7cGFyYW1JbmRleCsrfWA7XG4gICAgdmFsdWVzLnB1c2gocmVxdWVzdC5vZmZzZXQpO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkocXVlcnksIHZhbHVlcyk7XG4gIFxuICBjb25zdCBub2RlcyA9IHJlc3VsdC5yb3dzLm1hcCgocm93OiBhbnkpID0+ICh7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICB0eXBlOiByb3cudHlwZSxcbiAgICBwYXJlbnRJZDogcm93LnBhcmVudF9pZCxcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0X29yZGVyLFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRfYXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZF9hdCxcbiAgICBjcmVhdGVkQnk6IHJvdy5jcmVhdGVkX2J5XG4gIH0pKTtcblxuICAvLyDsoITssrQg6rCc7IiYIOyhsO2ajFxuICBsZXQgY291bnRRdWVyeSA9ICdTRUxFQ1QgQ09VTlQoKikgRlJPTSB0cmVlX25vZGVzIFdIRVJFIDE9MSc7XG4gIGNvbnN0IGNvdW50VmFsdWVzOiBhbnlbXSA9IFtdO1xuICBsZXQgY291bnRQYXJhbUluZGV4ID0gMTtcblxuICBpZiAocmVxdWVzdC5xdWVyeSkge1xuICAgIGNvdW50UXVlcnkgKz0gYCBBTkQgbmFtZSBJTElLRSAkJHtjb3VudFBhcmFtSW5kZXgrK31gO1xuICAgIGNvdW50VmFsdWVzLnB1c2goYCUke3JlcXVlc3QucXVlcnl9JWApO1xuICB9XG5cbiAgaWYgKHJlcXVlc3QudHlwZSkge1xuICAgIGNvdW50UXVlcnkgKz0gYCBBTkQgdHlwZSA9ICQke2NvdW50UGFyYW1JbmRleCsrfWA7XG4gICAgY291bnRWYWx1ZXMucHVzaChyZXF1ZXN0LnR5cGUpO1xuICB9XG5cbiAgaWYgKHJlcXVlc3QucGFyZW50SWQgIT09IHVuZGVmaW5lZCkge1xuICAgIGNvdW50UXVlcnkgKz0gYCBBTkQgcGFyZW50X2lkID0gJCR7Y291bnRQYXJhbUluZGV4Kyt9YDtcbiAgICBjb3VudFZhbHVlcy5wdXNoKHJlcXVlc3QucGFyZW50SWQpO1xuICB9XG5cbiAgY29uc3QgY291bnRSZXN1bHQgPSBhd2FpdCBwZ0NsaWVudC5xdWVyeShjb3VudFF1ZXJ5LCBjb3VudFZhbHVlcyk7XG4gIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQoY291bnRSZXN1bHQucm93c1swXS5jb3VudCk7XG5cbiAgcmV0dXJuIHsgbm9kZXMsIHRvdGFsIH07XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDrk5zrnpjqt7gg7JWkIOuTnOuhrSDqtIDroKgg7ZWo7IiYXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbW92ZVRyZWVOb2RlKG5vZGVJZDogbnVtYmVyLCBuZXdQYXJlbnRJZDogbnVtYmVyIHwgbnVsbCk6IFByb21pc2U8VHJlZU5vZGUgfCBudWxsPiB7XG4gIGNvbnN0IHBnQ2xpZW50ID0gZ2V0UGdDbGllbnQoKTtcbiAgaWYgKCFwZ0NsaWVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcignUG9zdGdyZVNRTCDtgbTrnbzsnbTslrjtirjqsIAg7LSI6riw7ZmU65CY7KeAIOyViuyVmOyKteuLiOuLpC4nKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgYXdhaXQgcGdDbGllbnQucXVlcnkoJ0JFR0lOJyk7XG5cbiAgICAvLyDsg4gg67aA66qo7J2YIOy1nOuMgCDsiJzshJwg7KGw7ZqMXG4gICAgbGV0IG5ld1NvcnRPcmRlciA9IDA7XG4gICAgaWYgKG5ld1BhcmVudElkICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBtYXhTb3J0UmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoXG4gICAgICAgICdTRUxFQ1QgQ09BTEVTQ0UoTUFYKHNvcnRfb3JkZXIpLCAwKSBhcyBtYXhfc29ydCBGUk9NIHRyZWVfbm9kZXMgV0hFUkUgcGFyZW50X2lkID0gJDEnLFxuICAgICAgICBbbmV3UGFyZW50SWRdXG4gICAgICApO1xuICAgICAgbmV3U29ydE9yZGVyID0gbWF4U29ydFJlc3VsdC5yb3dzWzBdLm1heF9zb3J0ICsgMTtcbiAgICB9XG5cbiAgICAvLyDrhbjrk5wg7J2064+ZXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoXG4gICAgICAnVVBEQVRFIHRyZWVfbm9kZXMgU0VUIHBhcmVudF9pZCA9ICQxLCBzb3J0X29yZGVyID0gJDIgV0hFUkUgaWQgPSAkMyBSRVRVUk5JTkcgKicsXG4gICAgICBbbmV3UGFyZW50SWQsIG5ld1NvcnRPcmRlciwgbm9kZUlkXVxuICAgICk7XG5cbiAgICBhd2FpdCBwZ0NsaWVudC5xdWVyeSgnQ09NTUlUJyk7XG4gICAgXG4gICAgaWYgKHJlc3VsdC5yb3dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3Qgcm93ID0gcmVzdWx0LnJvd3NbMF07XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiByb3cuaWQsXG4gICAgICBuYW1lOiByb3cubmFtZSxcbiAgICAgIHR5cGU6IHJvdy50eXBlLFxuICAgICAgcGFyZW50SWQ6IHJvdy5wYXJlbnRfaWQsXG4gICAgICBzb3J0T3JkZXI6IHJvdy5zb3J0X29yZGVyLFxuICAgICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZF9hdCxcbiAgICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRfYXQsXG4gICAgICBjcmVhdGVkQnk6IHJvdy5jcmVhdGVkX2J5XG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBhd2FpdCBwZ0NsaWVudC5xdWVyeSgnUk9MTEJBQ0snKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVvcmRlclRyZWVOb2RlKG5vZGVJZDogbnVtYmVyLCB0YXJnZXROb2RlSWQ6IG51bWJlciwgcG9zaXRpb246ICdiZWZvcmUnIHwgJ2FmdGVyJyk6IFByb21pc2U8VHJlZU5vZGUgfCBudWxsPiB7XG4gIGNvbnN0IHBnQ2xpZW50ID0gZ2V0UGdDbGllbnQoKTtcbiAgaWYgKCFwZ0NsaWVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcignUG9zdGdyZVNRTCDtgbTrnbzsnbTslrjtirjqsIAg7LSI6riw7ZmU65CY7KeAIOyViuyVmOyKteuLiOuLpC4nKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgYXdhaXQgcGdDbGllbnQucXVlcnkoJ0JFR0lOJyk7XG5cbiAgICAvLyDtmITsnqwg64W465Oc7JmAIOuMgOyDgSDrhbjrk5wg7KCV67O0IOyhsO2ajFxuICAgIGNvbnN0IGRyYWdnZWROb2RlID0gYXdhaXQgZ2V0VHJlZU5vZGVCeUlkKG5vZGVJZCk7XG4gICAgY29uc3QgdGFyZ2V0Tm9kZSA9IGF3YWl0IGdldFRyZWVOb2RlQnlJZCh0YXJnZXROb2RlSWQpO1xuXG4gICAgaWYgKCFkcmFnZ2VkTm9kZSB8fCAhdGFyZ2V0Tm9kZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCfrhbjrk5zrpbwg7LC+7J2EIOyImCDsl4bsirXri4jri6QuJyk7XG4gICAgfVxuXG4gICAgLy8g6rCZ7J2AIOu2gOuqqCDrhbjrk5wg64K07JeQ7ISc66eMIOyInOyEnCDrs4Dqsr0g6rCA64qlXG4gICAgaWYgKGRyYWdnZWROb2RlLnBhcmVudElkICE9PSB0YXJnZXROb2RlLnBhcmVudElkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+qwmeydgCDrtoDrqqgg64W465OcIOuCtOyXkOyEnOunjCDsiJzshJwg67OA6rK97J20IOqwgOuKpe2VqeuLiOuLpC4nKTtcbiAgICB9XG5cbiAgICAvLyDrjIDsg4Eg64W465Oc7J2YIO2YhOyerCDsiJzshJwg7KGw7ZqMXG4gICAgY29uc3QgdGFyZ2V0U29ydE9yZGVyID0gdGFyZ2V0Tm9kZS5zb3J0T3JkZXI7XG5cbiAgICAvLyDsg4jroZzsmrQg7Iic7IScIOqzhOyCsFxuICAgIGxldCBuZXdTb3J0T3JkZXI6IG51bWJlcjtcbiAgICBpZiAocG9zaXRpb24gPT09ICdiZWZvcmUnKSB7XG4gICAgICBuZXdTb3J0T3JkZXIgPSB0YXJnZXRTb3J0T3JkZXI7XG4gICAgICAvLyDrjIDsg4Eg64W465Oc7JmAIOq3uCDsnbTtm4Qg64W465Oc65Ok7J2YIOyInOyEnOulvCAx7JSpIOymneqwgFxuICAgICAgYXdhaXQgcGdDbGllbnQucXVlcnkoXG4gICAgICAgICdVUERBVEUgdHJlZV9ub2RlcyBTRVQgc29ydF9vcmRlciA9IHNvcnRfb3JkZXIgKyAxIFdIRVJFIHBhcmVudF9pZCA9ICQxIEFORCBzb3J0X29yZGVyID49ICQyJyxcbiAgICAgICAgW3RhcmdldE5vZGUucGFyZW50SWQsIHRhcmdldFNvcnRPcmRlcl1cbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5ld1NvcnRPcmRlciA9IHRhcmdldFNvcnRPcmRlciArIDE7XG4gICAgICAvLyDrjIDsg4Eg64W465OcIOydtO2bhCDrhbjrk5zrk6TsnZgg7Iic7ISc66W8IDHslKkg7Kad6rCAXG4gICAgICBhd2FpdCBwZ0NsaWVudC5xdWVyeShcbiAgICAgICAgJ1VQREFURSB0cmVlX25vZGVzIFNFVCBzb3J0X29yZGVyID0gc29ydF9vcmRlciArIDEgV0hFUkUgcGFyZW50X2lkID0gJDEgQU5EIHNvcnRfb3JkZXIgPiAkMicsXG4gICAgICAgIFt0YXJnZXROb2RlLnBhcmVudElkLCB0YXJnZXRTb3J0T3JkZXJdXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIOuTnOuemOq3uO2VnCDrhbjrk5zsnZgg7Iic7IScIOyXheuNsOydtO2KuFxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KFxuICAgICAgJ1VQREFURSB0cmVlX25vZGVzIFNFVCBzb3J0X29yZGVyID0gJDEgV0hFUkUgaWQgPSAkMiBSRVRVUk5JTkcgKicsXG4gICAgICBbbmV3U29ydE9yZGVyLCBub2RlSWRdXG4gICAgKTtcblxuICAgIGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KCdDT01NSVQnKTtcbiAgICBcbiAgICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCByb3cgPSByZXN1bHQucm93c1swXTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IHJvdy5pZCxcbiAgICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgICAgdHlwZTogcm93LnR5cGUsXG4gICAgICBwYXJlbnRJZDogcm93LnBhcmVudF9pZCxcbiAgICAgIHNvcnRPcmRlcjogcm93LnNvcnRfb3JkZXIsXG4gICAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkX2F0LFxuICAgICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZF9hdCxcbiAgICAgIGNyZWF0ZWRCeTogcm93LmNyZWF0ZWRfYnlcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KCdST0xMQkFDSycpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDsnKDtmqjshLEg6rKA7IKsIO2VqOyImFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrQ2lyY3VsYXJSZWZlcmVuY2Uobm9kZUlkOiBudW1iZXIsIG5ld1BhcmVudElkOiBudW1iZXIpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICB9XG5cbiAgLy8g7J6Q6riwIOyekOyLoOydhCDrtoDrqqjroZwg7ISk7KCV7ZWY64qUIOqyveyasFxuICBpZiAobm9kZUlkID09PSBuZXdQYXJlbnRJZCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8g67CY67O166y47Jy866GcIOyInO2ZmCDssLjsobAg6rKA7IKsICjsnqzqt4Ag64yA7IugKVxuICBjb25zdCB2aXNpdGVkID0gbmV3IFNldDxudW1iZXI+KCk7XG4gIGxldCBjdXJyZW50SWQgPSBuZXdQYXJlbnRJZDtcblxuICB3aGlsZSAoY3VycmVudElkICE9PSBudWxsKSB7XG4gICAgLy8g7J2066+4IOuwqeusuO2VnCBJROqwgCDsnojri6TrqbQg7Iic7ZmYIOywuOyhsFxuICAgIGlmICh2aXNpdGVkLmhhcyhjdXJyZW50SWQpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICB2aXNpdGVkLmFkZChjdXJyZW50SWQpO1xuXG4gICAgLy8g7ZiE7J6sIElE6rCAIOydtOuPme2VmOugpOuKlCDrhbjrk5zsmYAg6rCZ64uk66m0IOyInO2ZmCDssLjsobBcbiAgICBpZiAoY3VycmVudElkID09PSBub2RlSWQpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIOu2gOuqqCBJRCDsobDtmoxcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwZ0NsaWVudC5xdWVyeSgnU0VMRUNUIHBhcmVudF9pZCBGUk9NIHRyZWVfbm9kZXMgV0hFUkUgaWQgPSAkMScsIFtjdXJyZW50SWRdKTtcbiAgICBjb25zdCBwYXJlbnRJZCA9IHJlc3VsdC5yb3dzWzBdPy5wYXJlbnRfaWQ7XG5cbiAgICBpZiAoIXBhcmVudElkKSB7XG4gICAgICBicmVhazsgLy8g66Oo7Yq47JeQIOuPhOuLrFxuICAgIH1cblxuICAgIGN1cnJlbnRJZCA9IHBhcmVudElkO1xuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g7Z6I7Iqk7Yag66asIOq0gOugqCDtlajsiJhcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWNvcmRUcmVlTm9kZU1vdmUoaGlzdG9yeToge1xuICBub2RlSWQ6IG51bWJlcjtcbiAgb2xkUGFyZW50SWQ6IG51bWJlciB8IG51bGw7XG4gIG5ld1BhcmVudElkOiBudW1iZXIgfCBudWxsO1xuICBvbGRTb3J0T3JkZXI6IG51bWJlcjtcbiAgbmV3U29ydE9yZGVyOiBudW1iZXI7XG4gIG1vdmVkQnk6IHN0cmluZztcbn0pOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICB9XG5cbiAgYXdhaXQgcGdDbGllbnQucXVlcnkoXG4gICAgJ0lOU0VSVCBJTlRPIHRyZWVfbm9kZV9tb3ZlX2hpc3RvcnkgKG5vZGVfaWQsIG9sZF9wYXJlbnRfaWQsIG5ld19wYXJlbnRfaWQsIG9sZF9zb3J0X29yZGVyLCBuZXdfc29ydF9vcmRlciwgbW92ZWRfYnkpIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNiknLFxuICAgIFtoaXN0b3J5Lm5vZGVJZCwgaGlzdG9yeS5vbGRQYXJlbnRJZCwgaGlzdG9yeS5uZXdQYXJlbnRJZCwgaGlzdG9yeS5vbGRTb3J0T3JkZXIsIGhpc3RvcnkubmV3U29ydE9yZGVyLCBoaXN0b3J5Lm1vdmVkQnldXG4gICk7XG59ICJdLCJ2ZXJzaW9uIjozfQ==