fa592f12a84597fa11fdf4903c49289e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.executionRepository = void 0;
const pgClient_1 = require("../../../infrastructure/database/pgClient");
exports.executionRepository = {
    async insert(execution) {
        await (0, pgClient_1.ensurePgConnected)();
        const pgClient = (0, pgClient_1.getPgClient)();
        if (!pgClient) {
            throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
        }
        const now = new Date();
        const result = await pgClient.query(`INSERT INTO executions 
                (testcase_id, suite_id, release_id, status, executed_by, executed_at, repro_steps, screenshot_path, log_file_path, comment, created_at, updated_at)
             VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12)
             RETURNING *`, [
            execution.testcaseId,
            execution.suiteId ?? null,
            execution.releaseId ?? null,
            execution.status,
            execution.executedBy,
            execution.executedAt,
            execution.reproSteps ?? null,
            execution.screenshotPath ?? null,
            execution.logFilePath ?? null,
            execution.comment ?? null,
            now,
            now
        ]);
        return mapRowToExecution(result.rows[0]);
    },
    async findById(id) {
        await (0, pgClient_1.ensurePgConnected)();
        const pgClient = (0, pgClient_1.getPgClient)();
        if (!pgClient) {
            throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
        }
        const result = await pgClient.query('SELECT * FROM executions WHERE id = $1', [id]);
        return result.rows[0] ? mapRowToExecution(result.rows[0]) : null;
    },
    async findByTestCase(testcaseId) {
        await (0, pgClient_1.ensurePgConnected)();
        const pgClient = (0, pgClient_1.getPgClient)();
        if (!pgClient) {
            throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
        }
        const result = await pgClient.query('SELECT * FROM executions WHERE testcase_id = $1', [testcaseId]);
        return result.rows.map(mapRowToExecution);
    },
    async update(id, update) {
        await (0, pgClient_1.ensurePgConnected)();
        const pgClient = (0, pgClient_1.getPgClient)();
        if (!pgClient) {
            throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
        }
        // 동적 쿼리 빌드(간단화)
        const fields = Object.keys(update);
        if (fields.length === 0)
            return this.findById(id);
        const setClause = fields.map((f, i) => `${toSnakeCase(f)} = $${i + 1}`).join(', ');
        const values = fields.map(f => update[f]);
        values.push(new Date()); // updated_at
        const result = await pgClient.query(`UPDATE executions SET ${setClause}, updated_at = $${fields.length + 1} WHERE id = $${fields.length + 2} RETURNING *`, [...values, id]);
        return result.rows[0] ? mapRowToExecution(result.rows[0]) : null;
    },
    async delete(id) {
        await (0, pgClient_1.ensurePgConnected)();
        const pgClient = (0, pgClient_1.getPgClient)();
        if (!pgClient) {
            throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
        }
        await pgClient.query('DELETE FROM executions WHERE id = $1', [id]);
    }
};
function mapRowToExecution(row) {
    return {
        id: row.id,
        testcaseId: row.testcase_id,
        suiteId: row.suite_id,
        releaseId: row.release_id,
        status: row.status,
        executedBy: row.executed_by,
        executedAt: row.executed_at,
        reproSteps: row.repro_steps,
        screenshotPath: row.screenshot_path,
        logFilePath: row.log_file_path,
        comment: row.comment,
        createdAt: row.created_at,
        updatedAt: row.updated_at
    };
}
function toSnakeCase(str) {
    return str.replace(/[A-Z]/g, letter => `_${letter.toLowerCase()}`);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvZG9tYWlucy9leGVjdXRpb25zL3JlcG9zaXRvcmllcy9leGVjdXRpb25SZXBvc2l0b3J5LnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLHdFQUEyRjtBQUU5RSxRQUFBLG1CQUFtQixHQUFHO0lBQy9CLEtBQUssQ0FBQyxNQUFNLENBQUMsU0FBNEQ7UUFDckUsTUFBTSxJQUFBLDRCQUFpQixHQUFFLENBQUM7UUFDMUIsTUFBTSxRQUFRLEdBQUcsSUFBQSxzQkFBVyxHQUFFLENBQUM7UUFDL0IsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ1osTUFBTSxJQUFJLEtBQUssQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1FBQ3RELENBQUM7UUFDRCxNQUFNLEdBQUcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3ZCLE1BQU0sTUFBTSxHQUFHLE1BQU0sUUFBUSxDQUFDLEtBQUssQ0FDL0I7Ozt5QkFHYSxFQUNiO1lBQ0ksU0FBUyxDQUFDLFVBQVU7WUFDcEIsU0FBUyxDQUFDLE9BQU8sSUFBSSxJQUFJO1lBQ3pCLFNBQVMsQ0FBQyxTQUFTLElBQUksSUFBSTtZQUMzQixTQUFTLENBQUMsTUFBTTtZQUNoQixTQUFTLENBQUMsVUFBVTtZQUNwQixTQUFTLENBQUMsVUFBVTtZQUNwQixTQUFTLENBQUMsVUFBVSxJQUFJLElBQUk7WUFDNUIsU0FBUyxDQUFDLGNBQWMsSUFBSSxJQUFJO1lBQ2hDLFNBQVMsQ0FBQyxXQUFXLElBQUksSUFBSTtZQUM3QixTQUFTLENBQUMsT0FBTyxJQUFJLElBQUk7WUFDekIsR0FBRztZQUNILEdBQUc7U0FDTixDQUNKLENBQUM7UUFDRixPQUFPLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFVO1FBQ3JCLE1BQU0sSUFBQSw0QkFBaUIsR0FBRSxDQUFD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WUFDWixNQUFNLElBQUksS0FBSyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7UUFDdEQsQ0FBQztRQUNELE1BQU0sUUFBUSxDQUFDLEtBQUssQ0FBQyxzQ0FBc0MsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDdkUsQ0FBQztDQUNKLENBQUM7QUFFRixTQUFTLGlCQUFpQixDQUFDLEdBQVE7SUFDL0IsT0FBTztRQUNILEVBQUUsRUFBRSxHQUFHLENBQUMsRUFBRTtRQUNWLFVBQVUsRUFBRSxHQUFHLENBQUMsV0FBVztRQUMzQixPQUFPLEVBQUUsR0FBRyxDQUFDLFFBQVE7UUFDckIsU0FBUyxFQUFFLEdBQUcsQ0FBQyxVQUFVO1FBQ3pCLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTTtRQUNsQixVQUFVLEVBQUUsR0FBRyxDQUFDLFdBQVc7UUFDM0IsVUFBVSxFQUFFLEdBQUcsQ0FBQyxXQUFXO1FBQzNCLFVBQVUsRUFBRSxHQUFHLENBQUMsV0FBVztRQUMzQixjQUFjLEVBQUUsR0FBRyxDQUFDLGVBQWU7UUFDbkMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxhQUFhO1FBQzlCLE9BQU8sRUFBRSxHQUFHLENBQUMsT0FBTztRQUNwQixTQUFTLEVBQUUsR0FBRyxDQUFDLFVBQVU7UUFDekIsU0FBUyxFQUFFLEdBQUcsQ0FBQyxVQUFVO0tBQzVCLENBQUM7QUFDTixDQUFDO0FBRUQsU0FBUyxXQUFXLENBQUMsR0FBVztJQUM1QixPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxNQUFNLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZFLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvZG9tYWlucy9leGVjdXRpb25zL3JlcG9zaXRvcmllcy9leGVjdXRpb25SZXBvc2l0b3J5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV4ZWN1dGlvbiB9IGZyb20gJy4uL21vZGVscy9FeGVjdXRpb24nO1xuaW1wb3J0IHsgZ2V0UGdDbGllbnQsIGVuc3VyZVBnQ29ubmVjdGVkIH0gZnJvbSAnLi4vLi4vLi4vaW5mcmFzdHJ1Y3R1cmUvZGF0YWJhc2UvcGdDbGllbnQnO1xuXG5leHBvcnQgY29uc3QgZXhlY3V0aW9uUmVwb3NpdG9yeSA9IHtcbiAgICBhc3luYyBpbnNlcnQoZXhlY3V0aW9uOiBPbWl0PEV4ZWN1dGlvbiwgJ2lkJyB8ICdjcmVhdGVkQXQnIHwgJ3VwZGF0ZWRBdCc+KTogUHJvbWlzZTxFeGVjdXRpb24+IHtcbiAgICAgICAgYXdhaXQgZW5zdXJlUGdDb25uZWN0ZWQoKTtcbiAgICAgICAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICAgICAgICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Bvc3RncmVTUUwg7YG065287J207Ja47Yq46rCAIOy0iOq4sO2ZlOuQmOyngCDslYrslZjsirXri4jri6QuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoXG4gICAgICAgICAgICBgSU5TRVJUIElOVE8gZXhlY3V0aW9ucyBcbiAgICAgICAgICAgICAgICAodGVzdGNhc2VfaWQsIHN1aXRlX2lkLCByZWxlYXNlX2lkLCBzdGF0dXMsIGV4ZWN1dGVkX2J5LCBleGVjdXRlZF9hdCwgcmVwcm9fc3RlcHMsIHNjcmVlbnNob3RfcGF0aCwgbG9nX2ZpbGVfcGF0aCwgY29tbWVudCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdClcbiAgICAgICAgICAgICBWQUxVRVMgKCQxLCQyLCQzLCQ0LCQ1LCQ2LCQ3LCQ4LCQ5LCQxMCwkMTEsJDEyKVxuICAgICAgICAgICAgIFJFVFVSTklORyAqYCxcbiAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICBleGVjdXRpb24udGVzdGNhc2VJZCxcbiAgICAgICAgICAgICAgICBleGVjdXRpb24uc3VpdGVJZCA/PyBudWxsLFxuICAgICAgICAgICAgICAgIGV4ZWN1dGlvbi5yZWxlYXNlSWQgPz8gbnVsbCxcbiAgICAgICAgICAgICAgICBleGVjdXRpb24uc3RhdHVzLFxuICAgICAgICAgICAgICAgIGV4ZWN1dGlvbi5leGVjdXRlZEJ5LFxuICAgICAgICAgICAgICAgIGV4ZWN1dGlvbi5leGVjdXRlZEF0LFxuICAgICAgICAgICAgICAgIGV4ZWN1dGlvbi5yZXByb1N0ZXBzID8/IG51bGwsXG4gICAgICAgICAgICAgICAgZXhlY3V0aW9uLnNjcmVlbnNob3RQYXRoID8/IG51bGwsXG4gICAgICAgICAgICAgICAgZXhlY3V0aW9uLmxvZ0ZpbGVQYXRoID8/IG51bGwsXG4gICAgICAgICAgICAgICAgZXhlY3V0aW9uLmNvbW1lbnQgPz8gbnVsbCxcbiAgICAgICAgICAgICAgICBub3csXG4gICAgICAgICAgICAgICAgbm93XG4gICAgICAgICAgICBdXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBtYXBSb3dUb0V4ZWN1dGlvbihyZXN1bHQucm93c1swXSk7XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmRCeUlkKGlkOiBudW1iZXIpOiBQcm9taXNlPEV4ZWN1dGlvbiB8IG51bGw+IHtcbiAgICAgICAgYXdhaXQgZW5zdXJlUGdDb25uZWN0ZWQoKTtcbiAgICAgICAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICAgICAgICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Bvc3RncmVTUUwg7YG065287J207Ja47Yq46rCAIOy0iOq4sO2ZlOuQmOyngCDslYrslZjsirXri4jri6QuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoJ1NFTEVDVCAqIEZST00gZXhlY3V0aW9ucyBXSEVSRSBpZCA9ICQxJywgW2lkXSk7XG4gICAgICAgIHJldHVybiByZXN1bHQucm93c1swXSA/IG1hcFJvd1RvRXhlY3V0aW9uKHJlc3VsdC5yb3dzWzBdKSA6IG51bGw7XG4gICAgfSxcblxuICAgIGFzeW5jIGZpbmRCeVRlc3RDYXNlKHRlc3RjYXNlSWQ6IG51bWJlcik6IFByb21pc2U8RXhlY3V0aW9uW10+IHtcbiAgICAgICAgYXdhaXQgZW5zdXJlUGdDb25uZWN0ZWQoKTtcbiAgICAgICAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICAgICAgICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Bvc3RncmVTUUwg7YG065287J207Ja47Yq46rCAIOy0iOq4sO2ZlOuQmOyngCDslYrslZjsirXri4jri6QuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoJ1NFTEVDVCAqIEZST00gZXhlY3V0aW9ucyBXSEVSRSB0ZXN0Y2FzZV9pZCA9ICQxJywgW3Rlc3RjYXNlSWRdKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzLm1hcChtYXBSb3dUb0V4ZWN1dGlvbik7XG4gICAgfSxcblxuICAgIGFzeW5jIHVwZGF0ZShpZDogbnVtYmVyLCB1cGRhdGU6IFBhcnRpYWw8T21pdDxFeGVjdXRpb24sICdpZCcgfCAnY3JlYXRlZEF0Jz4+KTogUHJvbWlzZTxFeGVjdXRpb24gfCBudWxsPiB7XG4gICAgICAgIGF3YWl0IGVuc3VyZVBnQ29ubmVjdGVkKCk7XG4gICAgICAgIGNvbnN0IHBnQ2xpZW50ID0gZ2V0UGdDbGllbnQoKTtcbiAgICAgICAgaWYgKCFwZ0NsaWVudCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICAgICAgICB9XG4gICAgICAgIC8vIOuPmeyggSDsv7zrpqwg67mM65OcKOqwhOuLqO2ZlClcbiAgICAgICAgY29uc3QgZmllbGRzID0gT2JqZWN0LmtleXModXBkYXRlKTtcbiAgICAgICAgaWYgKGZpZWxkcy5sZW5ndGggPT09IDApIHJldHVybiB0aGlzLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgY29uc3Qgc2V0Q2xhdXNlID0gZmllbGRzLm1hcCgoZiwgaSkgPT4gYCR7dG9TbmFrZUNhc2UoZil9ID0gJCR7aSArIDF9YCkuam9pbignLCAnKTtcbiAgICAgICAgY29uc3QgdmFsdWVzID0gZmllbGRzLm1hcChmID0+ICh1cGRhdGUgYXMgYW55KVtmXSk7XG4gICAgICAgIHZhbHVlcy5wdXNoKG5ldyBEYXRlKCkpOyAvLyB1cGRhdGVkX2F0XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KFxuICAgICAgICAgICAgYFVQREFURSBleGVjdXRpb25zIFNFVCAke3NldENsYXVzZX0sIHVwZGF0ZWRfYXQgPSAkJHtmaWVsZHMubGVuZ3RoICsgMX0gV0hFUkUgaWQgPSAkJHtmaWVsZHMubGVuZ3RoICsgMn0gUkVUVVJOSU5HICpgLFxuICAgICAgICAgICAgWy4uLnZhbHVlcywgaWRdXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiByZXN1bHQucm93c1swXSA/IG1hcFJvd1RvRXhlY3V0aW9uKHJlc3VsdC5yb3dzWzBdKSA6IG51bGw7XG4gICAgfSxcblxuICAgIGFzeW5jIGRlbGV0ZShpZDogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IGVuc3VyZVBnQ29ubmVjdGVkKCk7XG4gICAgICAgIGNvbnN0IHBnQ2xpZW50ID0gZ2V0UGdDbGllbnQoKTtcbiAgICAgICAgaWYgKCFwZ0NsaWVudCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KCdERUxFVEUgRlJPTSBleGVjdXRpb25zIFdIRVJFIGlkID0gJDEnLCBbaWRdKTtcbiAgICB9XG59O1xuXG5mdW5jdGlvbiBtYXBSb3dUb0V4ZWN1dGlvbihyb3c6IGFueSk6IEV4ZWN1dGlvbiB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IHJvdy5pZCxcbiAgICAgICAgdGVzdGNhc2VJZDogcm93LnRlc3RjYXNlX2lkLFxuICAgICAgICBzdWl0ZUlkOiByb3cuc3VpdGVfaWQsXG4gICAgICAgIHJlbGVhc2VJZDogcm93LnJlbGVhc2VfaWQsXG4gICAgICAgIHN0YXR1czogcm93LnN0YXR1cyxcbiAgICAgICAgZXhlY3V0ZWRCeTogcm93LmV4ZWN1dGVkX2J5LFxuICAgICAgICBleGVjdXRlZEF0OiByb3cuZXhlY3V0ZWRfYXQsXG4gICAgICAgIHJlcHJvU3RlcHM6IHJvdy5yZXByb19zdGVwcyxcbiAgICAgICAgc2NyZWVuc2hvdFBhdGg6IHJvdy5zY3JlZW5zaG90X3BhdGgsXG4gICAgICAgIGxvZ0ZpbGVQYXRoOiByb3cubG9nX2ZpbGVfcGF0aCxcbiAgICAgICAgY29tbWVudDogcm93LmNvbW1lbnQsXG4gICAgICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRfYXQsXG4gICAgICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRfYXRcbiAgICB9O1xufVxuXG5mdW5jdGlvbiB0b1NuYWtlQ2FzZShzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bQS1aXS9nLCBsZXR0ZXIgPT4gYF8ke2xldHRlci50b0xvd2VyQ2FzZSgpfWApO1xufSAiXSwidmVyc2lvbiI6M30=