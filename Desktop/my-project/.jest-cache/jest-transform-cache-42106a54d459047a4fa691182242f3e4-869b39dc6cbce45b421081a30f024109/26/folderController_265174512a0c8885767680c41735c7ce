21423eeddbc4fe2df5b62c4b4023a93e
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const folderService = __importStar(require("../services/folderService"));
const bulkController_1 = __importDefault(require("./bulkController"));
const router = (0, express_1.Router)();
// 일괄 작업 라우터 등록
router.use('/bulk', bulkController_1.default);
// 폴더 트리 조회
router.get('/tree', async (req, res) => {
    try {
        const tree = await folderService.getFolderTree();
        res.json(tree);
    }
    catch (error) {
        console.error('폴더 트리 조회 실패:', error);
        res.status(500).json({ message: '폴더 트리 조회에 실패했습니다.' });
    }
});
// 모든 폴더 조회
router.get('/', async (req, res) => {
    try {
        const folders = await folderService.getAllFolders();
        res.json(folders);
    }
    catch (error) {
        console.error('폴더 목록 조회 실패:', error);
        res.status(500).json({ message: '폴더 목록 조회에 실패했습니다.' });
    }
});
// 특정 폴더 조회
router.get('/:id', async (req, res) => {
    try {
        const folder = await folderService.getFolderById(Number(req.params.id));
        if (!folder) {
            return res.status(404).json({ message: '폴더를 찾을 수 없습니다.' });
        }
        res.json(folder);
    }
    catch (error) {
        console.error('폴더 조회 실패:', error);
        res.status(500).json({ message: '폴더 조회에 실패했습니다.' });
    }
});
// 폴더 생성
router.post('/', async (req, res) => {
    try {
        const request = {
            name: req.body.name,
            description: req.body.description,
            parentId: req.body.parentId,
            createdBy: req.body.createdBy || 'system'
        };
        const folder = await folderService.createFolder(request);
        res.status(201).json(folder);
    }
    catch (error) {
        console.error('폴더 생성 실패:', error);
        if (error instanceof Error && error.message.includes('순환 참조')) {
            res.status(400).json({ message: error.message });
        }
        else {
            res.status(500).json({ message: '폴더 생성에 실패했습니다.' });
        }
    }
});
// 폴더 수정
router.put('/:id', async (req, res) => {
    try {
        const request = {
            name: req.body.name,
            description: req.body.description,
            parentId: req.body.parentId,
            updatedBy: req.body.updatedBy || 'system'
        };
        const folder = await folderService.updateFolder(Number(req.params.id), request);
        if (!folder) {
            return res.status(404).json({ message: '폴더를 찾을 수 없습니다.' });
        }
        res.json(folder);
    }
    catch (error) {
        console.error('폴더 수정 실패:', error);
        if (error instanceof Error && error.message.includes('순환 참조')) {
            res.status(400).json({ message: error.message });
        }
        else {
            res.status(500).json({ message: '폴더 수정에 실패했습니다.' });
        }
    }
});
// 폴더 삭제
router.delete('/:id', async (req, res) => {
    try {
        const success = await folderService.deleteFolder(Number(req.params.id));
        if (!success) {
            return res.status(404).json({ message: '폴더를 찾을 수 없습니다.' });
        }
        res.status(204).send();
    }
    catch (error) {
        console.error('폴더 삭제 실패:', error);
        if (error instanceof Error && error.message.includes('루트 폴더')) {
            res.status(400).json({ message: error.message });
        }
        else {
            res.status(500).json({ message: '폴더 삭제에 실패했습니다.' });
        }
    }
});
// 폴더 이동
router.post('/:id/move', async (req, res) => {
    try {
        const request = {
            targetParentId: req.body.targetParentId,
            updatedBy: req.body.updatedBy || 'system'
        };
        const folder = await folderService.moveFolder(Number(req.params.id), request);
        if (!folder) {
            return res.status(404).json({ message: '폴더를 찾을 수 없습니다.' });
        }
        res.json(folder);
    }
    catch (error) {
        console.error('폴더 이동 실패:', error);
        if (error instanceof Error && error.message.includes('순환 참조')) {
            res.status(400).json({ message: error.message });
        }
        else {
            res.status(500).json({ message: '폴더 이동에 실패했습니다.' });
        }
    }
});
// 폴더 내 테스트 케이스 목록 조회
router.get('/:id/testcases', async (req, res) => {
    try {
        const testCaseIds = await folderService.getTestCasesInFolder(Number(req.params.id));
        res.json(testCaseIds);
    }
    catch (error) {
        console.error('폴더 내 테스트 케이스 조회 실패:', error);
        res.status(500).json({ message: '테스트 케이스 조회에 실패했습니다.' });
    }
});
// 테스트 케이스를 폴더에 추가
router.post('/:id/testcases/:testCaseId', async (req, res) => {
    try {
        await folderService.addTestCaseToFolder(Number(req.params.testCaseId), Number(req.params.id));
        res.status(204).send();
    }
    catch (error) {
        console.error('테스트 케이스 추가 실패:', error);
        res.status(500).json({ message: '테스트 케이스 추가에 실패했습니다.' });
    }
});
// 테스트 케이스를 폴더에서 제거
router.delete('/:id/testcases/:testCaseId', async (req, res) => {
    try {
        await folderService.removeTestCaseFromFolder(Number(req.params.testCaseId), Number(req.params.id));
        res.status(204).send();
    }
    catch (error) {
        console.error('테스트 케이스 제거 실패:', error);
        res.status(500).json({ message: '테스트 케이스 제거에 실패했습니다.' });
    }
});
exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvZG9tYWlucy9mb2xkZXJzL2NvbnRyb2xsZXJzL2ZvbGRlckNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxxQ0FBaUM7QUFDakMseUVBQTJEO0FBRTNELHNFQUEwQztBQUUxQyxNQUFNLE1BQU0sR0FBRyxJQUFBLGdCQUFNLEdBQUUsQ0FBQztBQUV4QixlQUFlO0FBQ2YsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsd0JBQVUsQ0FBQyxDQUFDO0FBRWhDLFdBQVc7QUFDWCxNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFO0lBQ25DLElBQUksQ0FBQztRQUNELE1BQU0sSUFBSSxHQUFHLE1BQU0sYUFBYSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ2pELEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkIsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDYixPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNyQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxDQUFDLENBQUM7SUFDM0QsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsV0FBVztBQUNYLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7SUFDL0IsSUFBSSxDQUFDO1FBQ0QsTUFBTSxPQUFPLEdBQUcsTUFBTSxhQUFhLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDcEQsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN0QixDQUFDO0lBQUMs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QVUsQ0FBQyxFQUM3QixNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FDeEIsQ0FBQztRQUNGLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDYixPQUFPLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLENBQUMsQ0FBQztJQUM3RCxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxrQkFBZSxNQUFNLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvZG9tYWlucy9mb2xkZXJzL2NvbnRyb2xsZXJzL2ZvbGRlckNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgKiBhcyBmb2xkZXJTZXJ2aWNlIGZyb20gJy4uL3NlcnZpY2VzL2ZvbGRlclNlcnZpY2UnO1xuaW1wb3J0IHsgQ3JlYXRlRm9sZGVyUmVxdWVzdCwgVXBkYXRlRm9sZGVyUmVxdWVzdCwgTW92ZUZvbGRlclJlcXVlc3QsIE1vdmVUZXN0Q2FzZVJlcXVlc3QgfSBmcm9tICcuLi9tb2RlbHMvRm9sZGVyJztcbmltcG9ydCBidWxrUm91dGVyIGZyb20gJy4vYnVsa0NvbnRyb2xsZXInO1xuXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKTtcblxuLy8g7J286rSEIOyekeyXhSDrnbzsmrDthLAg65Ox66GdXG5yb3V0ZXIudXNlKCcvYnVsaycsIGJ1bGtSb3V0ZXIpO1xuXG4vLyDtj7TrjZQg7Yq466asIOyhsO2ajFxucm91dGVyLmdldCgnL3RyZWUnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB0cmVlID0gYXdhaXQgZm9sZGVyU2VydmljZS5nZXRGb2xkZXJUcmVlKCk7XG4gICAgICAgIHJlcy5qc29uKHRyZWUpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+2PtOuNlCDtirjrpqwg7KGw7ZqMIOyLpO2MqDonLCBlcnJvcik7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ+2PtOuNlCDtirjrpqwg7KGw7ZqM7JeQIOyLpO2MqO2WiOyKteuLiOuLpC4nIH0pO1xuICAgIH1cbn0pO1xuXG4vLyDrqqjrk6Ag7Y+0642UIOyhsO2ajFxucm91dGVyLmdldCgnLycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGZvbGRlcnMgPSBhd2FpdCBmb2xkZXJTZXJ2aWNlLmdldEFsbEZvbGRlcnMoKTtcbiAgICAgICAgcmVzLmpzb24oZm9sZGVycyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign7Y+0642UIOuqqeuhnSDsobDtmowg7Iuk7YyoOicsIGVycm9yKTtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAn7Y+0642UIOuqqeuhnSDsobDtmozsl5Ag7Iuk7Yyo7ZaI7Iq164uI64ukLicgfSk7XG4gICAgfVxufSk7XG5cbi8vIO2KueyglSDtj7TrjZQg7KGw7ZqMXG5yb3V0ZXIuZ2V0KCcvOmlkJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZm9sZGVyID0gYXdhaXQgZm9sZGVyU2VydmljZS5nZXRGb2xkZXJCeUlkKE51bWJlcihyZXEucGFyYW1zLmlkKSk7XG4gICAgICAgIGlmICghZm9sZGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAn7Y+0642U66W8IOywvuydhCDsiJgg7JeG7Iq164uI64ukLicgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVzLmpzb24oZm9sZGVyKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCftj7TrjZQg7KGw7ZqMIOyLpO2MqDonLCBlcnJvcik7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ+2PtOuNlCDsobDtmozsl5Ag7Iuk7Yyo7ZaI7Iq164uI64ukLicgfSk7XG4gICAgfVxufSk7XG5cbi8vIO2PtOuNlCDsg53shLFcbnJvdXRlci5wb3N0KCcvJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdDogQ3JlYXRlRm9sZGVyUmVxdWVzdCA9IHtcbiAgICAgICAgICAgIG5hbWU6IHJlcS5ib2R5Lm5hbWUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogcmVxLmJvZHkuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBwYXJlbnRJZDogcmVxLmJvZHkucGFyZW50SWQsXG4gICAgICAgICAgICBjcmVhdGVkQnk6IHJlcS5ib2R5LmNyZWF0ZWRCeSB8fCAnc3lzdGVtJ1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZm9sZGVyID0gYXdhaXQgZm9sZGVyU2VydmljZS5jcmVhdGVGb2xkZXIocmVxdWVzdCk7XG4gICAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKGZvbGRlcik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign7Y+0642UIOyDneyEsSDsi6TtjKg6JywgZXJyb3IpO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCfsiJztmZgg7LC47KGwJykpIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ+2PtOuNlCDsg53shLHsl5Ag7Iuk7Yyo7ZaI7Iq164uI64ukLicgfSk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuLy8g7Y+0642UIOyImOyglVxucm91dGVyLnB1dCgnLzppZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3Q6IFVwZGF0ZUZvbGRlclJlcXVlc3QgPSB7XG4gICAgICAgICAgICBuYW1lOiByZXEuYm9keS5uYW1lLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IHJlcS5ib2R5LmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgcGFyZW50SWQ6IHJlcS5ib2R5LnBhcmVudElkLFxuICAgICAgICAgICAgdXBkYXRlZEJ5OiByZXEuYm9keS51cGRhdGVkQnkgfHwgJ3N5c3RlbSdcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGZvbGRlciA9IGF3YWl0IGZvbGRlclNlcnZpY2UudXBkYXRlRm9sZGVyKE51bWJlcihyZXEucGFyYW1zLmlkKSwgcmVxdWVzdCk7XG4gICAgICAgIGlmICghZm9sZGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAn7Y+0642U66W8IOywvuydhCDsiJgg7JeG7Iq164uI64ukLicgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVzLmpzb24oZm9sZGVyKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCftj7TrjZQg7IiY7KCVIOyLpO2MqDonLCBlcnJvcik7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yICYmIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ+yInO2ZmCDssLjsobAnKSkge1xuICAgICAgICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAn7Y+0642UIOyImOygleyXkCDsi6TtjKjtlojsirXri4jri6QuJyB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG4vLyDtj7TrjZQg7IKt7KCcXG5yb3V0ZXIuZGVsZXRlKCcvOmlkJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc3VjY2VzcyA9IGF3YWl0IGZvbGRlclNlcnZpY2UuZGVsZXRlRm9sZGVyKE51bWJlcihyZXEucGFyYW1zLmlkKSk7XG4gICAgICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ+2PtOuNlOulvCDssL7snYQg7IiYIOyXhuyKteuLiOuLpC4nIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJlcy5zdGF0dXMoMjA0KS5zZW5kKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign7Y+0642UIOyCreygnCDsi6TtjKg6JywgZXJyb3IpO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCfro6jtirgg7Y+0642UJykpIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ+2PtOuNlCDsgq3soJzsl5Ag7Iuk7Yyo7ZaI7Iq164uI64ukLicgfSk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuLy8g7Y+0642UIOydtOuPmVxucm91dGVyLnBvc3QoJy86aWQvbW92ZScsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3Q6IE1vdmVGb2xkZXJSZXF1ZXN0ID0ge1xuICAgICAgICAgICAgdGFyZ2V0UGFyZW50SWQ6IHJlcS5ib2R5LnRhcmdldFBhcmVudElkLFxuICAgICAgICAgICAgdXBkYXRlZEJ5OiByZXEuYm9keS51cGRhdGVkQnkgfHwgJ3N5c3RlbSdcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGZvbGRlciA9IGF3YWl0IGZvbGRlclNlcnZpY2UubW92ZUZvbGRlcihOdW1iZXIocmVxLnBhcmFtcy5pZCksIHJlcXVlc3QpO1xuICAgICAgICBpZiAoIWZvbGRlcikge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ+2PtOuNlOulvCDssL7snYQg7IiYIOyXhuyKteuLiOuLpC4nIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJlcy5qc29uKGZvbGRlcik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign7Y+0642UIOydtOuPmSDsi6TtjKg6JywgZXJyb3IpO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCfsiJztmZgg7LC47KGwJykpIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ+2PtOuNlCDsnbTrj5nsl5Ag7Iuk7Yyo7ZaI7Iq164uI64ukLicgfSk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuLy8g7Y+0642UIOuCtCDthYzsiqTtirgg7LyA7J207IqkIOuqqeuhnSDsobDtmoxcbnJvdXRlci5nZXQoJy86aWQvdGVzdGNhc2VzJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdGVzdENhc2VJZHMgPSBhd2FpdCBmb2xkZXJTZXJ2aWNlLmdldFRlc3RDYXNlc0luRm9sZGVyKE51bWJlcihyZXEucGFyYW1zLmlkKSk7XG4gICAgICAgIHJlcy5qc29uKHRlc3RDYXNlSWRzKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCftj7TrjZQg64K0IO2FjOyKpO2KuCDsvIDsnbTsiqQg7KGw7ZqMIOyLpO2MqDonLCBlcnJvcik7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ+2FjOyKpO2KuCDsvIDsnbTsiqQg7KGw7ZqM7JeQIOyLpO2MqO2WiOyKteuLiOuLpC4nIH0pO1xuICAgIH1cbn0pO1xuXG4vLyDthYzsiqTtirgg7LyA7J207Iqk66W8IO2PtOuNlOyXkCDstpTqsIBcbnJvdXRlci5wb3N0KCcvOmlkL3Rlc3RjYXNlcy86dGVzdENhc2VJZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGZvbGRlclNlcnZpY2UuYWRkVGVzdENhc2VUb0ZvbGRlcihcbiAgICAgICAgICAgIE51bWJlcihyZXEucGFyYW1zLnRlc3RDYXNlSWQpLFxuICAgICAgICAgICAgTnVtYmVyKHJlcS5wYXJhbXMuaWQpXG4gICAgICAgICk7XG4gICAgICAgIHJlcy5zdGF0dXMoMjA0KS5zZW5kKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign7YWM7Iqk7Yq4IOy8gOydtOyKpCDstpTqsIAg7Iuk7YyoOicsIGVycm9yKTtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAn7YWM7Iqk7Yq4IOy8gOydtOyKpCDstpTqsIDsl5Ag7Iuk7Yyo7ZaI7Iq164uI64ukLicgfSk7XG4gICAgfVxufSk7XG5cbi8vIO2FjOyKpO2KuCDsvIDsnbTsiqTrpbwg7Y+0642U7JeQ7IScIOygnOqxsFxucm91dGVyLmRlbGV0ZSgnLzppZC90ZXN0Y2FzZXMvOnRlc3RDYXNlSWQnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBmb2xkZXJTZXJ2aWNlLnJlbW92ZVRlc3RDYXNlRnJvbUZvbGRlcihcbiAgICAgICAgICAgIE51bWJlcihyZXEucGFyYW1zLnRlc3RDYXNlSWQpLFxuICAgICAgICAgICAgTnVtYmVyKHJlcS5wYXJhbXMuaWQpXG4gICAgICAgICk7XG4gICAgICAgIHJlcy5zdGF0dXMoMjA0KS5zZW5kKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign7YWM7Iqk7Yq4IOy8gOydtOyKpCDsoJzqsbAg7Iuk7YyoOicsIGVycm9yKTtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAn7YWM7Iqk7Yq4IOy8gOydtOyKpCDsoJzqsbDsl5Ag7Iuk7Yyo7ZaI7Iq164uI64ukLicgfSk7XG4gICAgfVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHJvdXRlcjsgIl0sInZlcnNpb24iOjN9