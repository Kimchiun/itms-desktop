879f87176e3c476047f29b6b0f205c46
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _typeof = require("@babel/runtime/helpers/typeof");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));
var _objectDestructuringEmpty2 = _interopRequireDefault(require("@babel/runtime/helpers/objectDestructuringEmpty"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));
var _classnames = _interopRequireDefault(require("classnames"));
var _rcMotion = _interopRequireDefault(require("rc-motion"));
var _useLayoutEffect = _interopRequireDefault(require("rc-util/lib/hooks/useLayoutEffect"));
var React = _interopRequireWildcard(require("react"));
var _contextTypes = require("./contextTypes");
var _TreeNode = _interopRequireDefault(require("./TreeNode"));
var _useUnmount = _interopRequireDefault(require("./useUnmount"));
var _treeUtil = require("./utils/treeUtil");
var _excluded = ["className", "style", "motion", "motionNodes", "motionType", "onMotionStart", "onMotionEnd", "active", "treeNodeRequiredProps"];
function _getRequireWildcardCache(e) {
  if ("function" != typeof WeakMap) return null;
  var r = new WeakMap(),
    t = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(e) {
    return e ? t : r;
  })(e);
}
function _interopRequireWildcard(e, r) {
  if (!r && e && e.__esModule) return e;
  if (null === e || "object" != _typeof(e) && "function" != typeof e) return {
    default: e
  };
  var t = _getRequireWildcardCache(r);
  if (t && t.has(e)) return t.get(e);
  var n = {
      __proto__: null
    },
    a = Object.defineProperty && Object.getOwnPropertyDescriptor;
  for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) {
    var i = a ? Object.getOwnPropertyDescriptor(e, u) : null;
    i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u];
  }
  return n.default = e, t && t.set(e, n), n;
}
var MotionTreeNode = /*#__PURE__*/React.forwardRef(function (oriProps, ref) {
  var className = oriProps.className,
    style = oriProps.style,
    motion = oriProps.motion,
    motionNodes = oriProps.motionNodes,
    motionType = oriProps.motionType,
    onOriginMotionStart = oriProps.onMotionStart,
    onOriginMotionEnd = oriProps.onMotionEnd,
    active = oriProps.active,
    treeNodeRequiredProps = oriProps.treeNodeRequiredProps,
    props = (0, _objectWithoutProperties2.default)(oriProps, _excluded);
  var _React$useState = React.useState(true),
    _React$useState2 = (0, _slicedToArray2.default)(_React$useState, 2),
    visible = _React$useState2[0],
    setVisible = _React$useState2[1];
  var _React$useContext = React.useContext(_contextTypes.TreeContext),
    prefixCls = _React$useContext.prefixCls;

  // Calculate target visible here.
  // And apply in effect to make `leave` motion work.
  var targetVisible = motionNodes && motionType !== 'hide';
  (0, _useLayoutEffect.default)(function () {
    if (motionNodes) {
      if (targetVisible !== visible) {
        setVisible(targetVisible);
      }
    }
  }, [motionNodes]);
  var triggerMotionStart = function triggerMotionStart() {
    if (motionNodes) {
      onOriginMotionStart();
    }
  };

  // Should only trigger once
  var triggerMotionEndRef = React.useRef(false);
  var triggerMotionEnd = function triggerMotionEnd() {
    if (motionNodes && !triggerMotionEndRef.current) {
      triggerMotionEndRef.current = true;
      onOriginMotionEnd();
    }
  };

  // Effect if unmount
  (0, _useUnmount.default)(triggerMotionStart, triggerMotionEnd);

  // Motion end event
  var onVisibleChanged = function onVisibleChanged(nextVisible) {
    if (targetVisible === nextVisible) {
      triggerMotionEnd();
    }
  };
  if (motionNodes) {
    return /*#__PURE__*/React.createElement(_rcMotion.default, (0, _extends2.default)({
      ref: ref,
      visible: visible
    }, motion, {
      motionAppear: motionType === 'show',
      onVisibleChanged: onVisibleChanged
    }), function (_ref, motionRef) {
      var motionClassName = _ref.className,
        motionStyle = _ref.style;
      return /*#__PURE__*/React.createElement("div", {
        ref: motionRef,
        className: (0, _classnames.default)("".concat(prefixCls, "-treenode-motion"), motionClassName),
        style: motionStyle
      }, motionNodes.map(function (treeNode) {
        var restProps = Object.assign({}, ((0, _objectDestructuringEmpty2.default)(treeNode.data), treeNode.data)),
          title = treeNode.title,
          key = treeNode.key,
          isStart = treeNode.isStart,
          isEnd = treeNode.isEnd;
        delete restProps.children;
        var treeNodeProps = (0, _treeUtil.getTreeNodeProps)(key, treeNodeRequiredProps);
        return /*#__PURE__*/React.createElement(_TreeNode.default, (0, _extends2.default)({}, restProps, treeNodeProps, {
          title: title,
          active: active,
          data: treeNode.data,
          key: key,
          isStart: isStart,
          isEnd: isEnd
        }));
      }));
    });
  }
  return /*#__PURE__*/React.createElement(_TreeNode.default, (0, _extends2.default)({
    domRef: ref,
    className: className,
    style: style
  }, props, {
    active: active
  }));
});
if (process.env.NODE_ENV !== 'production') {
  MotionTreeNode.displayName = 'MotionTreeNode';
}
var _default = exports.default = MotionTreeNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl90eXBlb2YiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJfZXh0ZW5kczIiLCJfb2JqZWN0RGVzdHJ1Y3R1cmluZ0VtcHR5MiIsIl9zbGljZWRUb0FycmF5MiIsIl9vYmplY3RXaXRob3V0UHJvcGVydGllczIiLCJfY2xhc3NuYW1lcyIsIl9yY01vdGlvbiIsIl91c2VMYXlvdXRFZmZlY3QiLCJSZWFjdCIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiX2NvbnRleHRUeXBlcyIsIl9UcmVlTm9kZSIsIl91c2VVbm1vdW50IiwiX3RyZWVVdGlsIiwiX2V4Y2x1ZGVkIiwiX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlIiwiZSIsIldlYWtNYXAiLCJyIiwidCIsIl9fZXNNb2R1bGUiLCJoYXMiLCJnZXQiLCJuIiwiX19wcm90b19fIiwiYSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsInUiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJpIiwic2V0IiwiTW90aW9uVHJlZU5vZGUiLCJmb3J3YXJkUmVmIiwib3JpUHJvcHMiLCJyZWYiLCJjbGFzc05hbWUiLCJzdHlsZSIsIm1vdGlvbiIsIm1vdGlvbk5vZGVzIiwibW90aW9uVHlwZSIsIm9uT3JpZ2luTW90aW9uU3RhcnQiLCJvbk1vdGlvblN0YXJ0Iiwib25PcmlnaW5Nb3Rpb25FbmQiLCJvbk1vdGlvbkVuZCIsImFjdGl2ZSIsInRyZWVOb2RlUmVxdWlyZWRQcm9wcyIsInByb3BzIiwiX1JlYWN0JHVzZVN0YXRlIiwidXNlU3RhdGUiLCJfUmVhY3QkdXNlU3RhdGUyIiwidmlzaWJsZSIsInNldFZpc2libGUiLCJfUmVhY3QkdXNlQ29udGV4dCIsInVzZUNvbnRleHQiLCJUcmVlQ29udGV4dCIsInByZWZpeENscyIsInRhcmdldFZpc2libGUiLCJ0cmlnZ2VyTW90aW9uU3RhcnQiLCJ0cmlnZ2VyTW90aW9uRW5kUmVmIiwidXNlUmVmIiwidHJpZ2dlck1vdGlvbkVuZCIsImN1cnJlbnQiLCJvblZpc2libGVDaGFuZ2VkIiwibmV4dFZpc2libGUiLCJjcmVhdGVFbGVtZW50IiwibW90aW9uQXBwZWFyIiwiX3JlZiIsIm1vdGlvblJlZiIsIm1vdGlvbkNsYXNzTmFtZSIsIm1vdGlvblN0eWxlIiwiY29uY2F0IiwibWFwIiwidHJlZU5vZGUiLCJyZXN0UHJvcHMiLCJhc3NpZ24iLCJkYXRhIiwidGl0bGUiLCJrZXkiLCJpc1N0YXJ0IiwiaXNFbmQiLCJjaGlsZHJlbiIsInRyZWVOb2RlUHJvcHMiLCJnZXRUcmVlTm9kZVByb3BzIiwiZG9tUmVmIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiZGlzcGxheU5hbWUiLCJfZGVmYXVsdCJdLCJzb3VyY2VzIjpbIk1vdGlvblRyZWVOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG52YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2ludGVyb3BSZXF1aXJlRGVmYXVsdFwiKTtcbnZhciBfdHlwZW9mID0gcmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcbnZhciBfZXh0ZW5kczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2V4dGVuZHNcIikpO1xudmFyIF9vYmplY3REZXN0cnVjdHVyaW5nRW1wdHkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9vYmplY3REZXN0cnVjdHVyaW5nRW1wdHlcIikpO1xudmFyIF9zbGljZWRUb0FycmF5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvc2xpY2VkVG9BcnJheVwiKSk7XG52YXIgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvb2JqZWN0V2l0aG91dFByb3BlcnRpZXNcIikpO1xudmFyIF9jbGFzc25hbWVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiY2xhc3NuYW1lc1wiKSk7XG52YXIgX3JjTW90aW9uID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwicmMtbW90aW9uXCIpKTtcbnZhciBfdXNlTGF5b3V0RWZmZWN0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwicmMtdXRpbC9saWIvaG9va3MvdXNlTGF5b3V0RWZmZWN0XCIpKTtcbnZhciBSZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoXCJyZWFjdFwiKSk7XG52YXIgX2NvbnRleHRUeXBlcyA9IHJlcXVpcmUoXCIuL2NvbnRleHRUeXBlc1wiKTtcbnZhciBfVHJlZU5vZGUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL1RyZWVOb2RlXCIpKTtcbnZhciBfdXNlVW5tb3VudCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vdXNlVW5tb3VudFwiKSk7XG52YXIgX3RyZWVVdGlsID0gcmVxdWlyZShcIi4vdXRpbHMvdHJlZVV0aWxcIik7XG52YXIgX2V4Y2x1ZGVkID0gW1wiY2xhc3NOYW1lXCIsIFwic3R5bGVcIiwgXCJtb3Rpb25cIiwgXCJtb3Rpb25Ob2Rlc1wiLCBcIm1vdGlvblR5cGVcIiwgXCJvbk1vdGlvblN0YXJ0XCIsIFwib25Nb3Rpb25FbmRcIiwgXCJhY3RpdmVcIiwgXCJ0cmVlTm9kZVJlcXVpcmVkUHJvcHNcIl07XG5mdW5jdGlvbiBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUoZSkgeyBpZiAoXCJmdW5jdGlvblwiICE9IHR5cGVvZiBXZWFrTWFwKSByZXR1cm4gbnVsbDsgdmFyIHIgPSBuZXcgV2Vha01hcCgpLCB0ID0gbmV3IFdlYWtNYXAoKTsgcmV0dXJuIChfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUgPSBmdW5jdGlvbiBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUoZSkgeyByZXR1cm4gZSA/IHQgOiByOyB9KShlKTsgfVxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQoZSwgcikgeyBpZiAoIXIgJiYgZSAmJiBlLl9fZXNNb2R1bGUpIHJldHVybiBlOyBpZiAobnVsbCA9PT0gZSB8fCBcIm9iamVjdFwiICE9IF90eXBlb2YoZSkgJiYgXCJmdW5jdGlvblwiICE9IHR5cGVvZiBlKSByZXR1cm4geyBkZWZhdWx0OiBlIH07IHZhciB0ID0gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKHIpOyBpZiAodCAmJiB0LmhhcyhlKSkgcmV0dXJuIHQuZ2V0KGUpOyB2YXIgbiA9IHsgX19wcm90b19fOiBudWxsIH0sIGEgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsgZm9yICh2YXIgdSBpbiBlKSBpZiAoXCJkZWZhdWx0XCIgIT09IHUgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHUpKSB7IHZhciBpID0gYSA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSwgdSkgOiBudWxsOyBpICYmIChpLmdldCB8fCBpLnNldCkgPyBPYmplY3QuZGVmaW5lUHJvcGVydHkobiwgdSwgaSkgOiBuW3VdID0gZVt1XTsgfSByZXR1cm4gbi5kZWZhdWx0ID0gZSwgdCAmJiB0LnNldChlLCBuKSwgbjsgfVxudmFyIE1vdGlvblRyZWVOb2RlID0gLyojX19QVVJFX18qL1JlYWN0LmZvcndhcmRSZWYoZnVuY3Rpb24gKG9yaVByb3BzLCByZWYpIHtcbiAgdmFyIGNsYXNzTmFtZSA9IG9yaVByb3BzLmNsYXNzTmFtZSxcbiAgICBzdHlsZSA9IG9yaVByb3BzLnN0eWxlLFxuICAgIG1vdGlvbiA9IG9yaVByb3BzLm1vdGlvbixcbiAgICBtb3Rpb25Ob2RlcyA9IG9yaVByb3BzLm1vdGlvbk5vZGVzLFxuICAgIG1vdGlvblR5cGUgPSBvcmlQcm9wcy5tb3Rpb25UeXBlLFxuICAgIG9uT3JpZ2luTW90aW9uU3RhcnQgPSBvcmlQcm9wcy5vbk1vdGlvblN0YXJ0LFxuICAgIG9uT3JpZ2luTW90aW9uRW5kID0gb3JpUHJvcHMub25Nb3Rpb25FbmQsXG4gICAgYWN0aXZlID0gb3JpUHJvcHMuYWN0aXZlLFxuICAgIHRyZWVOb2RlUmVxdWlyZWRQcm9wcyA9IG9yaVByb3BzLnRyZWVOb2RlUmVxdWlyZWRQcm9wcyxcbiAgICBwcm9wcyA9ICgwLCBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMyLmRlZmF1bHQpKG9yaVByb3BzLCBfZXhjbHVkZWQpO1xuICB2YXIgX1JlYWN0JHVzZVN0YXRlID0gUmVhY3QudXNlU3RhdGUodHJ1ZSksXG4gICAgX1JlYWN0JHVzZVN0YXRlMiA9ICgwLCBfc2xpY2VkVG9BcnJheTIuZGVmYXVsdCkoX1JlYWN0JHVzZVN0YXRlLCAyKSxcbiAgICB2aXNpYmxlID0gX1JlYWN0JHVzZVN0YXRlMlswXSxcbiAgICBzZXRWaXNpYmxlID0gX1JlYWN0JHVzZVN0YXRlMlsxXTtcbiAgdmFyIF9SZWFjdCR1c2VDb250ZXh0ID0gUmVhY3QudXNlQ29udGV4dChfY29udGV4dFR5cGVzLlRyZWVDb250ZXh0KSxcbiAgICBwcmVmaXhDbHMgPSBfUmVhY3QkdXNlQ29udGV4dC5wcmVmaXhDbHM7XG5cbiAgLy8gQ2FsY3VsYXRlIHRhcmdldCB2aXNpYmxlIGhlcmUuXG4gIC8vIEFuZCBhcHBseSBpbiBlZmZlY3QgdG8gbWFrZSBgbGVhdmVgIG1vdGlvbiB3b3JrLlxuICB2YXIgdGFyZ2V0VmlzaWJsZSA9IG1vdGlvbk5vZGVzICYmIG1vdGlvblR5cGUgIT09ICdoaWRlJztcbiAgKDAsIF91c2VMYXlvdXRFZmZlY3QuZGVmYXVsdCkoZnVuY3Rpb24gKCkge1xuICAgIGlmIChtb3Rpb25Ob2Rlcykge1xuICAgICAgaWYgKHRhcmdldFZpc2libGUgIT09IHZpc2libGUpIHtcbiAgICAgICAgc2V0VmlzaWJsZSh0YXJnZXRWaXNpYmxlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIFttb3Rpb25Ob2Rlc10pO1xuICB2YXIgdHJpZ2dlck1vdGlvblN0YXJ0ID0gZnVuY3Rpb24gdHJpZ2dlck1vdGlvblN0YXJ0KCkge1xuICAgIGlmIChtb3Rpb25Ob2Rlcykge1xuICAgICAgb25PcmlnaW5Nb3Rpb25TdGFydCgpO1xuICAgIH1cbiAgfTtcblxuICAvLyBTaG91bGQgb25seSB0cmlnZ2VyIG9uY2VcbiAgdmFyIHRyaWdnZXJNb3Rpb25FbmRSZWYgPSBSZWFjdC51c2VSZWYoZmFsc2UpO1xuICB2YXIgdHJpZ2dlck1vdGlvbkVuZCA9IGZ1bmN0aW9uIHRyaWdnZXJNb3Rpb25FbmQoKSB7XG4gICAgaWYgKG1vdGlvbk5vZGVzICYmICF0cmlnZ2VyTW90aW9uRW5kUmVmLmN1cnJlbnQpIHtcbiAgICAgIHRyaWdnZXJNb3Rpb25FbmRSZWYuY3VycmVudCA9IHRydWU7XG4gICAgICBvbk9yaWdpbk1vdGlvbkVuZCgpO1xuICAgIH1cbiAgfTtcblxuICAvLyBFZmZlY3QgaWYgdW5tb3VudFxuICAoMCwgX3VzZVVubW91bnQuZGVmYXVsdCkodHJpZ2dlck1vdGlvblN0YXJ0LCB0cmlnZ2VyTW90aW9uRW5kKTtcblxuICAvLyBNb3Rpb24gZW5kIGV2ZW50XG4gIHZhciBvblZpc2libGVDaGFuZ2VkID0gZnVuY3Rpb24gb25WaXNpYmxlQ2hhbmdlZChuZXh0VmlzaWJsZSkge1xuICAgIGlmICh0YXJnZXRWaXNpYmxlID09PSBuZXh0VmlzaWJsZSkge1xuICAgICAgdHJpZ2dlck1vdGlvbkVuZCgpO1xuICAgIH1cbiAgfTtcbiAgaWYgKG1vdGlvbk5vZGVzKSB7XG4gICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KF9yY01vdGlvbi5kZWZhdWx0LCAoMCwgX2V4dGVuZHMyLmRlZmF1bHQpKHtcbiAgICAgIHJlZjogcmVmLFxuICAgICAgdmlzaWJsZTogdmlzaWJsZVxuICAgIH0sIG1vdGlvbiwge1xuICAgICAgbW90aW9uQXBwZWFyOiBtb3Rpb25UeXBlID09PSAnc2hvdycsXG4gICAgICBvblZpc2libGVDaGFuZ2VkOiBvblZpc2libGVDaGFuZ2VkXG4gICAgfSksIGZ1bmN0aW9uIChfcmVmLCBtb3Rpb25SZWYpIHtcbiAgICAgIHZhciBtb3Rpb25DbGFzc05hbWUgPSBfcmVmLmNsYXNzTmFtZSxcbiAgICAgICAgbW90aW9uU3R5bGUgPSBfcmVmLnN0eWxlO1xuICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHtcbiAgICAgICAgcmVmOiBtb3Rpb25SZWYsXG4gICAgICAgIGNsYXNzTmFtZTogKDAsIF9jbGFzc25hbWVzLmRlZmF1bHQpKFwiXCIuY29uY2F0KHByZWZpeENscywgXCItdHJlZW5vZGUtbW90aW9uXCIpLCBtb3Rpb25DbGFzc05hbWUpLFxuICAgICAgICBzdHlsZTogbW90aW9uU3R5bGVcbiAgICAgIH0sIG1vdGlvbk5vZGVzLm1hcChmdW5jdGlvbiAodHJlZU5vZGUpIHtcbiAgICAgICAgdmFyIHJlc3RQcm9wcyA9IE9iamVjdC5hc3NpZ24oe30sICgoMCwgX29iamVjdERlc3RydWN0dXJpbmdFbXB0eTIuZGVmYXVsdCkodHJlZU5vZGUuZGF0YSksIHRyZWVOb2RlLmRhdGEpKSxcbiAgICAgICAgICB0aXRsZSA9IHRyZWVOb2RlLnRpdGxlLFxuICAgICAgICAgIGtleSA9IHRyZWVOb2RlLmtleSxcbiAgICAgICAgICBpc1N0YXJ0ID0gdHJlZU5vZGUuaXNTdGFydCxcbiAgICAgICAgICBpc0VuZCA9IHRyZWVOb2RlLmlzRW5kO1xuICAgICAgICBkZWxldGUgcmVzdFByb3BzLmNoaWxkcmVuO1xuICAgICAgICB2YXIgdHJlZU5vZGVQcm9wcyA9ICgwLCBfdHJlZVV0aWwuZ2V0VHJlZU5vZGVQcm9wcykoa2V5LCB0cmVlTm9kZVJlcXVpcmVkUHJvcHMpO1xuICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoX1RyZWVOb2RlLmRlZmF1bHQsICgwLCBfZXh0ZW5kczIuZGVmYXVsdCkoe30sIHJlc3RQcm9wcywgdHJlZU5vZGVQcm9wcywge1xuICAgICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgICBhY3RpdmU6IGFjdGl2ZSxcbiAgICAgICAgICBkYXRhOiB0cmVlTm9kZS5kYXRhLFxuICAgICAgICAgIGtleToga2V5LFxuICAgICAgICAgIGlzU3RhcnQ6IGlzU3RhcnQsXG4gICAgICAgICAgaXNFbmQ6IGlzRW5kXG4gICAgICAgIH0pKTtcbiAgICAgIH0pKTtcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoX1RyZWVOb2RlLmRlZmF1bHQsICgwLCBfZXh0ZW5kczIuZGVmYXVsdCkoe1xuICAgIGRvbVJlZjogcmVmLFxuICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lLFxuICAgIHN0eWxlOiBzdHlsZVxuICB9LCBwcm9wcywge1xuICAgIGFjdGl2ZTogYWN0aXZlXG4gIH0pKTtcbn0pO1xuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcbiAgTW90aW9uVHJlZU5vZGUuZGlzcGxheU5hbWUgPSAnTW90aW9uVHJlZU5vZGUnO1xufVxudmFyIF9kZWZhdWx0ID0gZXhwb3J0cy5kZWZhdWx0ID0gTW90aW9uVHJlZU5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUVaLElBQUlBLHNCQUFzQixHQUFHQyxPQUFPLENBQUMsOENBQThDLENBQUM7QUFDcEYsSUFBSUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsK0JBQStCLENBQUM7QUFDdERFLE1B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RTtRQUNyQyxJQUFJQyxTQUFTLEdBQUcvRSxNQUFNLENBQUNnRixNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUxRSwwQkFBMEIsQ0FBQ0YsT0FBTyxFQUFFMEUsUUFBUSxDQUFDRyxJQUFJLENBQUMsRUFBRUgsUUFBUSxDQUFDRyxJQUFJLENBQUMsQ0FBQztVQUN4R0MsS0FBSyxHQUFHSixRQUFRLENBQUNJLEtBQUs7VUFDdEJDLEdBQUcsR0FBR0wsUUFBUSxDQUFDSyxHQUFHO1VBQ2xCQyxPQUFPLEdBQUdOLFFBQVEsQ0FBQ00sT0FBTztVQUMxQkMsS0FBSyxHQUFHUCxRQUFRLENBQUNPLEtBQUs7UUFDeEIsT0FBT04sU0FBUyxDQUFDTyxRQUFRO1FBQ3pCLElBQUlDLGFBQWEsR0FBRyxDQUFDLENBQUMsRUFBRXRFLFNBQVMsQ0FBQ3VFLGdCQUFnQixFQUFFTCxHQUFHLEVBQUVoQyxxQkFBcUIsQ0FBQztRQUMvRSxPQUFPLGFBQWF2QyxLQUFLLENBQUMwRCxhQUFhLENBQUN2RCxTQUFTLENBQUNYLE9BQU8sRUFBRSxDQUFDLENBQUMsRUFBRUMsU0FBUyxDQUFDRCxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUyRSxTQUFTLEVBQUVRLGFBQWEsRUFBRTtVQUM5R0wsS0FBSyxFQUFFQSxLQUFLO1VBQ1poQyxNQUFNLEVBQUVBLE1BQU07VUFDZCtCLElBQUksRUFBRUgsUUFBUSxDQUFDRyxJQUFJO1VBQ25CRSxHQUFHLEVBQUVBLEdBQUc7VUFDUkMsT0FBTyxFQUFFQSxPQUFPO1VBQ2hCQyxLQUFLLEVBQUVBO1FBQ1QsQ0FBQyxDQUFDLENBQUM7TUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQztFQUNKO0VBQ0EsT0FBTyxhQUFhekUsS0FBSyxDQUFDMEQsYUFBYSxDQUFDdkQsU0FBUyxDQUFDWCxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUVDLFNBQVMsQ0FBQ0QsT0FBTyxFQUFFO0lBQ2hGcUYsTUFBTSxFQUFFakQsR0FBRztJQUNYQyxTQUFTLEVBQUVBLFNBQVM7SUFDcEJDLEtBQUssRUFBRUE7RUFDVCxDQUFDLEVBQUVVLEtBQUssRUFBRTtJQUNSRixNQUFNLEVBQUVBO0VBQ1YsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUM7QUFDRixJQUFJd0MsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFFBQVEsS0FBSyxZQUFZLEVBQUU7RUFDekN2RCxjQUFjLENBQUN3RCxXQUFXLEdBQUcsZ0JBQWdCO0FBQy9DO0FBQ0EsSUFBSUMsUUFBUSxHQUFHNUYsT0FBTyxDQUFDRSxPQUFPLEdBQUdpQyxjQUFjIiwiaWdub3JlTGlzdCI6W119