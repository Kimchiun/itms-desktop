1f9fc2db193c206a033f497d3577592b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ensurePgConnected = ensurePgConnected;
exports.testPgConnection = testPgConnection;
const pg_1 = require("pg");
const pgClient = new pg_1.Client({
    user: process.env.PGUSER || 'postgres',
    host: process.env.PGHOST || 'localhost',
    database: process.env.PGDATABASE || 'itms',
    password: process.env.PGPASSWORD || 'password',
    port: Number(process.env.PGPORT) || 5432,
});
let isConnected = false;
async function ensurePgConnected() {
    if (!isConnected) {
        await pgClient.connect();
        isConnected = true;
    }
}
async function testPgConnection() {
    try {
        await ensurePgConnected();
        await pgClient.query('SELECT NOW()');
        return true;
    }
    catch (err) {
        return false;
    }
}
exports.default = pgClient;
// users 테이블 생성 예시
// CREATE TABLE users (
//   id SERIAL PRIMARY KEY,
//   username VARCHAR(64) UNIQUE NOT NULL,
//   password VARCHAR(128) NOT NULL,
//   role VARCHAR(16) NOT NULL,
//   created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
// ); 
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvaW5mcmFzdHJ1Y3R1cmUvZGF0YWJhc2UvcGdDbGllbnQudHMiLCJtYXBwaW5ncyI6Ijs7QUFZQSw4Q0FLQztBQUVELDRDQVFDO0FBM0JELDJCQUE0QjtBQUU1QixNQUFNLFFBQVEsR0FBRyxJQUFJLFdBQU0sQ0FBQztJQUN4QixJQUFJLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLElBQUksVUFBVTtJQUN0QyxJQUFJLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLElBQUksV0FBVztJQUN2QyxRQUFRLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksTUFBTTtJQUMxQyxRQUFRLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksVUFBVTtJQUM5QyxJQUFJLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSTtDQUMzQyxDQUFDLENBQUM7QUFFSCxJQUFJLFdBQVcsR0FBRyxLQUFLLENBQUM7QUFFakIsS0FBSyxVQUFVLGlCQUFpQjtJQUNuQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDZixNQUFNLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUN6QixXQUFXLEdBQUcsSUFBSSxDQUFDO0lBQ3ZCLENBQUM7QUFDTCxDQUFDO0FBRU0sS0FBSyxVQUFVLGdCQUFnQjtJQUNsQyxJQUFJLENBQUM7UUFDRCxNQUFNLGlCQUFpQixFQUFFLENBQUM7UUFDMUIsTUFBTSxRQUFRLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3JDLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ1gsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztBQUNMLENBQUM7QUFFRCxrQkFBZSxRQUFRLENBQUM7QUFFeEIsa0JBQWtCO0FBQ2xCLHVCQUF1QjtBQUN2QiwyQkFBMkI7QUFDM0IsMENBQTBDO0FBQzFDLG9DQUFvQztBQUNwQywrQkFBK0I7QUFDL0IsbURBQW1EO0FBQ25ELE1BQU0iLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvaW5mcmFzdHJ1Y3R1cmUvZGF0YWJhc2UvcGdDbGllbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2xpZW50IH0gZnJvbSAncGcnO1xuXG5jb25zdCBwZ0NsaWVudCA9IG5ldyBDbGllbnQoe1xuICAgIHVzZXI6IHByb2Nlc3MuZW52LlBHVVNFUiB8fCAncG9zdGdyZXMnLFxuICAgIGhvc3Q6IHByb2Nlc3MuZW52LlBHSE9TVCB8fCAnbG9jYWxob3N0JyxcbiAgICBkYXRhYmFzZTogcHJvY2Vzcy5lbnYuUEdEQVRBQkFTRSB8fCAnaXRtcycsXG4gICAgcGFzc3dvcmQ6IHByb2Nlc3MuZW52LlBHUEFTU1dPUkQgfHwgJ3Bhc3N3b3JkJyxcbiAgICBwb3J0OiBOdW1iZXIocHJvY2Vzcy5lbnYuUEdQT1JUKSB8fCA1NDMyLFxufSk7XG5cbmxldCBpc0Nvbm5lY3RlZCA9IGZhbHNlO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlUGdDb25uZWN0ZWQoKSB7XG4gICAgaWYgKCFpc0Nvbm5lY3RlZCkge1xuICAgICAgICBhd2FpdCBwZ0NsaWVudC5jb25uZWN0KCk7XG4gICAgICAgIGlzQ29ubmVjdGVkID0gdHJ1ZTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB0ZXN0UGdDb25uZWN0aW9uKCkge1xuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGVuc3VyZVBnQ29ubmVjdGVkKCk7XG4gICAgICAgIGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KCdTRUxFQ1QgTk9XKCknKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHBnQ2xpZW50O1xuXG4vLyB1c2VycyDthYzsnbTruJQg7IOd7ISxIOyYiOyLnFxuLy8gQ1JFQVRFIFRBQkxFIHVzZXJzIChcbi8vICAgaWQgU0VSSUFMIFBSSU1BUlkgS0VZLFxuLy8gICB1c2VybmFtZSBWQVJDSEFSKDY0KSBVTklRVUUgTk9UIE5VTEwsXG4vLyAgIHBhc3N3b3JkIFZBUkNIQVIoMTI4KSBOT1QgTlVMTCxcbi8vICAgcm9sZSBWQVJDSEFSKDE2KSBOT1QgTlVMTCxcbi8vICAgY3JlYXRlZF9hdCBUSU1FU1RBTVAgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUFxuLy8gKTsgIl0sInZlcnNpb24iOjN9