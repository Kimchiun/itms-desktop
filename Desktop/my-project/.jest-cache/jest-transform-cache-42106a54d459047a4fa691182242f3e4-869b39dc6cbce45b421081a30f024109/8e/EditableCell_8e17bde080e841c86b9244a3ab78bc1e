3460fd967785f430cec01e9c47f89fe3
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const styled_components_1 = __importDefault(require("styled-components"));
const CellContainer = styled_components_1.default.div `
  position: relative;
  width: 100%;
  height: 100%;
`;
const DisplayValue = styled_components_1.default.div `
  padding: 8px 12px;
  border: 2px solid transparent;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
  
  &:hover {
    border-color: #e2e8f0;
    background-color: #f8fafc;
  }
  
  &.editing {
    border-color: #3b82f6;
    background-color: #eff6ff;
  }
`;
const Input = styled_components_1.default.input `
  width: 100%;
  padding: 8px 12px;
  border: 2px solid #3b82f6;
  border-radius: 4px;
  font-size: inherit;
  font-family: inherit;
  outline: none;
  background-color: white;
  
  &:focus {
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
`;
const Select = styled_components_1.default.select `
  width: 100%;
  padding: 8px 12px;
  border: 2px solid #3b82f6;
  border-radius: 4px;
  font-size: inherit;
  font-family: inherit;
  outline: none;
  background-color: white;
  cursor: pointer;
  
  &:focus {
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
`;
const Checkbox = styled_components_1.default.input `
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: #3b82f6;
`;
const SaveIndicator = styled_components_1.default.div `
  position: absolute;
  top: -20px;
  right: 0;
  background-color: #10b981;
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 12px;
  opacity: 0;
  transition: opacity 0.3s ease;
  
  &.saving {
    opacity: 1;
  }
`;
const EditableCell = ({ value, type = 'text', options = [], onSave, onCancel, placeholder = '', disabled = false, className = '' }) => {
    const [isEditing, setIsEditing] = (0, react_1.useState)(false);
    const [editValue, setEditValue] = (0, react_1.useState)(value);
    const [isSaving, setIsSaving] = (0, react_1.useState)(false);
    const inputRef = (0, react_1.useRef)(null);
    const selectRef = (0, react_1.useRef)(null);
    const saveTimeoutRef = (0, react_1.useRef)(undefined);
    // 편집 모드 진입
    const startEditing = (0, react_1.useCallback)(() => {
        if (disabled)
            return;
        setIsEditing(true);
        setEditValue(value);
    }, [disabled, value]);
    // 편집 모드 종료
    const stopEditing = (0, react_1.useCallback)(() => {
        setIsEditing(false);
        setIsSaving(false);
        if (saveTimeoutRef.current) {
            clearTimeout(saveTimeoutRef.current);
        }
    }, []);
    // 저장 실행
    const saveValue = (0, react_1.useCallback)(() => {
        if (editValue !== value) {
            setIsSaving(true);
            onSave(editValue);
            // 저장 완료 표시 후 숨김
            setTimeout(() => {
                setIsSaving(false);
            }, 1000);
        }
        stopEditing();
    }, [editValue, value, onSave, stopEditing]);
    // 취소
    const cancelEdit = (0, react_1.useCallback)(() => {
        setEditValue(value);
        stopEditing();
        onCancel?.();
    }, [value, stopEditing, onCancel]);
    // 자동저장 (debounce)
    const debouncedSave = (0, react_1.useCallback)(() => {
        if (saveTimeoutRef.current) {
            clearTimeout(saveTimeoutRef.current);
        }
        saveTimeoutRef.current = setTimeout(() => {
            if (editValue !== value) {
                setIsSaving(true);
                onSave(editValue);
                setTimeout(() => setIsSaving(false), 1000);
            }
        }, 500);
    }, [editValue, value, onSave]);
    // 키보드 이벤트 처리
    const handleKeyDown = (0, react_1.useCallback)((e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            saveValue();
        }
        else if (e.key === 'Escape') {
            e.preventDefault();
            cancelEdit();
        }
    }, [saveValue, cancelEdit]);
    // 값 변경 시 자동저장
    (0, react_1.useEffect)(() => {
        if (isEditing && editValue !== value) {
            debouncedSave();
        }
    }, [editValue, isEditing, value, debouncedSave]);
    // 포커스 관리
    (0, react_1.useEffect)(() => {
        if (isEditing) {
            if (type === 'select' && selectRef.current) {
                selectRef.current.focus();
            }
            else if (inputRef.current) {
                inputRef.current.focus();
                inputRef.current.select();
            }
        }
    }, [isEditing, type]);
    // 값 변경 시 편집값 동기화
    (0, react_1.useEffect)(() => {
        if (!isEditing) {
            setEditValue(value);
        }
    }, [value, isEditing]);
    // 렌더링 함수들
    const renderDisplayValue = () => {
        if (type === 'checkbox') {
            return ((0, jsx_runtime_1.jsx)(Checkbox, { type: "checkbox", checked: Boolean(value), onChange: (e) => onSave(e.target.checked), disabled: disabled }));
        }
        if (type === 'select') {
            const option = options.find(opt => opt.value === String(value));
            return option?.label || String(value);
        }
        return String(value);
    };
    const renderEditInput = () => {
        if (type === 'select') {
            return ((0, jsx_runtime_1.jsx)(Select, { ref: selectRef, value: String(editValue), onChange: (e) => setEditValue(e.target.value), onKeyDown: handleKeyDown, onBlur: saveValue, children: options.map(option => ((0, jsx_runtime_1.jsx)("option", { value: option.value, children: option.label }, option.value))) }));
        }
        if (type === 'checkbox') {
            return ((0, jsx_runtime_1.jsx)(Checkbox, { type: "checkbox", checked: Boolean(editValue), onChange: (e) => setEditValue(e.target.checked), onKeyDown: handleKeyDown, onBlur: saveValue }));
        }
        return ((0, jsx_runtime_1.jsx)(Input, { ref: inputRef, type: "text", value: String(editValue), onChange: (e) => setEditValue(e.target.value), onKeyDown: handleKeyDown, onBlur: saveValue, placeholder: placeholder }));
    };
    return ((0, jsx_runtime_1.jsxs)(CellContainer, { className: className, children: [isEditing ? (renderEditInput()) : ((0, jsx_runtime_1.jsx)(DisplayValue, { onClick: startEditing, className: isEditing ? 'editing' : '', children: renderDisplayValue() })), (0, jsx_runtime_1.jsx)(SaveIndicator, { className: isSaving ? 'saving' : '', children: "\uC800\uC7A5\uB428" })] }));
};
exports.default = EditableCell;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvcmVuZGVyZXIvc2hhcmVkL2NvbXBvbmVudHMvRWRpdGFibGVDZWxsLnRzeCIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxpQ0FBd0U7QUFDeEUsMEVBQXVDO0FBYXZDLE1BQU0sYUFBYSxHQUFHLDJCQUFNLENBQUMsR0FBRyxDQUFBOzs7O0NBSS9CLENBQUM7QUFFRixNQUFNLFlBQVksR0FBRywyQkFBTSxDQUFDLEdBQUcsQ0FBQTs7Ozs7Ozs7Ozs7Ozs7OztDQWdCOUIsQ0FBQztBQUVGLE1BQU0sS0FBSyxHQUFHLDJCQUFNLENBQUMsS0FBSyxDQUFBOzs7Ozs7Ozs7Ozs7O0NBYXpCLENBQUM7QUFFRixNQUFNLE1BQU0sR0FBRywyQkFBTSxDQUFDLE1BQU0sQ0FBQTs7Ozs7Ozs7Ozs7Ozs7Q0FjM0IsQ0FBQztBQUVGLE1BQU0sUUFBUSxHQUFHLDJCQUFNLENBQUMsS0FBSyxDQUFBOzs7OztDQUs1QixDQUFDO0FBRUYsTUFBTSxhQUFhLEdBQUcsMkJBQU0sQ0FBQyxHQUFHLENBQUE7Ozs7Ozs7Ozs7Ozs7OztDQWUvQixDQUFDO0FBRUYsTUFBTSxZQUFZLEdBQWdDLENBQUMsRUFDakQsS0FBSyxFQUNMLElBQUksR0FBRyxNQUFNLEVBQ2IsT0FBTyxHQUFHLEVBQUUsRUFDWixNQUFNLEVBQ04sUUFBUSxFQUNSLFdBQVcsR0FBRyxFQUFFLEVBQ2hCLFFBQVEsR0FBRyxLQUFLLEVBQ2hCLFNBQVMsR0FBRyxFQUFFLEVBQ2YsRUFBRSxFQUFFO0lBQ0gsTUFBTSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsS0FBSyxDQUFDLENBQUM7SUFDbEQsTUFBTSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsS0FBSyxDQUFDLENBQUM7SUFDbEQsTUFBTSxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsS0FBSyxDQUFD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QyxFQUFFLG1DQUVsQyxJQUNGLENBQ2pCLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRixrQkFBZSxZQUFZLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvcmVuZGVyZXIvc2hhcmVkL2NvbXBvbmVudHMvRWRpdGFibGVDZWxsLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlUmVmLCB1c2VDYWxsYmFjayB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuXG5pbnRlcmZhY2UgRWRpdGFibGVDZWxsUHJvcHMge1xuICB2YWx1ZTogc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbjtcbiAgdHlwZT86ICd0ZXh0JyB8ICdzZWxlY3QnIHwgJ2NoZWNrYm94JztcbiAgb3B0aW9ucz86IHsgdmFsdWU6IHN0cmluZzsgbGFiZWw6IHN0cmluZyB9W107XG4gIG9uU2F2ZTogKHZhbHVlOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuKSA9PiB2b2lkO1xuICBvbkNhbmNlbD86ICgpID0+IHZvaWQ7XG4gIHBsYWNlaG9sZGVyPzogc3RyaW5nO1xuICBkaXNhYmxlZD86IGJvb2xlYW47XG4gIGNsYXNzTmFtZT86IHN0cmluZztcbn1cblxuY29uc3QgQ2VsbENvbnRhaW5lciA9IHN0eWxlZC5kaXZgXG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMTAwJTtcbmA7XG5cbmNvbnN0IERpc3BsYXlWYWx1ZSA9IHN0eWxlZC5kaXZgXG4gIHBhZGRpbmc6IDhweCAxMnB4O1xuICBib3JkZXI6IDJweCBzb2xpZCB0cmFuc3BhcmVudDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7XG4gIFxuICAmOmhvdmVyIHtcbiAgICBib3JkZXItY29sb3I6ICNlMmU4ZjA7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogI2Y4ZmFmYztcbiAgfVxuICBcbiAgJi5lZGl0aW5nIHtcbiAgICBib3JkZXItY29sb3I6ICMzYjgyZjY7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogI2VmZjZmZjtcbiAgfVxuYDtcblxuY29uc3QgSW5wdXQgPSBzdHlsZWQuaW5wdXRgXG4gIHdpZHRoOiAxMDAlO1xuICBwYWRkaW5nOiA4cHggMTJweDtcbiAgYm9yZGVyOiAycHggc29saWQgIzNiODJmNjtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXNpemU6IGluaGVyaXQ7XG4gIGZvbnQtZmFtaWx5OiBpbmhlcml0O1xuICBvdXRsaW5lOiBub25lO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTtcbiAgXG4gICY6Zm9jdXMge1xuICAgIGJveC1zaGFkb3c6IDAgMCAwIDNweCByZ2JhKDU5LCAxMzAsIDI0NiwgMC4xKTtcbiAgfVxuYDtcblxuY29uc3QgU2VsZWN0ID0gc3R5bGVkLnNlbGVjdGBcbiAgd2lkdGg6IDEwMCU7XG4gIHBhZGRpbmc6IDhweCAxMnB4O1xuICBib3JkZXI6IDJweCBzb2xpZCAjM2I4MmY2O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtc2l6ZTogaW5oZXJpdDtcbiAgZm9udC1mYW1pbHk6IGluaGVyaXQ7XG4gIG91dGxpbmU6IG5vbmU7XG4gIGJhY2tncm91bmQtY29sb3I6IHdoaXRlO1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIFxuICAmOmZvY3VzIHtcbiAgICBib3gtc2hhZG93OiAwIDAgMCAzcHggcmdiYSg1OSwgMTMwLCAyNDYsIDAuMSk7XG4gIH1cbmA7XG5cbmNvbnN0IENoZWNrYm94ID0gc3R5bGVkLmlucHV0YFxuICB3aWR0aDogMThweDtcbiAgaGVpZ2h0OiAxOHB4O1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIGFjY2VudC1jb2xvcjogIzNiODJmNjtcbmA7XG5cbmNvbnN0IFNhdmVJbmRpY2F0b3IgPSBzdHlsZWQuZGl2YFxuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHRvcDogLTIwcHg7XG4gIHJpZ2h0OiAwO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTBiOTgxO1xuICBjb2xvcjogd2hpdGU7XG4gIHBhZGRpbmc6IDJweCA2cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC1zaXplOiAxMnB4O1xuICBvcGFjaXR5OiAwO1xuICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuM3MgZWFzZTtcbiAgXG4gICYuc2F2aW5nIHtcbiAgICBvcGFjaXR5OiAxO1xuICB9XG5gO1xuXG5jb25zdCBFZGl0YWJsZUNlbGw6IFJlYWN0LkZDPEVkaXRhYmxlQ2VsbFByb3BzPiA9ICh7XG4gIHZhbHVlLFxuICB0eXBlID0gJ3RleHQnLFxuICBvcHRpb25zID0gW10sXG4gIG9uU2F2ZSxcbiAgb25DYW5jZWwsXG4gIHBsYWNlaG9sZGVyID0gJycsXG4gIGRpc2FibGVkID0gZmFsc2UsXG4gIGNsYXNzTmFtZSA9ICcnXG59KSA9PiB7XG4gIGNvbnN0IFtpc0VkaXRpbmcsIHNldElzRWRpdGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtlZGl0VmFsdWUsIHNldEVkaXRWYWx1ZV0gPSB1c2VTdGF0ZSh2YWx1ZSk7XG4gIGNvbnN0IFtpc1NhdmluZywgc2V0SXNTYXZpbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBpbnB1dFJlZiA9IHVzZVJlZjxIVE1MSW5wdXRFbGVtZW50PihudWxsKTtcbiAgY29uc3Qgc2VsZWN0UmVmID0gdXNlUmVmPEhUTUxTZWxlY3RFbGVtZW50PihudWxsKTtcbiAgY29uc3Qgc2F2ZVRpbWVvdXRSZWYgPSB1c2VSZWY8Tm9kZUpTLlRpbWVvdXQgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG5cbiAgLy8g7Y647KeRIOuqqOuTnCDsp4TsnoVcbiAgY29uc3Qgc3RhcnRFZGl0aW5nID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGlmIChkaXNhYmxlZCkgcmV0dXJuO1xuICAgIHNldElzRWRpdGluZyh0cnVlKTtcbiAgICBzZXRFZGl0VmFsdWUodmFsdWUpO1xuICB9LCBbZGlzYWJsZWQsIHZhbHVlXSk7XG5cbiAgLy8g7Y647KeRIOuqqOuTnCDsooXro4xcbiAgY29uc3Qgc3RvcEVkaXRpbmcgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgc2V0SXNFZGl0aW5nKGZhbHNlKTtcbiAgICBzZXRJc1NhdmluZyhmYWxzZSk7XG4gICAgaWYgKHNhdmVUaW1lb3V0UmVmLmN1cnJlbnQpIHtcbiAgICAgIGNsZWFyVGltZW91dChzYXZlVGltZW91dFJlZi5jdXJyZW50KTtcbiAgICB9XG4gIH0sIFtdKTtcblxuICAvLyDsoIDsnqUg7Iuk7ZaJXG4gIGNvbnN0IHNhdmVWYWx1ZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoZWRpdFZhbHVlICE9PSB2YWx1ZSkge1xuICAgICAgc2V0SXNTYXZpbmcodHJ1ZSk7XG4gICAgICBvblNhdmUoZWRpdFZhbHVlKTtcbiAgICAgIFxuICAgICAgLy8g7KCA7J6lIOyZhOujjCDtkZzsi5wg7ZuEIOyIqOq5gFxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHNldElzU2F2aW5nKGZhbHNlKTtcbiAgICAgIH0sIDEwMDApO1xuICAgIH1cbiAgICBzdG9wRWRpdGluZygpO1xuICB9LCBbZWRpdFZhbHVlLCB2YWx1ZSwgb25TYXZlLCBzdG9wRWRpdGluZ10pO1xuXG4gIC8vIOy3qOyGjFxuICBjb25zdCBjYW5jZWxFZGl0ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldEVkaXRWYWx1ZSh2YWx1ZSk7XG4gICAgc3RvcEVkaXRpbmcoKTtcbiAgICBvbkNhbmNlbD8uKCk7XG4gIH0sIFt2YWx1ZSwgc3RvcEVkaXRpbmcsIG9uQ2FuY2VsXSk7XG5cbiAgLy8g7J6Q64+Z7KCA7J6lIChkZWJvdW5jZSlcbiAgY29uc3QgZGVib3VuY2VkU2F2ZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoc2F2ZVRpbWVvdXRSZWYuY3VycmVudCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHNhdmVUaW1lb3V0UmVmLmN1cnJlbnQpO1xuICAgIH1cbiAgICBcbiAgICBzYXZlVGltZW91dFJlZi5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAoZWRpdFZhbHVlICE9PSB2YWx1ZSkge1xuICAgICAgICBzZXRJc1NhdmluZyh0cnVlKTtcbiAgICAgICAgb25TYXZlKGVkaXRWYWx1ZSk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gc2V0SXNTYXZpbmcoZmFsc2UpLCAxMDAwKTtcbiAgICAgIH1cbiAgICB9LCA1MDApO1xuICB9LCBbZWRpdFZhbHVlLCB2YWx1ZSwgb25TYXZlXSk7XG5cbiAgLy8g7YKk67O065OcIOydtOuypO2KuCDsspjrpqxcbiAgY29uc3QgaGFuZGxlS2V5RG93biA9IHVzZUNhbGxiYWNrKChlOiBSZWFjdC5LZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgaWYgKGUua2V5ID09PSAnRW50ZXInKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBzYXZlVmFsdWUoKTtcbiAgICB9IGVsc2UgaWYgKGUua2V5ID09PSAnRXNjYXBlJykge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY2FuY2VsRWRpdCgpO1xuICAgIH1cbiAgfSwgW3NhdmVWYWx1ZSwgY2FuY2VsRWRpdF0pO1xuXG4gIC8vIOqwkiDrs4Dqsr0g7IucIOyekOuPmeyggOyepVxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChpc0VkaXRpbmcgJiYgZWRpdFZhbHVlICE9PSB2YWx1ZSkge1xuICAgICAgZGVib3VuY2VkU2F2ZSgpO1xuICAgIH1cbiAgfSwgW2VkaXRWYWx1ZSwgaXNFZGl0aW5nLCB2YWx1ZSwgZGVib3VuY2VkU2F2ZV0pO1xuXG4gIC8vIO2PrOy7pOyKpCDqtIDrpqxcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoaXNFZGl0aW5nKSB7XG4gICAgICBpZiAodHlwZSA9PT0gJ3NlbGVjdCcgJiYgc2VsZWN0UmVmLmN1cnJlbnQpIHtcbiAgICAgICAgc2VsZWN0UmVmLmN1cnJlbnQuZm9jdXMoKTtcbiAgICAgIH0gZWxzZSBpZiAoaW5wdXRSZWYuY3VycmVudCkge1xuICAgICAgICBpbnB1dFJlZi5jdXJyZW50LmZvY3VzKCk7XG4gICAgICAgIGlucHV0UmVmLmN1cnJlbnQuc2VsZWN0KCk7XG4gICAgICB9XG4gICAgfVxuICB9LCBbaXNFZGl0aW5nLCB0eXBlXSk7XG5cbiAgLy8g6rCSIOuzgOqyvSDsi5wg7Y647KeR6rCSIOuPmeq4sO2ZlFxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmICghaXNFZGl0aW5nKSB7XG4gICAgICBzZXRFZGl0VmFsdWUodmFsdWUpO1xuICAgIH1cbiAgfSwgW3ZhbHVlLCBpc0VkaXRpbmddKTtcblxuICAvLyDroIzrjZTrp4Eg7ZWo7IiY65OkXG4gIGNvbnN0IHJlbmRlckRpc3BsYXlWYWx1ZSA9ICgpID0+IHtcbiAgICBpZiAodHlwZSA9PT0gJ2NoZWNrYm94Jykge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPENoZWNrYm94XG4gICAgICAgICAgdHlwZT1cImNoZWNrYm94XCJcbiAgICAgICAgICBjaGVja2VkPXtCb29sZWFuKHZhbHVlKX1cbiAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IG9uU2F2ZShlLnRhcmdldC5jaGVja2VkKX1cbiAgICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgIC8+XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICBpZiAodHlwZSA9PT0gJ3NlbGVjdCcpIHtcbiAgICAgIGNvbnN0IG9wdGlvbiA9IG9wdGlvbnMuZmluZChvcHQgPT4gb3B0LnZhbHVlID09PSBTdHJpbmcodmFsdWUpKTtcbiAgICAgIHJldHVybiBvcHRpb24/LmxhYmVsIHx8IFN0cmluZyh2YWx1ZSk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBTdHJpbmcodmFsdWUpO1xuICB9O1xuXG4gIGNvbnN0IHJlbmRlckVkaXRJbnB1dCA9ICgpID0+IHtcbiAgICBpZiAodHlwZSA9PT0gJ3NlbGVjdCcpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxTZWxlY3RcbiAgICAgICAgICByZWY9e3NlbGVjdFJlZn1cbiAgICAgICAgICB2YWx1ZT17U3RyaW5nKGVkaXRWYWx1ZSl9XG4gICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRFZGl0VmFsdWUoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgIG9uS2V5RG93bj17aGFuZGxlS2V5RG93bn1cbiAgICAgICAgICBvbkJsdXI9e3NhdmVWYWx1ZX1cbiAgICAgICAgPlxuICAgICAgICAgIHtvcHRpb25zLm1hcChvcHRpb24gPT4gKFxuICAgICAgICAgICAgPG9wdGlvbiBrZXk9e29wdGlvbi52YWx1ZX0gdmFsdWU9e29wdGlvbi52YWx1ZX0+XG4gICAgICAgICAgICAgIHtvcHRpb24ubGFiZWx9XG4gICAgICAgICAgICA8L29wdGlvbj5cbiAgICAgICAgICApKX1cbiAgICAgICAgPC9TZWxlY3Q+XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICBpZiAodHlwZSA9PT0gJ2NoZWNrYm94Jykge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPENoZWNrYm94XG4gICAgICAgICAgdHlwZT1cImNoZWNrYm94XCJcbiAgICAgICAgICBjaGVja2VkPXtCb29sZWFuKGVkaXRWYWx1ZSl9XG4gICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRFZGl0VmFsdWUoZS50YXJnZXQuY2hlY2tlZCl9XG4gICAgICAgICAgb25LZXlEb3duPXtoYW5kbGVLZXlEb3dufVxuICAgICAgICAgIG9uQmx1cj17c2F2ZVZhbHVlfVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIChcbiAgICAgIDxJbnB1dFxuICAgICAgICByZWY9e2lucHV0UmVmfVxuICAgICAgICB0eXBlPVwidGV4dFwiXG4gICAgICAgIHZhbHVlPXtTdHJpbmcoZWRpdFZhbHVlKX1cbiAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRFZGl0VmFsdWUoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICBvbktleURvd249e2hhbmRsZUtleURvd259XG4gICAgICAgIG9uQmx1cj17c2F2ZVZhbHVlfVxuICAgICAgICBwbGFjZWhvbGRlcj17cGxhY2Vob2xkZXJ9XG4gICAgICAvPlxuICAgICk7XG4gIH07XG5cbiAgcmV0dXJuIChcbiAgICA8Q2VsbENvbnRhaW5lciBjbGFzc05hbWU9e2NsYXNzTmFtZX0+XG4gICAgICB7aXNFZGl0aW5nID8gKFxuICAgICAgICByZW5kZXJFZGl0SW5wdXQoKVxuICAgICAgKSA6IChcbiAgICAgICAgPERpc3BsYXlWYWx1ZVxuICAgICAgICAgIG9uQ2xpY2s9e3N0YXJ0RWRpdGluZ31cbiAgICAgICAgICBjbGFzc05hbWU9e2lzRWRpdGluZyA/ICdlZGl0aW5nJyA6ICcnfVxuICAgICAgICA+XG4gICAgICAgICAge3JlbmRlckRpc3BsYXlWYWx1ZSgpfVxuICAgICAgICA8L0Rpc3BsYXlWYWx1ZT5cbiAgICAgICl9XG4gICAgICBcbiAgICAgIDxTYXZlSW5kaWNhdG9yIGNsYXNzTmFtZT17aXNTYXZpbmcgPyAnc2F2aW5nJyA6ICcnfT5cbiAgICAgICAg7KCA7J6l65CoXG4gICAgICA8L1NhdmVJbmRpY2F0b3I+XG4gICAgPC9DZWxsQ29udGFpbmVyPlxuICApO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgRWRpdGFibGVDZWxsOyAiXSwidmVyc2lvbiI6M30=