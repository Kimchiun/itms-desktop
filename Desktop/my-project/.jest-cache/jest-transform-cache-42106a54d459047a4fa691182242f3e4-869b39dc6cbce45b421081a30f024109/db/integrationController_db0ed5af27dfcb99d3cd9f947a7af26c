ab7e284a3f8b4a53ddca05cd28790332
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const jiraClient_1 = require("../../../infrastructure/integrations/jiraClient");
const redmineClient_1 = require("../../../infrastructure/integrations/redmineClient");
const executionService_1 = require("../services/executionService");
const router = (0, express_1.Router)();
// POST /api/integrations/jira-issue
router.post('/jira-issue', async (req, res) => {
    const { executionId, summary, description, projectKey, jiraUrl, username, apiToken, issueType } = req.body;
    try {
        const result = await (0, jiraClient_1.createJiraIssue)({ summary, description, projectKey, jiraUrl, username, apiToken, issueType });
        // 실행 기록에 이슈 ID 저장
        await executionService_1.executionService.updateExecution(executionId, { comment: `[Jira:${result.key}] ${result.url}` });
        res.json(result);
    }
    catch (err) {
        res.status(500).json({ error: err.message });
    }
});
// POST /api/integrations/redmine-issue
router.post('/redmine-issue', async (req, res) => {
    const { executionId, subject, description, projectId, redmineUrl, apiKey, trackerId } = req.body;
    try {
        const result = await (0, redmineClient_1.createRedmineIssue)({ subject, description, projectId, redmineUrl, apiKey, trackerId });
        // 실행 기록에 이슈 ID 저장
        await executionService_1.executionService.updateExecution(executionId, { comment: `[Redmine:${result.id}] ${result.url}` });
        res.json(result);
    }
    catch (err) {
        res.status(500).json({ error: err.message });
    }
});
exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvZG9tYWlucy9leGVjdXRpb25zL2NvbnRyb2xsZXJzL2ludGVncmF0aW9uQ29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOztBQUFBLHFDQUFvRDtBQUNwRCxnRkFBa0Y7QUFDbEYsc0ZBQXdGO0FBQ3hGLG1FQUFnRTtBQUVoRSxNQUFNLE1BQU0sR0FBRyxJQUFBLGdCQUFNLEdBQUUsQ0FBQztBQUV4QixvQ0FBb0M7QUFDcEMsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsS0FBSyxFQUFFLEdBQVksRUFBRSxHQUFhLEVBQUUsRUFBRTtJQUM3RCxNQUFNLEVBQUUsV0FBVyxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFDM0csSUFBSSxDQUFDO1FBQ0QsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLDRCQUFlLEVBQUMsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBQ25ILGtCQUFrQjtRQUNsQixNQUFNLG1DQUFnQixDQUFDLGVBQWUsQ0FBQyxXQUFXLEVBQUUsRUFBRSxPQUFPLEVBQUUsU0FBUyxNQUFNLENBQUMsR0FBRyxLQUFLLE1BQU0sQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDdkcsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNyQixDQUFDO0lBQUMsT0FBTyxHQUFRLEVBQUUsQ0FBQztRQUNoQixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUNqRCxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCx1Q0FBdUM7QUFDdkMsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxLQUFLLEVBQUUsR0FBWSxFQUFFLEdBQWEsRUFBRSxFQUFFO0lBQ2hFLE1BQU0sRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO0lBQ2pHLElBQUksQ0FBQztRQUNELE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBQSxrQ0FBa0IsRUFBQyxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQztRQUM1RyxrQkFBa0I7UUFDbEIsTUFBTSxtQ0FBZ0IsQ0FBQyxlQUFlLENBQUMsV0FBVyxFQUFFLEVBQUUsT0FBTyxFQUFFLFlBQVksTUFBTSxDQUFDLEVBQUUsS0FBSyxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3pHLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDckIsQ0FBQztJQUFDLE9BQU8sR0FBUSxFQUFFLENBQUM7UUFDaEIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDakQsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsa0JBQWUsTUFBTSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy8zaS1hMS0yMDIxLTAxNy9EZXNrdG9wL215LXByb2plY3Qvc3JjL21haW4vYXBwL2RvbWFpbnMvZXhlY3V0aW9ucy9jb250cm9sbGVycy9pbnRlZ3JhdGlvbkNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm91dGVyLCBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgY3JlYXRlSmlyYUlzc3VlIH0gZnJvbSAnLi4vLi4vLi4vaW5mcmFzdHJ1Y3R1cmUvaW50ZWdyYXRpb25zL2ppcmFDbGllbnQnO1xuaW1wb3J0IHsgY3JlYXRlUmVkbWluZUlzc3VlIH0gZnJvbSAnLi4vLi4vLi4vaW5mcmFzdHJ1Y3R1cmUvaW50ZWdyYXRpb25zL3JlZG1pbmVDbGllbnQnO1xuaW1wb3J0IHsgZXhlY3V0aW9uU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2V4ZWN1dGlvblNlcnZpY2UnO1xuXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKTtcblxuLy8gUE9TVCAvYXBpL2ludGVncmF0aW9ucy9qaXJhLWlzc3VlXG5yb3V0ZXIucG9zdCgnL2ppcmEtaXNzdWUnLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgY29uc3QgeyBleGVjdXRpb25JZCwgc3VtbWFyeSwgZGVzY3JpcHRpb24sIHByb2plY3RLZXksIGppcmFVcmwsIHVzZXJuYW1lLCBhcGlUb2tlbiwgaXNzdWVUeXBlIH0gPSByZXEuYm9keTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjcmVhdGVKaXJhSXNzdWUoeyBzdW1tYXJ5LCBkZXNjcmlwdGlvbiwgcHJvamVjdEtleSwgamlyYVVybCwgdXNlcm5hbWUsIGFwaVRva2VuLCBpc3N1ZVR5cGUgfSk7XG4gICAgICAgIC8vIOyLpO2WiSDquLDroZ3sl5Ag7J207IqIIElEIOyggOyepVxuICAgICAgICBhd2FpdCBleGVjdXRpb25TZXJ2aWNlLnVwZGF0ZUV4ZWN1dGlvbihleGVjdXRpb25JZCwgeyBjb21tZW50OiBgW0ppcmE6JHtyZXN1bHQua2V5fV0gJHtyZXN1bHQudXJsfWAgfSk7XG4gICAgICAgIHJlcy5qc29uKHJlc3VsdCk7XG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogZXJyLm1lc3NhZ2UgfSk7XG4gICAgfVxufSk7XG5cbi8vIFBPU1QgL2FwaS9pbnRlZ3JhdGlvbnMvcmVkbWluZS1pc3N1ZVxucm91dGVyLnBvc3QoJy9yZWRtaW5lLWlzc3VlJywgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIGNvbnN0IHsgZXhlY3V0aW9uSWQsIHN1YmplY3QsIGRlc2NyaXB0aW9uLCBwcm9qZWN0SWQsIHJlZG1pbmVVcmwsIGFwaUtleSwgdHJhY2tlcklkIH0gPSByZXEuYm9keTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjcmVhdGVSZWRtaW5lSXNzdWUoeyBzdWJqZWN0LCBkZXNjcmlwdGlvbiwgcHJvamVjdElkLCByZWRtaW5lVXJsLCBhcGlLZXksIHRyYWNrZXJJZCB9KTtcbiAgICAgICAgLy8g7Iuk7ZaJIOq4sOuhneyXkCDsnbTsioggSUQg7KCA7J6lXG4gICAgICAgIGF3YWl0IGV4ZWN1dGlvblNlcnZpY2UudXBkYXRlRXhlY3V0aW9uKGV4ZWN1dGlvbklkLCB7IGNvbW1lbnQ6IGBbUmVkbWluZToke3Jlc3VsdC5pZH1dICR7cmVzdWx0LnVybH1gIH0pO1xuICAgICAgICByZXMuanNvbihyZXN1bHQpO1xuICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGVyci5tZXNzYWdlIH0pO1xuICAgIH1cbn0pO1xuXG5leHBvcnQgZGVmYXVsdCByb3V0ZXI7ICJdLCJ2ZXJzaW9uIjozfQ==