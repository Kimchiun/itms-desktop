47e255ac98626606d09e10d32c43ebcb
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const folderService = __importStar(require("../services/folderService"));
const testCaseRepository_1 = require("../../testcases/repositories/testCaseRepository");
const router = (0, express_1.Router)();
// 일괄 이동 API
router.post('/move', async (req, res) => {
    try {
        const { folderIds, testCaseIds, targetFolderId } = req.body;
        if (!targetFolderId) {
            return res.status(400).json({ message: '대상 폴더 ID가 필요합니다.' });
        }
        const results = {
            folders: { success: 0, failed: 0, errors: [] },
            testCases: { success: 0, failed: 0, errors: [] }
        };
        // 폴더 일괄 이동
        if (folderIds && folderIds.length > 0) {
            for (const folderId of folderIds) {
                try {
                    await folderService.moveFolder(folderId, { targetParentId: targetFolderId, updatedBy: req.body.updatedBy || 'system' });
                    results.folders.success++;
                }
                catch (error) {
                    results.folders.failed++;
                    results.folders.errors.push({ folderId, error: error instanceof Error ? error.message : 'Unknown error' });
                }
            }
        }
        // 테스트 케이스 일괄 이동
        if (testCaseIds && testCaseIds.length > 0) {
            for (const testCaseId of testCaseIds) {
                try {
                    await folderService.addTestCaseToFolder(testCaseId, targetFolderId);
                    results.testCases.success++;
                }
                catch (error) {
                    results.testCases.failed++;
                    results.testCases.errors.push({ testCaseId, error: error instanceof Error ? error.message : 'Unknown error' });
                }
            }
        }
        res.json({
            message: '일괄 이동이 완료되었습니다.',
            results
        });
    }
    catch (error) {
        console.error('일괄 이동 실패:', error);
        res.status(500).json({ message: '일괄 이동에 실패했습니다.' });
    }
});
// 일괄 복사 API
router.post('/copy', async (req, res) => {
    try {
        const { folderIds, testCaseIds, targetFolderId } = req.body;
        if (!targetFolderId) {
            return res.status(400).json({ message: '대상 폴더 ID가 필요합니다.' });
        }
        const results = {
            folders: { success: 0, failed: 0, errors: [] },
            testCases: { success: 0, failed: 0, errors: [] }
        };
        // 폴더 일괄 복사
        if (folderIds && folderIds.length > 0) {
            for (const folderId of folderIds) {
                try {
                    const folder = await folderService.getFolderById(folderId);
                    if (folder) {
                        await folderService.createFolder({
                            name: `${folder.name} (복사본)`,
                            description: folder.description,
                            parentId: targetFolderId,
                            createdBy: req.body.createdBy || 'system'
                        });
                        results.folders.success++;
                    }
                }
                catch (error) {
                    results.folders.failed++;
                    results.folders.errors.push({ folderId, error: error instanceof Error ? error.message : 'Unknown error' });
                }
            }
        }
        // 테스트 케이스 일괄 복사
        if (testCaseIds && testCaseIds.length > 0) {
            for (const testCaseId of testCaseIds) {
                try {
                    const testCase = await (0, testCaseRepository_1.getTestCaseById)(testCaseId);
                    if (testCase) {
                        const copiedTestCase = await (0, testCaseRepository_1.createTestCase)({
                            title: `${testCase.title} (복사본)`,
                            prereq: testCase.prereq,
                            steps: testCase.steps,
                            expected: testCase.expected,
                            priority: testCase.priority,
                            tags: testCase.tags,
                            status: testCase.status,
                            createdBy: req.body.createdBy || 'system'
                        });
                        await folderService.addTestCaseToFolder(copiedTestCase.id, targetFolderId);
                        results.testCases.success++;
                    }
                }
                catch (error) {
                    results.testCases.failed++;
                    results.testCases.errors.push({ testCaseId, error: error instanceof Error ? error.message : 'Unknown error' });
                }
            }
        }
        res.json({
            message: '일괄 복사가 완료되었습니다.',
            results
        });
    }
    catch (error) {
        console.error('일괄 복사 실패:', error);
        res.status(500).json({ message: '일괄 복사에 실패했습니다.' });
    }
});
// 일괄 삭제 API
router.delete('/', async (req, res) => {
    try {
        const { folderIds, testCaseIds } = req.body;
        const results = {
            folders: { success: 0, failed: 0, errors: [] },
            testCases: { success: 0, failed: 0, errors: [] }
        };
        // 폴더 일괄 삭제
        if (folderIds && folderIds.length > 0) {
            for (const folderId of folderIds) {
                try {
                    await folderService.deleteFolder(folderId);
                    results.folders.success++;
                }
                catch (error) {
                    results.folders.failed++;
                    results.folders.errors.push({ folderId, error: error instanceof Error ? error.message : 'Unknown error' });
                }
            }
        }
        // 테스트 케이스 일괄 삭제
        if (testCaseIds && testCaseIds.length > 0) {
            for (const testCaseId of testCaseIds) {
                try {
                    await (0, testCaseRepository_1.deleteTestCase)(testCaseId);
                    results.testCases.success++;
                }
                catch (error) {
                    results.testCases.failed++;
                    results.testCases.errors.push({ testCaseId, error: error instanceof Error ? error.message : 'Unknown error' });
                }
            }
        }
        res.json({
            message: '일괄 삭제가 완료되었습니다.',
            results
        });
    }
    catch (error) {
        console.error('일괄 삭제 실패:', error);
        res.status(500).json({ message: '일괄 삭제에 실패했습니다.' });
    }
});
// 일괄 상태 변경 API
router.patch('/status', async (req, res) => {
    try {
        const { testCaseIds, status } = req.body;
        if (!status) {
            return res.status(400).json({ message: '상태 값이 필요합니다.' });
        }
        if (!testCaseIds || testCaseIds.length === 0) {
            return res.status(400).json({ message: '테스트 케이스 ID가 필요합니다.' });
        }
        const results = {
            success: 0,
            failed: 0,
            errors: []
        };
        for (const testCaseId of testCaseIds) {
            try {
                await (0, testCaseRepository_1.updateTestCase)(testCaseId, { status });
                results.success++;
            }
            catch (error) {
                results.failed++;
                results.errors.push({ testCaseId, error: error instanceof Error ? error.message : 'Unknown error' });
            }
        }
        res.json({
            message: '일괄 상태 변경이 완료되었습니다.',
            results
        });
    }
    catch (error) {
        console.error('일괄 상태 변경 실패:', error);
        res.status(500).json({ message: '일괄 상태 변경에 실패했습니다.' });
    }
});
exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC9zcmMvbWFpbi9hcHAvZG9tYWlucy9mb2xkZXJzL2NvbnRyb2xsZXJzL2J1bGtDb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEscUNBQWlDO0FBQ2pDLHlFQUEyRDtBQUMzRCx3RkFBa0k7QUFFbEksTUFBTSxNQUFNLEdBQUcsSUFBQSxnQkFBTSxHQUFFLENBQUM7QUFFeEIsWUFBWTtBQUNaLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7SUFDcEMsSUFBSSxDQUFDO1FBQ0QsTUFBTSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsY0FBYyxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztRQUU1RCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDbEIsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUM7UUFDakUsQ0FBQztRQUVELE1BQU0sT0FBTyxHQUFHO1lBQ1osT0FBTyxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxFQUFnRCxFQUFFO1lBQzVGLFNBQVMsRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsRUFBa0QsRUFBRTtTQUNuRyxDQUFDO1FBRUYsV0FBVztRQUNYLElBQUksU0FBUyxJQUFJLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDcEMsS0FBSyxNQUFNLFFBQVEsSUFBSSxTQUFTLEVBQUUsQ0FBQztnQkFDL0IsSUFBSSxDQUFDO29CQUNELE1BQU0sYUFBYSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsRUFB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QUFPLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDO0lBQzNELENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILGtCQUFlLE1BQU0sQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvM2ktYTEtMjAyMS0wMTcvRGVza3RvcC9teS1wcm9qZWN0L3NyYy9tYWluL2FwcC9kb21haW5zL2ZvbGRlcnMvY29udHJvbGxlcnMvYnVsa0NvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgKiBhcyBmb2xkZXJTZXJ2aWNlIGZyb20gJy4uL3NlcnZpY2VzL2ZvbGRlclNlcnZpY2UnO1xuaW1wb3J0IHsgY3JlYXRlVGVzdENhc2UsIGdldFRlc3RDYXNlQnlJZCwgdXBkYXRlVGVzdENhc2UsIGRlbGV0ZVRlc3RDYXNlIH0gZnJvbSAnLi4vLi4vdGVzdGNhc2VzL3JlcG9zaXRvcmllcy90ZXN0Q2FzZVJlcG9zaXRvcnknO1xuXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKTtcblxuLy8g7J286rSEIOydtOuPmSBBUElcbnJvdXRlci5wb3N0KCcvbW92ZScsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgZm9sZGVySWRzLCB0ZXN0Q2FzZUlkcywgdGFyZ2V0Rm9sZGVySWQgfSA9IHJlcS5ib2R5O1xuICAgICAgICBcbiAgICAgICAgaWYgKCF0YXJnZXRGb2xkZXJJZCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ+uMgOyDgSDtj7TrjZQgSUTqsIAg7ZWE7JqU7ZWp64uI64ukLicgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXN1bHRzID0ge1xuICAgICAgICAgICAgZm9sZGVyczogeyBzdWNjZXNzOiAwLCBmYWlsZWQ6IDAsIGVycm9yczogW10gYXMgQXJyYXk8eyBmb2xkZXJJZDogbnVtYmVyOyBlcnJvcjogc3RyaW5nIH0+IH0sXG4gICAgICAgICAgICB0ZXN0Q2FzZXM6IHsgc3VjY2VzczogMCwgZmFpbGVkOiAwLCBlcnJvcnM6IFtdIGFzIEFycmF5PHsgdGVzdENhc2VJZDogbnVtYmVyOyBlcnJvcjogc3RyaW5nIH0+IH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyDtj7TrjZQg7J286rSEIOydtOuPmVxuICAgICAgICBpZiAoZm9sZGVySWRzICYmIGZvbGRlcklkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZvbGRlcklkIG9mIGZvbGRlcklkcykge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGZvbGRlclNlcnZpY2UubW92ZUZvbGRlcihmb2xkZXJJZCwgeyB0YXJnZXRQYXJlbnRJZDogdGFyZ2V0Rm9sZGVySWQsIHVwZGF0ZWRCeTogcmVxLmJvZHkudXBkYXRlZEJ5IHx8ICdzeXN0ZW0nIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmZvbGRlcnMuc3VjY2VzcysrO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuZm9sZGVycy5mYWlsZWQrKztcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5mb2xkZXJzLmVycm9ycy5wdXNoKHsgZm9sZGVySWQsIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyDthYzsiqTtirgg7LyA7J207IqkIOydvOq0hCDsnbTrj5lcbiAgICAgICAgaWYgKHRlc3RDYXNlSWRzICYmIHRlc3RDYXNlSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgdGVzdENhc2VJZCBvZiB0ZXN0Q2FzZUlkcykge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGZvbGRlclNlcnZpY2UuYWRkVGVzdENhc2VUb0ZvbGRlcih0ZXN0Q2FzZUlkLCB0YXJnZXRGb2xkZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMudGVzdENhc2VzLnN1Y2Nlc3MrKztcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnRlc3RDYXNlcy5mYWlsZWQrKztcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy50ZXN0Q2FzZXMuZXJyb3JzLnB1c2goeyB0ZXN0Q2FzZUlkLCBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmVzLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ+ydvOq0hCDsnbTrj5nsnbQg7JmE66OM65CY7JeI7Iq164uI64ukLicsXG4gICAgICAgICAgICByZXN1bHRzXG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+ydvOq0hCDsnbTrj5kg7Iuk7YyoOicsIGVycm9yKTtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAn7J286rSEIOydtOuPmeyXkCDsi6TtjKjtlojsirXri4jri6QuJyB9KTtcbiAgICB9XG59KTtcblxuLy8g7J286rSEIOuzteyCrCBBUElcbnJvdXRlci5wb3N0KCcvY29weScsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgZm9sZGVySWRzLCB0ZXN0Q2FzZUlkcywgdGFyZ2V0Rm9sZGVySWQgfSA9IHJlcS5ib2R5O1xuICAgICAgICBcbiAgICAgICAgaWYgKCF0YXJnZXRGb2xkZXJJZCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ+uMgOyDgSDtj7TrjZQgSUTqsIAg7ZWE7JqU7ZWp64uI64ukLicgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXN1bHRzID0ge1xuICAgICAgICAgICAgZm9sZGVyczogeyBzdWNjZXNzOiAwLCBmYWlsZWQ6IDAsIGVycm9yczogW10gYXMgQXJyYXk8eyBmb2xkZXJJZDogbnVtYmVyOyBlcnJvcjogc3RyaW5nIH0+IH0sXG4gICAgICAgICAgICB0ZXN0Q2FzZXM6IHsgc3VjY2VzczogMCwgZmFpbGVkOiAwLCBlcnJvcnM6IFtdIGFzIEFycmF5PHsgdGVzdENhc2VJZDogbnVtYmVyOyBlcnJvcjogc3RyaW5nIH0+IH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyDtj7TrjZQg7J286rSEIOuzteyCrFxuICAgICAgICBpZiAoZm9sZGVySWRzICYmIGZvbGRlcklkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZvbGRlcklkIG9mIGZvbGRlcklkcykge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IGF3YWl0IGZvbGRlclNlcnZpY2UuZ2V0Rm9sZGVyQnlJZChmb2xkZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmb2xkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGZvbGRlclNlcnZpY2UuY3JlYXRlRm9sZGVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBgJHtmb2xkZXIubmFtZX0gKOuzteyCrOuzuClgLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBmb2xkZXIuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50SWQ6IHRhcmdldEZvbGRlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRCeTogcmVxLmJvZHkuY3JlYXRlZEJ5IHx8ICdzeXN0ZW0nXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuZm9sZGVycy5zdWNjZXNzKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmZvbGRlcnMuZmFpbGVkKys7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuZm9sZGVycy5lcnJvcnMucHVzaCh7IGZvbGRlcklkLCBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8g7YWM7Iqk7Yq4IOy8gOydtOyKpCDsnbzqtIQg67O17IKsXG4gICAgICAgIGlmICh0ZXN0Q2FzZUlkcyAmJiB0ZXN0Q2FzZUlkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHRlc3RDYXNlSWQgb2YgdGVzdENhc2VJZHMpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZXN0Q2FzZSA9IGF3YWl0IGdldFRlc3RDYXNlQnlJZCh0ZXN0Q2FzZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRlc3RDYXNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3BpZWRUZXN0Q2FzZSA9IGF3YWl0IGNyZWF0ZVRlc3RDYXNlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogYCR7dGVzdENhc2UudGl0bGV9ICjrs7Xsgqzrs7gpYCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVyZXE6IHRlc3RDYXNlLnByZXJlcSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwczogdGVzdENhc2Uuc3RlcHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQ6IHRlc3RDYXNlLmV4cGVjdGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW9yaXR5OiB0ZXN0Q2FzZS5wcmlvcml0eSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdzOiB0ZXN0Q2FzZS50YWdzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogdGVzdENhc2Uuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRCeTogcmVxLmJvZHkuY3JlYXRlZEJ5IHx8ICdzeXN0ZW0nXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgZm9sZGVyU2VydmljZS5hZGRUZXN0Q2FzZVRvRm9sZGVyKGNvcGllZFRlc3RDYXNlLmlkLCB0YXJnZXRGb2xkZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnRlc3RDYXNlcy5zdWNjZXNzKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnRlc3RDYXNlcy5mYWlsZWQrKztcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy50ZXN0Q2FzZXMuZXJyb3JzLnB1c2goeyB0ZXN0Q2FzZUlkLCBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmVzLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ+ydvOq0hCDrs7XsgqzqsIAg7JmE66OM65CY7JeI7Iq164uI64ukLicsXG4gICAgICAgICAgICByZXN1bHRzXG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+ydvOq0hCDrs7Xsgqwg7Iuk7YyoOicsIGVycm9yKTtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAn7J286rSEIOuzteyCrOyXkCDsi6TtjKjtlojsirXri4jri6QuJyB9KTtcbiAgICB9XG59KTtcblxuLy8g7J286rSEIOyCreygnCBBUElcbnJvdXRlci5kZWxldGUoJy8nLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGZvbGRlcklkcywgdGVzdENhc2VJZHMgfSA9IHJlcS5ib2R5O1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHtcbiAgICAgICAgICAgIGZvbGRlcnM6IHsgc3VjY2VzczogMCwgZmFpbGVkOiAwLCBlcnJvcnM6IFtdIGFzIEFycmF5PHsgZm9sZGVySWQ6IG51bWJlcjsgZXJyb3I6IHN0cmluZyB9PiB9LFxuICAgICAgICAgICAgdGVzdENhc2VzOiB7IHN1Y2Nlc3M6IDAsIGZhaWxlZDogMCwgZXJyb3JzOiBbXSBhcyBBcnJheTx7IHRlc3RDYXNlSWQ6IG51bWJlcjsgZXJyb3I6IHN0cmluZyB9PiB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8g7Y+0642UIOydvOq0hCDsgq3soJxcbiAgICAgICAgaWYgKGZvbGRlcklkcyAmJiBmb2xkZXJJZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBmb2xkZXJJZCBvZiBmb2xkZXJJZHMpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBmb2xkZXJTZXJ2aWNlLmRlbGV0ZUZvbGRlcihmb2xkZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuZm9sZGVycy5zdWNjZXNzKys7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5mb2xkZXJzLmZhaWxlZCsrO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmZvbGRlcnMuZXJyb3JzLnB1c2goeyBmb2xkZXJJZCwgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIO2FjOyKpO2KuCDsvIDsnbTsiqQg7J286rSEIOyCreygnFxuICAgICAgICBpZiAodGVzdENhc2VJZHMgJiYgdGVzdENhc2VJZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZm9yIChjb25zdCB0ZXN0Q2FzZUlkIG9mIHRlc3RDYXNlSWRzKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlVGVzdENhc2UodGVzdENhc2VJZCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMudGVzdENhc2VzLnN1Y2Nlc3MrKztcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnRlc3RDYXNlcy5mYWlsZWQrKztcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy50ZXN0Q2FzZXMuZXJyb3JzLnB1c2goeyB0ZXN0Q2FzZUlkLCBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmVzLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ+ydvOq0hCDsgq3soJzqsIAg7JmE66OM65CY7JeI7Iq164uI64ukLicsXG4gICAgICAgICAgICByZXN1bHRzXG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+ydvOq0hCDsgq3soJwg7Iuk7YyoOicsIGVycm9yKTtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAn7J286rSEIOyCreygnOyXkCDsi6TtjKjtlojsirXri4jri6QuJyB9KTtcbiAgICB9XG59KTtcblxuLy8g7J286rSEIOyDge2DnCDrs4Dqsr0gQVBJXG5yb3V0ZXIucGF0Y2goJy9zdGF0dXMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB7IHRlc3RDYXNlSWRzLCBzdGF0dXMgfSA9IHJlcS5ib2R5O1xuICAgICAgICBcbiAgICAgICAgaWYgKCFzdGF0dXMpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICfsg4Htg5wg6rCS7J20IO2VhOyalO2VqeuLiOuLpC4nIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0ZXN0Q2FzZUlkcyB8fCB0ZXN0Q2FzZUlkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICfthYzsiqTtirgg7LyA7J207IqkIElE6rCAIO2VhOyalO2VqeuLiOuLpC4nIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IDAsXG4gICAgICAgICAgICBmYWlsZWQ6IDAsXG4gICAgICAgICAgICBlcnJvcnM6IFtdIGFzIEFycmF5PHsgdGVzdENhc2VJZDogbnVtYmVyOyBlcnJvcjogc3RyaW5nIH0+XG4gICAgICAgIH07XG5cbiAgICAgICAgZm9yIChjb25zdCB0ZXN0Q2FzZUlkIG9mIHRlc3RDYXNlSWRzKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZVRlc3RDYXNlKHRlc3RDYXNlSWQsIHsgc3RhdHVzIH0pO1xuICAgICAgICAgICAgICAgIHJlc3VsdHMuc3VjY2VzcysrO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRzLmZhaWxlZCsrO1xuICAgICAgICAgICAgICAgIHJlc3VsdHMuZXJyb3JzLnB1c2goeyB0ZXN0Q2FzZUlkLCBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXMuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAn7J286rSEIOyDge2DnCDrs4Dqsr3snbQg7JmE66OM65CY7JeI7Iq164uI64ukLicsXG4gICAgICAgICAgICByZXN1bHRzXG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+ydvOq0hCDsg4Htg5wg67OA6rK9IOyLpO2MqDonLCBlcnJvcik7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ+ydvOq0hCDsg4Htg5wg67OA6rK97JeQIOyLpO2MqO2WiOyKteuLiOuLpC4nIH0pO1xuICAgIH1cbn0pO1xuXG5leHBvcnQgZGVmYXVsdCByb3V0ZXI7ICJdLCJ2ZXJzaW9uIjozfQ==